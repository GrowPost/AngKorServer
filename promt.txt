jadilah asisten koding ai bahasa pemrograman lua Untnk growsoft dan game growtopu
ia saya saya akan memberikan sejumlah metode dan bahasa lua Untnk anda pelajari


yang pertama adalah API Changelog

November 13, 2025
New Features & Updates:
Added new Player blessing methods: onPlayerBlessingClaimCallback, player:hasActiveBlessing, player:hasBlessing, player:addBlessing, and player:removeBlessing.
Added new Server blessing functions: getBlessingName, getBlessingInfo, and getBlessingRarity.
Added various new Player methods for account and data retrieval:
player:getIP()
player:getRID()
player:setPassword()
player:checkPassword()
player:getEmail()
player:getBackpackItems()
player:getGender()
player:getPlaytime()
player:getDiscordInvites()

New Features & Updates:
Added Role Quest management with player:setRoleQuestLevel(type, level) and player:getRoleQuestLevel(type).
Added World Lock bypass methods: world:setOwner(user_id) and world:removeOwner().
Added new callback onPlayerBoostClaimCallback(player).
Added new world creation method World.newFromTemplate(name, templateFile) to create worlds from .dat files.
Added world:getWorldType() to check for custom world types (e.g., dungeons).

kedua callback 

onPlayerDialogCallback(world, player, data)
Handles player interactions with dialogs. The `data` table contains `dialog_name` and `buttonClicked`.

onPlayerConsumableCallback(world, player, tile, clickedPlayer, itemID)
Triggered when a player uses a consumable item.

onTileWrenchCallback(world, player, tile)
Triggered when a player wrenches a tile.

onPlayerWrenchCallback(world, player, wrenchingPlayer)
Triggered when a player wrenches another player or NPC. You can check `wrenchingPlayer:getType()` to see if it's an NPC (e.g., type 25 for Lua-spawned NPCs).

onPlayerLoginCallback(player)
Triggered when a player logs into the server.

onTilePlaceCallback(world, player, tile, placingID)
Triggered when a player places a tile. Return `true` to prevent placement.

onWorldTick(world)
Called every 100ms for each active world.

onTick()
Called every 100ms on the server globally.

onPlayerFirstTimeLoginCallback(player)
Triggered only on a player's very first login to the server.

onPlayerEnterWorldCallback(world, player)
Triggered when a player successfully enters a world.

onPlayerLeaveWorldCallback(world, player)
Triggered when a player leaves a world.

onTilePunchCallback(world, avatar, tile)
Triggered when a player punches a tile. Return `true` to prevent the default break action.

onPlayerDisconnectCallback(player)
Triggered when a player disconnects from the server.

onPlayerDeathCallback(world, player, isRespawn)
Triggered when a player dies or respawns. `isRespawn` is true if the player is respawning.

onPlayerDropCallback(world, player, itemID, itemCount)
Triggered when a player drops an item. Return `true` to prevent the drop.

onPlayerLevelUPCallback(world, player, levelReached)
Triggered when a player levels up.
PERIA
Search functions...
API Changelog
Callbacks
Commands
Dialog Syntax
Player
World
Tile
Item
Inventory Item
Drop
Server & Global
OS Library
Libraries
Miscellaneous
This documentation page is for a private server project and is not affiliated with the official GrowSoft game or its developers. It is provided for informational purposes only.
API Changelog
November 13, 2025
New Features & Updates:
Added new Player blessing methods: onPlayerBlessingClaimCallback, player:hasActiveBlessing, player:hasBlessing, player:addBlessing, and player:removeBlessing.
Added new Server blessing functions: getBlessingName, getBlessingInfo, and getBlessingRarity.
Added various new Player methods for account and data retrieval:
player:getIP()
player:getRID()
player:setPassword()
player:checkPassword()
player:getEmail()
player:getBackpackItems()
player:getGender()
player:getPlaytime()
player:getDiscordInvites()
October 25, 2025
New Features & Updates:
Added Role Quest management with player:setRoleQuestLevel(type, level) and player:getRoleQuestLevel(type).
Added World Lock bypass methods: world:setOwner(user_id) and world:removeOwner().
Added new callback onPlayerBoostClaimCallback(player).
Added new world creation method World.newFromTemplate(name, templateFile) to create worlds from .dat files.
Added world:getWorldType() to check for custom world types (e.g., dungeons).
Callbacks
onPlayerDialogCallback(world, player, data)
Handles player interactions with dialogs. The `data` table contains `dialog_name` and `buttonClicked`.

onPlayerConsumableCallback(world, player, tile, clickedPlayer, itemID)
Triggered when a player uses a consumable item.

onTileWrenchCallback(world, player, tile)
Triggered when a player wrenches a tile.

onPlayerWrenchCallback(world, player, wrenchingPlayer)
Triggered when a player wrenches another player or NPC. You can check `wrenchingPlayer:getType()` to see if it's an NPC (e.g., type 25 for Lua-spawned NPCs).

onPlayerLoginCallback(player)
Triggered when a player logs into the server.

onTilePlaceCallback(world, player, tile, placingID)
Triggered when a player places a tile. Return `true` to prevent placement.

onPlayerTick(player)
Called every 1000ms for each online player.

onWorldTick(world)
Called every 100ms for each active world.

onTick()
Called every 100ms on the server globally.

onPlayerFirstTimeLoginCallback(player)
Triggered only on a player's very first login to the server.

onPlayerEnterWorldCallback(world, player)
Triggered when a player successfully enters a world.

onPlayerLeaveWorldCallback(world, player)
Triggered when a player leaves a world.

onTilePunchCallback(world, avatar, tile)
Triggered when a player punches a tile. Return `true` to prevent the default break action.

onPlayerDisconnectCallback(player)
Triggered when a player disconnects from the server.

onPlayerDeathCallback(world, player, isRespawn)
Triggered when a player dies or respawns. `isRespawn` is true if the player is respawning.

onPlayerDropCallback(world, player, itemID, itemCount)
Triggered when a player drops an item. Return `true` to prevent the drop.

onPlayerLevelUPCallback(world, player, levelReached)
Triggered when a player levels up.

onPlayerEquipClothingCallback(world, player, itemID)
Triggered when a player tries to equip an item. Return `true` to prevent equipping.

onPlayerUnequipClothingCallback(world, player, itemID)
Triggered when a player tries to unequip an item. Return `true` to prevent unequipping.

onPlayerPickupItemCallback(world, player, itemID, itemCount)
Triggered when a player picks up an item. Return `true` to prevent the pickup.

onPlayerEnterDoorCallback(world, player, targetWorldName, doorID)
Triggered when a player enters a door. Return `true` to prevent entry.

onPlayerPlantCallback(world, player, tile)
Triggered when a player plants a seed.

onPlayerHarvestCallback(world, player, tile)
Triggered when a player harvests a tree.

onPlayerCatchFishCallback(world, player, itemID, itemCount)
Triggered when a player catches a fish.

onPlayerCrimeCallback(world, player, itemID, itemCount)
Related to moderation actions or "crimes".

onPlayerSurgeryCallback(world, player, itemID, itemCount)
Triggered during a surgery action.

onPlayerKillCallback(world, player, killedPlayer)
Triggered when a player kills another player (e.g., in a PVP world).

onPlayerProviderCallback(world, player, tile, itemID, itemCount)
Triggered when a player receives items from a provider block.

onPlayerHarmonicCallback(world, player, tile, itemID, itemCount)
Related to harmonic crystals.

onPlayerGeigerCallback(world, player, itemID, itemCount)
Triggered when a player finds something with a Geiger counter.

onPlayerCatchGhostCallback(world, player, itemID, itemCount)
Triggered when a player catches a ghost.

onPlayerXPCallback(world, player, amount)
Triggered when a player gains experience points.

onPlayerFirePutOutCallback(world, player, tile)
Triggered when a player extinguishes a fire.

onPlayerEarnGrowtokenCallback(world, player, itemCount)
Triggered when a player earns a Growtoken.

onPlayerTrainFishCallback(world, player)
Called once a player has trained a fish.

onPlayerGemsObtainedCallback(world, player, amount)
Triggered when a player obtains gems through various actions.

onTileBreakCallback(world, player, tile)
A generic callback for when any tile is broken.

onPlayerAddFriendCallback(world, player, addedPlayer)
Triggered when a player adds another player as a friend.

onPlayerTradeCallback(world, player1, player2, items1, items2)
Triggered upon a successful trade. `items1` and `items2` are tables of traded items.

onPlayerVariantCallback(player, variant, delay, netID)
A low-level callback for handling various client packets (variants). Advanced use only.

onPlayerRawPacketCallback(player, data)
A very low-level callback for handling raw network packets from a player. Advanced use only.

onPlayerEquippedClothingCallback(world, player, item_id)
Called AFTER a player successfully equips an item.

onPlayerUnequippedClothingCallback(world, player, item_id)
Called AFTER a player successfully unequips an item.

onPlayerTrashCallback(world, player, item_id, item_amount)
Triggered when a player trashes an item. Return `true` to prevent trashing.

onPlayerRecycleCallback(world, player, item_id, item_amount, gems_earned)
Triggered when a player recycles an item. Return `true` to prevent recycling.

onPlayerPunchPlayerCallback(world, player, second_player)
Triggered when a player punches another player.

onEventChangedCallback(newEventID, oldEventID)
Triggered when the server-wide event changes.

onPlayerActionCallback(world, player, data)
A generic callback for various player actions, often from UI buttons. `data["action"]` contains the action name.

onAutoSaveRequest()
Triggered periodically by the server to request data saving. Use `saveDataToServer` here.

onDiscordMessageCreateCallback(event)
Triggered when a message is created in a linked Discord channel.

onPlayerDNACallback(world, player, resultID, resultAmount)
Triggered when a player uses a DNA Combiner.

onWorldLoaded(world)
Called once a world is loaded into memory.

onWorldOffloaded(world)
Called once a world is removed from memory.

onPlayerBoostClaimCallback(player)
Triggered when a player claims a boost.

onPlayerBlessingClaimCallback(world, player, blessingID)
Triggered when a player claims a blessing, e.g., from a power orb. Can be used for custom blessings.

ke 3 Commands
registerLuaCommand(commandData)
Registers a new custom slash command. `commandData` is a table: `{ command="name", roleRequired=0, description="desc" }`.

onPlayerCommandCallback(world, player, fullCommand)
Handles the execution of custom slash commands. Return `true` if you handle the command.

e 4 Dialog Syntax

set_default_color|color

Sets the default dialog text color (e.g., `\`o`).

set_border_color|r,g,b,a|

Sets the dialog border color.

set_bg_color|r,g,b,a|

Sets the dialog background color.

set_custom_spacing|x:value;y:value|

Adds custom horizontal and vertical spacing between elements.

add_custom_break|

Adds a line break.

start_custom_tabs|

Starts a container for custom tabs.

end_custom_tabs|

Ends a container for custom tabs.

disable_resize|

Disables automatic dialog resizing.

reset_placement_x|

Resets horizontal placement.

add_label|size|message|alignment

Adds a text label (size: big/small, alignment: left/center/right).

add_smalltext|message|

Adds small text.

add_textbox|message|

Adds a text box with a message.

add_button|name|label|flags|0|0

Adds a standard button.

add_small_font_button|name|label|flags|0|0
Adds a button with a smaller font.

add_text_input|name|message|defaultInput|length
Adds a text input field.

add_checkbox|name|message|checked
Adds a checkbox. `checked` is 1 for true, 0 for false.

add_item_picker|name|message|placeholder|
Adds a searchable item picker.

add_spacer|size|
Adds a vertical spacer (size: big/small).

add_quick_exit|
Adds a quick exit "X" button to the dialog.

embed_data|embed|data|
Embeds data into the dialog, often used to set the `dialog_name`.

add_label_with_icon|size|message|alignment|iconID
Adds a label prefixed with an item icon.

add_button_with_icon|name|text|options|itemID|...|
A versatile button with an icon and various display options. See examples in text file.

add_player_info|name|level|exp|expRequired
Displays a player info block.

add_progress_bar|name|size|text|current|max|color|
Adds a progress bar.

add_image_button|name|imagePath|flags|open|label|
Adds a button with a custom image.

add_tab_button|name|label|iconPath|x|y
Adds a tab button.

add_banner|imagePath|x|y|
Adds a banner.

add_big_banner|imagePath|x|y|text|
Adds a larger banner with text.

add_searchable_item_list|data|options|searchFixedName
Adds a searchable list of items. Options e.g., `listType:iconGrid;resultLimit:12`.

add_dual_layer_icon_label|size|message|alignment|iconID|bg|fg|size|toggle
Adds a dual-layer icon label.

add_seed_color_icons|itemID
Adds seed color icons for a specific item.

add_label_with_icon_button|size|message|alignment|iconID|buttonName
Adds a label with an icon and a button.

add_achieve_button|achName|achToGet|achID|unk
Adds an achievement button.

add_community_button|button|btnName|flags|0|0
Adds a community button.

add_friend_image_label_button|name|label|texture_path|size|texture_x|texture_y|
Adds a button with a friend image.

add_custom_button|name|option|
Adds a custom button.

add_custom_label|option1|option2|
Adds a custom label with options.

add_custom_spacer|x:value|
Adds a custom spacer with a specified width.

add_custom_textbox|text|size:value|
Adds a custom textbox with a specified size.

add_cmmnty_ft_wrld_bttn|worldName|ownerName|worldName|
Adds a community feature world button.

add_cmmnty_wotd_bttn|top|worldName|ownerName|imagePath|x|y|worldName|
Adds a community WOTD button.

community_hub_type|hubType|
Sets the community hub type.

enable_tabs|enable|
Enables or disables tabs

selanjutnya ada di tesk nnti ya karna panjang 


ke 5 Player

player:getLevel()
Returns the player's current level.

player:addLevel(amount)
Adds a specified number of levels to the player.

player:removeLevel(amount)
Removes a specified number of levels from the player.

player:setLevel(level)
Sets the player's level to a specific value.

player:setXP(amount)
Sets the player's total experience points to a specific value.

player:removeXP(amount)
Removes a specific amount of experience points from the player.

player:getGems()
Returns the player's gem count.

player:addGems(amount, sendPacket, isDisplay)
Adds a specified amount of gems to the player.

player:removeGems(amount, sendPacket, isDisplay)
Removes a specified amount of gems from the player.

player:setGems(amount)
Sets the player's gem count to a specific value.

player:getCoins()
Returns the player's coin count.

player:addCoins(amount, sendPacket)
Adds coins to the player.

player:removeCoins(amount, sendPacket)
Removes coins from the player.

player:setCoins(amount)
Sets the player's coin count to a specific value.

player:getBankBalance()
Returns the player's bank balance.

player:addBankBalance(amount)
Adds to the player's bank balance.

player:removeBankBalance(amount)
Removes from the player's bank balance.

player:setBankBalance(amount)
Sets the player's bank balance to a specific value.

player:ban(length_seconds, reason, banned_by_player, ban_device, ban_ip)
Bans the player. `length_seconds = 0` for a permanent ban. `banned_by_player` is another player object (can be nil). `ban_device` and `ban_ip` are 0 (no) or 1 (yes).

player:onConsoleMessage(message)
Sends a message to the player's in-game console.

player:onDialogRequest(dialogString)
Sends a dialog to the player using the special dialog string syntax.

player:getNetID()
Returns the player's network ID.

player:getUserID()
Returns the player's unique user ID.

player:playAudio(filePath, delay)
Plays an audio file for the player (e.g., "audio/ding.wav").

player:getItemAmount(itemID)
Returns the amount of a specific item the player has in their inventory.

player:changeItem(itemID, amount, isSendPacket)
Adds (`amount` > 0) or removes (`amount` < 0) an item from the player's inventory.

player:enterWorld(worldName, doorID)
Teleports the player to a specified world.

player:getWorldName()
Returns the name of the world the player is currently in.

player:onTextOverlay(text)
Displays a large text overlay on the player's screen.

player:getCleanName()
Returns the player's name without any special formatting.



player:onTalkBubble(netID, message, isApi)
Displays a talk bubble above a player. Use `player:getNetID()` for self.

player:hasRole(role)
Checks if the player has a specific role ID. (e.g., `Roles.ROLE_ADMIN`).

player:setRole(role)
Sets the player's role ID.

player:getMod(playModID)
Returns the player's mod.

player:addMod(modID, durationSeconds)
Adds a temporary modification (e.g., curse, buff) to the player.

player:removeMod(modID)
Removes a modification from the player.

player:getCountry()
Returns the player's country code (e.g., "us").

player:setCountry(countryCode)
Changes the country flag of a player. Example: `player:setCountry("us")`.

player:getPlatform()
Returns the player's platform ID (0: Win, 1: iOS, 2: macOS, 4: Android).

player:sendVariant(variantTable, delay, netID)
Sends a raw variant packet to the player. Examples: `{"OnTalkBubble", netID, "Msg"}`, `{"OnConsoleMessage", "Msg"}`, `{"OnCountdownStart", 60, -1}`. Advanced use.

player:sendAction(actionString)
Sends a default Growtopia action string (e.g., for sound effects like `action|play_sfx...`).

player:getInventoryItems()
Returns a table of all items in the player's inventory. Iterate through it to access individual items.

player:onClothesUI(targetPlayer)
Shows the clothing UI of a target player.

player:onAchievementsUI(targetPlayer)
Shows the achievements UI for a target player.

player:onTitlesUI(targetPlayer)
Shows the titles UI for a target player.

player:onTradeScanUI()
Shows the trade scan UI.

player:onGrow4GoodUI()
Shows the Grow4Good UI.

player:onRedeemMenu()
Sends a redeem menu to the player.

player:getClothingItemID(slot)
Gets the item ID of clothing in a specific slot (e.g., `PlayerClothes.HAND`).

player:getUnlockedAchievementsCount()
Returns the number of achievements the player has unlocked.

player:getAchievementsCount()
Returns the total number of available achievements.

player:getBackpackUsedSize()
Returns the number of used slots in the backpack.

player:setNextDialogRGBA(r, g, b, a)
Sets the background color of the next dialog.

player:setNextDialogBorderRGBA(r, g, b, a)
Sets the border color of the next dialog.

player:resetDialogColor()
Resets dialog colors to default. Must be called after using custom colors.

player:getHomeWorldID()
Returns Player's Home World ID.

player:getOnlineStatus()
Returns The Online Status.

player:getGuildID()
Returns the Guild ID.

player:getTransformProfileButtons()
Returns Player's TransformProfile Buttons.

player:getDiscordID()
Returns the Player's Discord ID.

player:getAccountCreationDateStr()
Returns the Account Creation Date.

player:getClassicProfileContent(cat, flags)
Returns the ClassicProfile Content.

player:onGuildNotebookUI()
Returns The GuildNotebook UI.

target player.

player:onVouchersUI()
Shows the Vouchers UI.

player:onMentorshipUI()
Shows the Mentorship UI.

player:onBackpackUI(targetPlayer)
Shows the Backpack UI for a target player.

player:setRoleQuestLevel(type, level)
Sets the player's role quest level for a specific type (e.g., `PlayerRoleQuestTypes.Farmer`).

player:getRoleQuestLevel(type)
Gets the player's role quest level for a specific type.

player:getIP()
Returns the player's IP address as a string.

player:getRID()
Returns the player's unique identifier (RID) as a string.

player:setPassword(newPassword)
Sets the player's account password.

player:getEmail()
Returns the player's email address.

player:getBackpackItems()
Returns a table of all items in the player's backpack.

player:getGender()
Returns the player's gender.

player:getPlaytime()
Returns the player's total


embukaan, 100 script lua ### File: Giveaway.lua
print("(Loaded) Giveaway Script for GrowSoft")

local Roles = {
    ROLE_DEVELOPER = 51
}

local giveawayItems = {}

local MAX_INVENTORY_SLOT = 200

local function formatNum(num)
    local formattedNum = tostring(num)
    formattedNum = formattedNum:reverse():gsub("(%d%d%d)", "%1,"):reverse()
    formattedNum = formattedNum:gsub("^,", "")
    return formattedNum
end

local function showGiveawayDialog(player)
    local layout = "add_spacer|small|\n"
    layout = layout .. "add_label_with_icon|big|`wGiveaway Manager|left|6128|\n"
    layout = layout .. "add_spacer|small|\n"
    layout = layout .. "add_textbox|`oAdd items to the giveaway list and distribute to all players.|left|\n"
    layout = layout .. "add_spacer|small|\n"

    if #giveawayItems == 0 then
        layout = layout .. "add_smalltext|`7(No items)|left|\n"
    else
        layout = layout .. "add_smalltext|`wItems to be given (click to remove):|left|\n"
        layout = layout .. "add_spacer|small|\n"

        for i, entry in ipairs(giveawayItems) do
            local item = getItem(entry.id)
            --local label = string.format("%s x%s", item:getName(), formatNum(entry.amount))
            layout = layout .. "text_scaling_string|aaaaaaaaaaaa|\n"
            layout = layout .. string.format("add_button_with_icon|remove_%d|%s|staticYellowFrame|%d|%s|\n", i, item:getName(), entry.id, formatNum(entry.amount))
        end
    end

    layout = layout .. "add_custom_break|\n"
    layout = layout .. "add_spacer|small|\n"
    layout = layout .. "add_text_input|item_id|Item ID:|242|5|\n"
    layout = layout .. "add_text_input|item_amount|Amount:|1|5|\n"
    layout = layout .. "add_quick_exit|\n"
    layout = layout .. "add_spacer|small|\n"
    layout = layout .. "add_custom_button|add_item|textLabel:Add Item;margin:10,0|\n"
    layout = layout .. "add_custom_break|\n"
    layout = layout .. "add_spacer|small|\n"
    layout = layout .. "add_custom_button|give_all|textLabel:`2Giveaway;margin:10,0|\n"
    layout = layout .. "end_dialog|giveaway_dialog|||\n"
    layout = layout .. "add_custom_break|\n"
    layout = layout .. "add_label_with_icon|small||left|0|\n"
    player:onDialogRequest(layout)
end

onPlayerDialogCallback(function(world, player, data)
    if data["dialog_name"] ~= "giveaway_dialog" then return false end

    local clicked = data["buttonClicked"]

    local removeIndex = clicked:match("^remove_(%d+)$")
    if removeIndex then
        removeIndex = tonumber(removeIndex)
        if giveawayItems[removeIndex] then
            local removedItem = getItem(giveawayItems[removeIndex].id)
            table.remove(giveawayItems, removeIndex)
            player:onTalkBubble(player:getNetID(), "Removed " .. removedItem:getName() .. " from the list.", 0)
        end
        showGiveawayDialog(player)
        return true
    end

    if clicked == "add_item" then
        local id = tonumber(data["item_id"])
        local amount = tonumber(data["item_amount"])
        if not id or not amount or id <= 0 or amount <= 0 or amount > MAX_INVENTORY_SLOT then
            player:onTalkBubble(player:getNetID(), "Invalid item ID or amount.", 1)
            player:playAudio("bleep_fail.wav")
            return true
        end

        table.insert(giveawayItems, { id = id, amount = amount })
        showGiveawayDialog(player)
        return true
    end

    if clicked == "give_all" then
        if #giveawayItems == 0 then
            player:onTalkBubble(player:getNetID(), "Giveaway list is empty.", 1)
            player:playAudio("bleep_fail.wav")
            return true
        end

        local players = getServerPlayers()
        for _, target in ipairs(players) do
            local messageLines = {}
            for _, entry in ipairs(giveawayItems) do
                local item = getItem(entry.id)
                local itemName = item:getName()
                local amount = entry.amount

                if not target:changeItem(entry.id, amount, 0) then
                    target:changeItem(entry.id, amount, 1)
                end

                table.insert(messageLines, "- " .. itemName .. " x" .. formatNum(amount))
            end

            target:onConsoleMessage("`2You received:\n" .. table.concat(messageLines, "\n"))
            target:sendVariant({"OnAddNotification", "interface/large/atomic_button.rttex", "`2Received Something from Giveaway", "audio/beep.wav", 0})
        end

        giveawayItems = {}
        player:onTalkBubble(player:getNetID(), "`2Giveaway Complete!", 0)
        return true
    end

    return false
end)

local giveawayCommand = {
    command = "giveaway",
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Opens the giveaway management UI"
}

registerLuaCommand(giveawayCommand)

onPlayerCommandCallback(function(world, player, fullCommand)
    local command, args = fullCommand:match("^(%S+)%s*(.*)")
    if command == giveawayCommand.command then
        if not player:hasRole(Roles.ROLE_DEVELOPER) then
            player:onConsoleMessage("`4Unknown command. `oEnter /? for a list of valid commands.")
            player:playAudio("bleep_fail.wav")
            return true
        end
        showGiveawayDialog(player)
        return true
    end
    return false
end)

### File: BonusDrop.lua
print("(Loaded) Bonus Drop Script for GrowSoft")

math.randomseed(os.time())

-- [tileID] = { dropID, amount, chance (0.01 = 1%, 100 = 100%) }
local drops = {
    [2] = {
        { dropID = 242, amount = 1, chance = 10 }, -- 10% chance
        { dropID = 500, amount = 1, chance = 5 },  -- 5% chance
    },
}

local function shouldDrop(chancePercent)
    local roll = math.random() * 100
    return roll <= chancePercent
end

onTileBreakCallback(function(world, player, tile)
    local tileID = tile:getTileID()
    local possibleDrops = drops[tileID]

    if possibleDrops then
        local eligibleDrops = {}

        for _, drop in ipairs(possibleDrops) do
            if shouldDrop(drop.chance) then
                table.insert(eligibleDrops, drop)
            end
        end

        if #eligibleDrops > 0 then
            local selectedDrop = eligibleDrops[math.random(1, #eligibleDrops)]

            for i = 1, selectedDrop.amount do
                world:spawnItem(tile:getPosX(), tile:getPosY(), selectedDrop.dropID, 1)
            end
            
        end

        return false
    end

    return false
end)

### File: GiveSupporter.lua
print("(Loaded) Give Supporter / Super Supporter Script for GrowSoft")

local giveSupporterCommand = "givesupp"
local giveInventorySlotCommand = "giveinv"

local Roles = {
    ROLE_DEVELOPER = 51,
}

registerLuaCommand({
    command = giveSupporterCommand,
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Grants the Supporter or Super Supporter role to a player."
})

registerLuaCommand({
    command = giveInventorySlotCommand,
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Give inventory space to a player."
})

local function findPlayerByNameInsensitive(inputName)
    local target = string.lower(inputName)
    for _, p in ipairs(getServerPlayers()) do
        if string.lower(p:getCleanName()) == target then
            return p
        end
    end
    return nil
end

onPlayerCommandCallback(function(world, player, fullCommand)

    local command, args = fullCommand:match("^(%S+)%s*(.*)$")

    if command ~= giveSupporterCommand and command ~= giveInventorySlotCommand then return false end

    if not player:hasRole(Roles.ROLE_DEVELOPER) then
        player:onConsoleMessage("`4Unknown command. `oEnter /? for a list of valid commands.")
        player:playAudio("bleep_fail.wav")
        return true
    end

    if args == "" then
        player:onConsoleMessage("Usage: /" .. command .. " <playerName> <sup/ssup>")
        player:playAudio("thwoop.wav")
        return true
    end

    local targetName, tier = args:match("^(%S+)%s*(%S*)$")
    local target = findPlayerByNameInsensitive(targetName)

    if not target then
        player:onConsoleMessage("Player '" .. targetName .. "' not found or not online.")
        player:playAudio("bleep_fail.wav")
        return true
    end

    if command == giveInventorySlotCommand then

        local targetName, amountStr = args:match("^(%S+)%s*(%S*)$")
        local target = findPlayerByNameInsensitive(targetName)

        if not target then
            player:onConsoleMessage("Player '" .. targetName .. "' not found or not online.")
            player:playAudio("bleep_fail.wav")
            return true
        end

        local amount = tonumber(amountStr)
        local maxInventory = 396
        local currentInventory = target:getInventorySize()

        if not amount then
            player:onConsoleMessage("Usage: /giveinv <playerName> <amount>")
            player:playAudio("thwoop.wav")
            return true
        end

        if amount <= 0 then
            player:onConsoleMessage("Invalid amount. Must be greater than zero.")
            player:playAudio("bleep_fail.wav")
            return true
        end

        local newInventory = currentInventory + amount
        if newInventory > maxInventory then
            amount = maxInventory - currentInventory
            newInventory = maxInventory
        end

        if amount <= 0 then
            player:onConsoleMessage(target:getName() .. " already has max inventory space (" .. currentInventory .. ").")
            player:playAudio("bleep_fail.wav")
            return true
        end

        player:onConsoleMessage("Increased " .. target:getName() .. "'s inventory by " .. amount .. " slots to " .. newInventory .. ".")
        player:playAudio("piano_nice.wav")
        target:upgradeInventorySpace(amount)
        target:onConsoleMessage("Your inventory space has been increased by " .. amount .. " slots!")
        target:playAudio("success.wav")

        return true
    end

    local supporterCost = 0
    local roleName = ""

    if tier == "ssup" then
        supporterCost = 100
        roleName = "Super Supporter"
    elseif tier == "sup" then
        supporterCost = 35
        roleName = "Supporter"
    else
        player:onConsoleMessage("Invalid tier. Use 'sup' or 'ssup'.")
        player:playAudio("bleep_fail.wav")
        return true
    end

    target:addCoins(supporterCost)
    target:removeCoins(supporterCost, 1)

    player:onConsoleMessage("You have successfully granted " .. roleName .. " Role to " .. target:getName() .. ".")
    player:playAudio("piano_nice.wav")
    target:onConsoleMessage("You have been granted the `#" .. roleName .. " Role`o by a Developer!")
    target:sendVariant({"OnAddNotification", "", "`wYou received `2" .. roleName .. "`w Role!", "audio/success.wav", 0})

    return true
end)

### File: Gacha.lua
print("(Loaded) Gacha Script for GrowSoft")

-- ID inside [] is the target block. Fill name with the exact name of the target block, it will help you identify blocks.
local dropSets = {
    [2] = {
        name = "Dirt",
        drops = {
            {itemID = 242, chance = 0.10},
        }
    },

    [10] = {
        name = "Rock",
        drops = {
            {itemID = 242, chance = 0.76},
        }
    },
}

math.randomseed(os.time())

local function rareItem(player)
    player:onTalkBubble(player:getNetID(), "`2I got rare item!", 0)
end

local function getItemName(itemID)
    local item = getItem(itemID)
    return item and item:getName() or "Unknown Item"
end

local function getRandomDrop(player, blockID)
    local blockConfig = dropSets[blockID]
    if not blockConfig or not blockConfig.drops then return nil end

    local possibleDrops = {}
    for _, drop in ipairs(blockConfig.drops) do
        if math.random() <= drop.chance then
            table.insert(possibleDrops, drop)
        end
    end

    if #possibleDrops > 0 then
        local chosenDrop = possibleDrops[math.random(1, #possibleDrops)]
        local itemName = getItemName(chosenDrop.itemID)

        if chosenDrop.chance <= 0.05 then
            rareItem(player)
        end

        return {
            name = itemName,
            itemID = chosenDrop.itemID,
            blockName = blockConfig.name or "Unknown Gacha"
        }
    end

    return nil
end

onTileBreakCallback(function(world, player, tile)
    local tileID = tile:getTileID()
    if dropSets[tileID] then
        local drop = getRandomDrop(player, tileID)
        if drop then
            world:spawnItem(tile:getPosX(), tile:getPosY(), drop.itemID, 1)
            player:onConsoleMessage("`2You found " .. drop.name .. "`w from `6" .. drop.blockName .. "`w!", 0)
            return true
        end
    end
    return false
end)

### File: GiveServerToken.lua
print("(Loaded) Give / Remove Server Token Script for GrowSoft")

local serverTokenID = 20234
local giveCommand = "givetoken"
local removeCommand = "removetoken"

local Roles = {
    ROLE_DEVELOPER = 51,
}

registerLuaCommand({
    command = giveCommand,
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Give server token to a player."
})

registerLuaCommand({
    command = removeCommand,
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Remove server token from a player."
})

local function findPlayerByNameInsensitive(inputName)
    local target = string.lower(inputName)
    for _, p in ipairs(getServerPlayers()) do
        if string.lower(p:getCleanName()) == target then
            return p
        end
    end
    return nil
end

onPlayerCommandCallback(function(world, player, fullCommand)
    local command, args = fullCommand:match("^(%S+)%s*(.*)$")
    if command ~= giveCommand and command ~= removeCommand then return false end

    if not player:hasRole(Roles.ROLE_DEVELOPER) then
        player:onConsoleMessage("`4Unknown command. `oEnter /? for a list of valid commands.")
        player:playAudio("bleep_fail.wav")
        return true
    end

    local targetName, amountStr = args:match("^(%S+)%s+(%S+)$")
    if not targetName or not amountStr then
        player:onConsoleMessage("Usage: /" .. command .. " <playerName> <amount>")
        player:playAudio("thwoop.wav")
        return true
    end

    local amount = tonumber(amountStr)
    if not amount or amount <= 0 then
        player:onConsoleMessage("`4Invalid amount. `oMust be a positive number.")
        player:playAudio("bleep_fail.wav")
        return true
    end

    local target = findPlayerByNameInsensitive(targetName)
    if not target then
        player:onConsoleMessage("Player '" .. targetName .. "' not found or not online.")
        player:playAudio("bleep_fail.wav")
        return true
    end

    if command == giveCommand then
        target:addCoins(amount)
        player:onConsoleMessage("Gave " .. amount .. " " .. getItem(serverTokenID):getName() .. " to " .. target:getName() .. "!")
        target:onConsoleMessage("Developer " .. player:getName() .. " gave you `2" .. amount .. " `o" .. getItem(serverTokenID):getName() .. "!")
        player:playAudio("piano_nice.wav")
        target:playAudio("success.wav")
    else
        target:removeCoins(amount, 0)
        player:onConsoleMessage("Removed " .. amount .. " " .. getItem(serverTokenID):getName() .. " from " .. target:getName() .. "!")
        target:onConsoleMessage("Developer " .. player:getName() .. " removed `4" .. amount .. " `o" .. getItem(serverTokenID):getName() .. " from your balance!")
        player:playAudio("piano_nice.wav")
        target:playAudio("loser.wav")
    end
    
    return true
end)

### File: BlockGemDrops.lua
print("(Loaded) Block Gem Drops Script for GrowSoft")

math.randomseed(os.time())

local gemDropConfig = {
    [2] = { min = 100, max = 200 },
    [10] = { min = 5, max = 10 },
    [542] = { min = 1, max = 100 },
}

onTileBreakCallback(function(world, player, tile)
    local tileID = tile:getTileID()
    local config = gemDropConfig[tileID]

    if config then
        local dropAmount = math.random(config.min, config.max)
        world:spawnGems(tile:getPosX(), tile:getPosY(), dropAmount, player)
        return false
    end

    return false
end)

### File: QuantumSuperBroadcast.lua
print("(Loaded) Quantum Super Broadcast Script for GrowSoft")

local Roles = {
    ROLE_DEVELOPER = 51,
}

local qsbCommand = {
    command = "qsb",
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Broadcast a message to all online players."
}

registerLuaCommand(qsbCommand)

onPlayerCommandCallback(function(world, player, fullCommand)
    local command, message = fullCommand:match("^(%S+)%s*(.*)")

    if command == qsbCommand.command then
        if not player:hasRole(qsbCommand.roleRequired) then
            player:onConsoleMessage("`4Unknown command. `oEnter /? for a list of valid commands.")
            return true
        end

        if message and message ~= "" then
            local count = 0
            for _, p in ipairs(getServerPlayers()) do
                if p:getOnlineStatus() then
                    p:onTextOverlay("`2Developer Broadcast: `w" .. message)
                    count = count + 1
                end
            end
            player:onConsoleMessage("`2Broadcast sent to " .. count .. " player(s).")
        else
            player:onConsoleMessage("`4Invalid Input")
        end
        return true
    end

    return false
end)

### File: PayServerToken.lua
print("(Loaded) Pay Server Token Script for GrowSoft")

local serverTokenID = 20234

local payTokenCommand = {
    command = "paytoken",
    roleRequired = 0,
    description = "Send Premium WL to another player."
}

registerLuaCommand(payTokenCommand)

local function findPlayerByNameInsensitive(inputName)
    local target = string.lower(inputName)
    for _, p in ipairs(getServerPlayers()) do
        if string.lower(p:getCleanName()) == target then
            return p
        end
    end
    return nil
end

onPlayerCommandCallback(function(world, player, fullCommand)
    local command, args = fullCommand:match("^(%S+)%s*(.*)$")
    if command ~= payTokenCommand.command then return false end

    local targetName, amountStr = args:match("^(%S+)%s+(%S+)$")
    if not targetName or not amountStr then
        player:onConsoleMessage("Usage: /" .. command .. " <playerName> <amount>")
        player:playAudio("thwoop.wav")
        return true
    end

    local amount = tonumber(amountStr)
    if not amount or amount <= 0 then
        player:onConsoleMessage("Invalid amount. Must be a positive number.")
        player:onTextOverlay("`4Failed")
        player:playAudio("bleep_fail.wav")
        return true
    end

    local target = findPlayerByNameInsensitive(targetName)
    if not target then
        player:onConsoleMessage("Player '" .. targetName .. "' not found or not online.")
        player:onTextOverlay("`4Failed")
        player:playAudio("bleep_fail.wav")
        return true
    end

    if target:getUserID() == player:getUserID() then 
        player:onConsoleMessage("You laugh nervously as you try to give " .. getItem(serverTokenID):getName() .. " to yourself!")
        player:onTextOverlay("`4Failed")
        player:playAudio("bleep_fail.wav")
        return true
    end

    if command == paypwlCommand.command then

        if player:getCoins() < amount then
            player:onConsoleMessage("You don't have enough " .. getItem(serverTokenID):getName() .. "!")
            player:onTextOverlay("`4Failed")
            player:playAudio("bleep_fail.wav")
            return true
        end

        player:removeCoins(amount, 0)
        player:onConsoleMessage("You gave " .. amount .. " " .. getItem(serverTokenID):getName() ..  " to " .. target:getName() .. "!")
        player:onConsoleMessage(player:getCoins() .. " " .. getItem(serverTokenID):getName() .. " left.")
        player:onTextOverlay("`2Success")
        player:playAudio("coin_flip.wav")

        target:addCoins(amount)
        target:onConsoleMessage("Player " .. player:getName() .. " gave you " .. amount .. " " .. getItem(serverTokenID):getName() .. "!")
        target:onConsoleMessage("You now have " .. target:getCoins() .. " " .. getItem(serverTokenID):getName() .. " in total.")
        target:playAudio("cash_register.wav")
    end

    return true
end)

### File: ServerLockdown.lua
print("(Loaded) Server Lockdown Script for GrowSoft")

local SERVER_LOCKDOWN_KEY = "SERVER_LOCKDOWN_" .. getServerID()

-- Countdown (Editable)
local countdownDuration = 30

local Roles = {
    ROLE_DEVELOPER = 51,
}

local isLockDown = false
local countdownActive = false
local countdownStartTime = 0
local lastAnnouncedSecond = -1
local initialAnnounced = false

local savedData = loadDataFromServer(SERVER_LOCKDOWN_KEY)
if savedData and type(savedData) == "table" and savedData.locked ~= nil then
    isLockDown = savedData.locked
end

local function broadcast(msg)
    for _, p in pairs(getServerPlayers()) do
        p:sendVariant({ "OnConsoleMessage", msg })
    end
end

local function formatTime(seconds)
    if seconds >= 60 then
        local mins = math.floor(seconds / 60)
        return mins .. " minute" .. (mins > 1 and "s" or "")
    else
        return seconds .. " second" .. (seconds ~= 1 and "s" or "")
    end
end

local function startLockdownCountdown(player)
    if countdownActive then
        player:sendVariant({ "OnConsoleMessage", "`oLockdown countdown already running." })
        return
    end

    countdownActive = true
    countdownStartTime = os.time()
    lastAnnouncedSecond = -1
    initialAnnounced = false

    broadcast("`4Server Lockdown will begin in " .. formatTime(countdownDuration) .. "!")
end

local function enforceLockdown()
    isLockDown = true
    saveDataToServer(SERVER_LOCKDOWN_KEY, { locked = true })

    for _, p in pairs(getServerPlayers()) do
        if not p:hasRole(Roles.ROLE_DEVELOPER) then
            p:sendVariant({ "OnConsoleMessage", "`4Time to rest! Server Lockdown is now active. You have been disconnected." })
            p:disconnect()
        else
            p:sendVariant({ "OnConsoleMessage", "`2Server Lockdown is now ENABLED." })
        end
    end
end

onTick(function()
    if not countdownActive then return end

    local now = os.time()
    local elapsed = now - countdownStartTime
    local remaining = countdownDuration - elapsed

    if remaining <= 0 then
        countdownActive = false
        enforceLockdown()
        return
    end

    local shouldAnnounce = false
    if remaining <= 10 then
        shouldAnnounce = true
    elseif remaining <= 60 and remaining % 10 == 0 then
        shouldAnnounce = true
    elseif remaining % 60 == 0 then
        shouldAnnounce = true
    end

    if shouldAnnounce and remaining ~= lastAnnouncedSecond then
        lastAnnouncedSecond = remaining

        if not initialAnnounced then
            initialAnnounced = true
            return
        end

        broadcast("`4Server Lockdown in " .. formatTime(remaining) .. "!")
    end
end)

local lockTheServer = {
    command = "lock",
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Starts a countdown to server lockdown."
}

registerLuaCommand(lockTheServer)

onPlayerCommandCallback(function(world, player, fullCommand)
    local command, args = fullCommand:match("^(%S+)%s*(.*)")

    if command ~= lockTheServer.command then return false end

    if not player:hasRole(lockTheServer.roleRequired) then
        player:sendVariant({ "OnConsoleMessage", "`4Unknown Command!" })
        return true
    end

    if args == "now" then
        countdownActive = false
        isLockDown = true

        saveDataToServer(SERVER_LOCKDOWN_KEY, {
            locked = true
        })

        player:sendVariant({ "OnConsoleMessage", "`2Server Lockdown is ENABLED." })

        for _, p in ipairs(getServerPlayers()) do
            if not p:hasRole(Roles.ROLE_DEVELOPER) then
                p:sendVariant({ "OnConsoleMessage", "`4Server Lockdown is enabled. You have been disconnected." })
                p:disconnect()
            end
        end

        return true
    end

    if countdownActive or isLockDown then
        countdownActive = false
        isLockDown = false

        saveDataToServer(SERVER_LOCKDOWN_KEY, {
            locked = false
        })

        broadcast("Server Lockdown has been cancelled.")

        for _, z in pairs(getServerPlayers()) do
            z:playAudio("friend_beep.wav")
        end

        return true
    end

    startLockdownCountdown(player)

    for _, z in pairs(getServerPlayers()) do
        z:playAudio("realitytear.wav")
    end

    return true
end)

onPlayerLoginCallback(function(player)
    if isLockDown and not player:hasRole(Roles.ROLE_DEVELOPER) then
        player:sendVariant({ "OnConsoleMessage", "`4Time to rest! Server Lockdown is enabled. Try again later!" })
        player:disconnect()
        print(string.format("[Server Locked] Blocked login for %s (UserID: %d)", player:getName(), player:getUserID()))
    elseif isLockDown then
        player:sendVariant({ "OnConsoleMessage", "`2Server Locked" })
    end
end)

### File: OnlinePointCurrency.lua
print("(Loaded) OPC Script for GrowSoft")

-- Storage (if you want to reset data, simply change the value of KEY_STRING)
local KEY_STRING = "ONLINE_POINT_CURRENCY_SERVER_" .. getServerID()

-- Empty tables for Player Names, OPC Amounts, and Player Timers
local PLAYER_NAME_MAP = PLAYER_NAME_MAP or {}
local ONLINE_POINT_CURRENCY = {}
local playerTimers = {}

-- Market Name and Currency Name (Editable)
local marketName = "Online Point Market"
local onlinePointName = "OPC"

-- Commands (Editable)
local showDialogOPC = "opc"
local showLeaderboardOPC = "opclb"
local giveCommandOPC = "giveopc"
local removeCommandOPC = "removeopc"

-- Configuration Values (Editable)
local OPC_INTERVAL = 300
local MAX_INVENTORY = 200
local MAX_PLAYER_CHECK = 250

-- Role Values for Permissions
local Roles = { ROLE_DEFAULT = 0, ROLE_DEVELOPER = 51 }

-- Items, Amount, and Price (Editable)
local OPC_ITEMS_STARTER = {
    {itemID = 20534, amount = 1, opcRequired = 1},
    {itemID = 202, amount = 25, opcRequired = 5},
    {itemID = 204, amount = 10, opcRequired = 5},
    {itemID = 206, amount = 4, opcRequired = 5},
    {itemID = 242, amount = 1, opcRequired = 5},
    {itemID = 6140, amount = 1, opcRequired = 10},
    {itemID = 20536, amount = 1, opcRequired = 25},
    {itemID = 20538, amount = 1, opcRequired = 100},
    {itemID = 20234, amount = 1, opcRequired = 100},
}

local OPC_ITEMS_POPULAR = {
    {itemID = 4994, amount = 1, opcRequired = 250},
    {itemID = 20258, amount = 1, opcRequired = 250},
    {itemID = 20614, amount = 1, opcRequired = 500},
    {itemID = 1796, amount = 1, opcRequired = 500},
    {itemID = 9114, amount = 1, opcRequired = 500},
    {itemID = 4654, amount = 1, opcRequired = 500},
    {itemID = 20616, amount = 1, opcRequired = 750},
    {itemID = 5264, amount = 1, opcRequired = 1000},
    {itemID = 12380, amount = 1, opcRequired = 1000},
}

local OPC_ITEMS_PREMIUM = {
    {itemID = 12390, amount = 1, opcRequired = 1250},
    {itemID = 9344, amount = 1, opcRequired = 1250},
    {itemID = 1970, amount = 1, opcRequired = 1250},
    {itemID = 12388, amount = 1, opcRequired = 1500},
    {itemID = 8286, amount = 1, opcRequired = 5000},
    {itemID = 14414, amount = 1, opcRequired = 5000},
    {itemID = 7188, amount = 1, opcRequired = 50000},
    {itemID = 20628, amount = 1, opcRequired = 500000},
    {itemID = 25002, amount = 1, opcRequired = 5000000},
}

local OPC_SORTED_INDEX_MAP = {}

local function loadDatasToServer()
    local data = loadDataFromServer(KEY_STRING)
    if data then

        ONLINE_POINT_CURRENCY = {}
        PLAYER_NAME_MAP = {}

        if data.OPC and type(data.OPC) == "table" then
            ONLINE_POINT_CURRENCY = data.OPC
            print("[OPC] Loaded OPC data.")
        else
            ONLINE_POINT_CURRENCY = {}
            print("[OPC] No existing OPC data.")
        end

        if data.Names and type(data.Names) == "table" then
            PLAYER_NAME_MAP = data.Names
            print("[OPC] Loaded player name map.")
        else
            PLAYER_NAME_MAP = {}
            print("[OPC] No existing name data.")
        end
    else
        ONLINE_POINT_CURRENCY = {}
        PLAYER_NAME_MAP = {}
        print("[OPC] No existing data.")
    end
end

local function saveDatasToServer()
    saveDataToServer(KEY_STRING, { OPC = ONLINE_POINT_CURRENCY, Names = PLAYER_NAME_MAP })
    print("[OPC] Saved OPC data.")
end

local function formatTime(seconds)
    local minutes = math.floor(seconds / 60)
    local remainingSeconds = seconds % 60

    if minutes > 0 and remainingSeconds > 0 then
        return string.format("%d minute%s %d second%s", minutes, minutes ~= 1 and "s" or "", remainingSeconds, remainingSeconds ~= 1 and "s" or "")
    elseif minutes > 0 then
        return string.format("%d minute%s", minutes, minutes ~= 1 and "s" or "")
    else
        return string.format("%d second%s", remainingSeconds, remainingSeconds ~= 1 and "s" or "")
    end
end

local function findPlayerByNameInsensitive(inputName)
    local target = string.lower(inputName)
    for _, p in ipairs(getServerPlayers()) do
        if string.lower(p:getCleanName()) == target then
            return p
        end
    end
    return nil
end

local function formatNum(amount)
    local formatted = tostring(amount)
    while true do
        formatted, k = formatted:gsub("^(-?%d+)(%d%d%d)", '%1,%2')
        if k == 0 then break end
    end
    return formatted
end

registerLuaCommand({
    command = showDialogOPC,
    roleRequired = Roles.ROLE_DEFAULT,
    description = "Open OPC Dialog"
})

registerLuaCommand({
    command = giveCommandOPC,
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Give OPC to a player"
})

registerLuaCommand({
    command = removeCommandOPC,
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Remove OPC to a player"
})

registerLuaCommand({
    command = showLeaderboardOPC,
    roleRequired = Roles.ROLE_DEFAULT,
    description = "Open OPC Leaderboard Dialog"
})

local function showOPCDialog(player)
    local userId = player:getUserID()
    local opc = ONLINE_POINT_CURRENCY[userId] or 0
    local dialog = "set_bg_color|170,175,180,255|\n"
    dialog = dialog .. "set_border_color|0,192,203,255|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_label_with_icon|big|`w" .. marketName .. "|left|9474|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_custom_button|game_title|image:interface/server_1981/banner_opc.rttex;image_size:1200,260;width:1;state:disabled;|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_textbox|`7Welcome to " .. marketName .. "! Spend your hard-earned " .. onlinePointName .. " in this shop. You can earn 1 " .. onlinePointName .. " every `w" .. formatTime(OPC_INTERVAL) .. "`7 by staying online in a world.|left|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_label_with_icon|small|" .. player:getName() .. "|left|12436|\n"
    dialog = dialog .. "add_smalltext|`7Your current balance is `w" .. formatNum(opc) .. " " .. onlinePointName .. "|\n"
    dialog = dialog .. "add_spacer|big|\n"
    dialog = dialog .. "text_scaling_string|aaaaaaaaaa|\n"

    OPC_SORTED_INDEX_MAP = {}
    local buttonIndex = 1

    local function addSection(title, items, categoryName)
        if #items == 0 then return end

        dialog = dialog .. string.format("add_label_with_icon|medium|`w%s|left|7074|\n", title)
        dialog = dialog .. "add_spacer|small|\n"

        for i, item in ipairs(items) do
            OPC_SORTED_INDEX_MAP[buttonIndex] = { category = categoryName, index = i }

            local frameStyle = "staticYellowFrame"
                
            if categoryName == "starter" then
                frameStyle = "staticBlueFrame"
            elseif categoryName == "popular" then
                frameStyle = "staticPurpleFrame"
            end

            dialog = dialog .. string.format(
                "add_button_with_icon|var_%d||%s|%d|%d|left|\n",
                buttonIndex, frameStyle, item.itemID, item.opcRequired
            )

            buttonIndex = buttonIndex + 1
        end
    
        dialog = dialog .. "add_custom_break|\n"
        dialog = dialog .. "add_spacer|small|\n"
    end

    addSection("`wStarter Section", OPC_ITEMS_STARTER, "starter")
    addSection("`wPopular Section", OPC_ITEMS_POPULAR, "popular")
    addSection("`wPremium Section", OPC_ITEMS_PREMIUM, "premium")

    dialog = dialog .. "add_label_with_icon|big||left|0|\n"
    dialog = dialog .. "add_quick_exit|\n"
    dialog = dialog .. "end_dialog|opc_dialog|||\n"

    player:onDialogRequest(dialog)
end

local function showConfirmDialog(player, buttonIndex)
    local mapping = OPC_SORTED_INDEX_MAP[buttonIndex]
    if not mapping then return end

    local category, index = mapping.category, mapping.index
    local item
    if category == "starter" then
        item = OPC_ITEMS_STARTER[index]
    elseif category == "popular" then
        item = OPC_ITEMS_POPULAR[index]
    elseif category == "premium" then
        item = OPC_ITEMS_PREMIUM[index]
    end

    if not item then return end

    local userId = player:getUserID()
    local opc = ONLINE_POINT_CURRENCY[userId] or 0

    local itemDef = getItem(item.itemID)
    local name = itemDef:getName()
    local rarity = itemDef:getRarity()
    local description = itemDef:getDescription()

    local dialog = "set_bg_color|170,175,180,255|\n"
    dialog = dialog .. "set_border_color|0,192,203,255|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_label_with_icon|big|`wConfirm Purchase|left|6292|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_smalltext|`wName: `7" .. name .. "|\n"
    dialog = dialog .. "add_smalltext|`wAmount: `7" .. item.amount .. "|\n"
    dialog = dialog .. "add_smalltext|`wPrice: `7" .. formatNum(item.opcRequired) .. " " .. onlinePointName .. "|\n"
    dialog = dialog .. (rarity == 999 and "add_smalltext|`wRarity: `7No rarity|\n" or "add_smalltext|`wRarity: `7" .. rarity .. "|\n")
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_label_with_icon|big||left|" .. item.itemID .. "|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_smalltext|`wItem Description:|\n"
    dialog = dialog .. "add_smalltext|`7" .. description .. "|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_smalltext|`w(Current balance: " .. formatNum(opc) .. " " .. onlinePointName .. ")|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. string.format("add_custom_button|confirm_opc_buy_%d|textLabel:`wPurchase for %s %s|\n", buttonIndex, formatNum(item.opcRequired), onlinePointName)
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|back_to_main|`wBack|\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_label_with_icon|big||left|0|\n"
    dialog = dialog .. "add_quick_exit|\n"
    player:onDialogRequest(dialog)
end

local function showOPCLeaderboard(player)
    local leaderboard = {}

    for userId = 1, MAX_PLAYER_CHECK do
        local opc = ONLINE_POINT_CURRENCY[userId]

        if opc == nil then
            goto continue
        end

        table.insert(leaderboard, { userId = userId, opc = opc })

        ::continue::
    end

    table.sort(leaderboard, function(a, b)
        return a.opc > b.opc
    end)

    local dialog = "set_default_color|`o\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_label_with_icon|big|`w" .. onlinePointName .. " Leaderboard   |left|15076|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_smalltext|`oShowing top " .. math.min(25, #leaderboard) .. " players|\n"
    dialog = dialog .. "add_spacer|small|\n"

    for i = 1, math.min(25, #leaderboard) do
        local entry = leaderboard[i]
        local name = PLAYER_NAME_MAP[entry.userId] or ("UserID " .. entry.userId)

        dialog = dialog .. string.format("add_textbox|`w#%d `o%s `w- %d %s|left|\n", i, name, entry.opc, onlinePointName)
    end

    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "end_dialog|opc_lb_dialog||Close|\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_label_with_icon|big||left|0|\n"

    player:onDialogRequest(dialog)
end

onPlayerCommandCallback(function(world, player, fullCommand)
    local args = {}
    for word in fullCommand:gmatch("%S+") do
        table.insert(args, word)
    end

    local cmd = args[1]

    if cmd == showDialogOPC then
        showOPCDialog(player)
        player:playAudio("spell1.wav")
        return true
    end

    if cmd == showLeaderboardOPC then
        showOPCLeaderboard(player)
        player:playAudio("spell1.wav")
        return true
    end

    if (cmd == giveCommandOPC or cmd == removeCommandOPC) and player:hasRole(Roles.ROLE_DEVELOPER) then
        local targetName = args[2]
        local amount = tonumber(args[3] or "")

        if not targetName or not amount then
            player:onConsoleMessage("Usage: /" .. cmd .. " <playerName> <amount>")
            return true
        end

        local target = findPlayerByNameInsensitive(targetName)
        if not target then
            player:onConsoleMessage("`4Player '" .. targetName .. "' not found or not online.")
            return true
        end

        local targetId = target:getUserID()
        if not targetId then
            player:onConsoleMessage("`4Failed to get user ID for " .. target:getName() .. ".")
            return true
        end

        ONLINE_POINT_CURRENCY[targetId] = ONLINE_POINT_CURRENCY[targetId] or 0

        if cmd == giveCommandOPC then
            ONLINE_POINT_CURRENCY[targetId] = ONLINE_POINT_CURRENCY[targetId] + amount
            player:onConsoleMessage("`2Gave " .. amount .. " " .. onlinePointName .. " to " .. target:getName() .. "!")
            target:onConsoleMessage("`2You received " .. amount .. " " .. onlinePointName .. " from a Developer!")
            target:playAudio("gauntlet_spawn.wav");
            player:playAudio("gauntlet_spawn.wav");
        else
            ONLINE_POINT_CURRENCY[targetId] = math.max(0, ONLINE_POINT_CURRENCY[targetId] - amount)
            player:onConsoleMessage("`4Removed " .. amount .. " " .. onlinePointName .. " from " .. target:getName() .. "!")
            target:onConsoleMessage("`4A Developer removed " .. amount .. " " .. onlinePointName .. " from your balance!")
            target:playAudio("gauntlet_spawn.wav");
            player:playAudio("gauntlet_spawn.wav");
        end

        saveDatasToServer()
        return true
    end

    return false
end)

onPlayerDialogCallback(function(world, player, data)
    local dialogName = data["dialog_name"] or ""
    local buttonClicked = data["buttonClicked"] or ""

    if dialogName == "opc_dialog" then
        local index = tonumber(buttonClicked:match("^var_(%d+)$"))
        if index then
            showConfirmDialog(player, index)
            return true
        end
    end

    if dialogName == "confirm_opc_dialog" and buttonClicked == "back_to_main" then
        showOPCDialog(player)
        return true
    end

    if dialogName == "confirm_opc_dialog" and buttonClicked:find("confirm_opc_buy_") then
        local buttonIndex = tonumber(buttonClicked:match("confirm_opc_buy_(%d+)"))
        if not buttonIndex then return true end

        local mapping = OPC_SORTED_INDEX_MAP[buttonIndex]
        if not mapping then return true end

        local category, index = mapping.category, mapping.index
        local item
        if category == "starter" then
            item = OPC_ITEMS_STARTER[index]
        elseif category == "popular" then
            item = OPC_ITEMS_POPULAR[index]
        elseif category == "premium" then
            item = OPC_ITEMS_PREMIUM[index]
        end

        if not item then return true end

        local userId = player:getUserID()
        local opc = ONLINE_POINT_CURRENCY[userId] or 0

        if opc < item.opcRequired then
            player:onTalkBubble(player:getNetID(), "`4Not enough " .. onlinePointName .. "!", 0)
            player:onConsoleMessage("Not enough " .. onlinePointName .. "!")
            player:playAudio("bleep_fail.wav")
            return true
        end

        if player:getItemAmount(item.itemID) + item.amount > MAX_INVENTORY then
            player:onTalkBubble(player:getNetID(), "`4Not enough inventory space!", 0)
            player:onConsoleMessage("Not enough inventory space!")
            player:playAudio("bleep_fail.wav")
            return true
        end

        ONLINE_POINT_CURRENCY[userId] = opc - item.opcRequired
        player:changeItem(item.itemID, item.amount, 0)
        saveDatasToServer()

        player:onTalkBubble(player:getNetID(), "`2Transaction complete!", 0)
        player:onConsoleMessage("Bought " .. getItem(item.itemID):getName() .. " for " .. item.opcRequired .. " " .. onlinePointName .. "!")
        world:useItemEffect(player:getNetID(), item.itemID, 0, 100)
        player:playAudio("piano_nice.wav")
        showOPCDialog(player)
        return true
    end

    return false
end)

local function startPlayerTimer(player)
    local userId = player:getUserID()
    local now = os.time()

    if not playerTimers[userId] then
        playerTimers[userId] = { accumulatedSeconds = 0, lastTick = now, active = true }
    else
        playerTimers[userId].lastTick = now
        playerTimers[userId].active = true
    end

    if ONLINE_POINT_CURRENCY[userId] == nil then
        ONLINE_POINT_CURRENCY[userId] = 0
    end
end

local function pausePlayerTimer(player)
    local userId = player:getUserID()
    if playerTimers[userId] then
        playerTimers[userId].active = false
    end
end

local function resetPlayerTimer(player)
    local userId = player:getUserID()
    playerTimers[userId] = nil
end

onPlayerEnterWorldCallback(function(world, player)
    startPlayerTimer(player)
end)

onPlayerLeaveWorldCallback(function(world, player)
    pausePlayerTimer(player)
end)

onPlayerDisconnectCallback(function(player)
    resetPlayerTimer(player)
end)

onWorldTick(function(world)
    local now = os.time()
    for userId, timer in pairs(playerTimers) do
        if timer.active then
            local elapsed = now - timer.lastTick
            if elapsed > 0 then
                timer.accumulatedSeconds = (timer.accumulatedSeconds or 0) + elapsed
                timer.lastTick = now

                while timer.accumulatedSeconds >= OPC_INTERVAL do
                    timer.accumulatedSeconds = timer.accumulatedSeconds - OPC_INTERVAL
                    ONLINE_POINT_CURRENCY[userId] = (ONLINE_POINT_CURRENCY[userId] or 0) + 1
                    for _, p in ipairs(getServerPlayers()) do
                        if p:getUserID() == userId then
                            p:onConsoleMessage("`2+1 " .. onlinePointName .. " ")
                            p:playAudio("bell.wav")
                            break
                        end
                    end

                    saveDatasToServer()
                end
            end
        else
            timer.lastTick = now
        end
    end
end)

loadDatasToServer()

for _, player in ipairs(getServerPlayers()) do
    startPlayerTimer(player)
end

onPlayerLoginCallback(function(player)
    local userID = player:getUserID()
    local name = tostring(player:getName())
    PLAYER_NAME_MAP[userID] = name
    saveDatasToServer()
end)

### File: PbzPanels.lua
print("(Loaded) Paboz Management Panel by Paboz")

--[[
    This script is a consolidation of three scripts by Paboz:
    1. Starter-pack Editor
    2. Item Bonus Drop Manager
    3. Block Manager

    Version 9: Refactored role managemllllent into a 'Roles' table and updated command registration format as requested.
]]

-- ===================================================================
-- 1. CONFIGURATION & DATA LOADING
-- ===================================================================

math.randomseed(os.time())

-- NEW: Central table for role management
local Roles = {
    DEVELOPER = 51
}

-- Central table for all server data keys.
local SaveKeys = {
    STARTER_PACK = "PABOZ_PANEL_STARTER_PACK",
    ITEM_BONUS   = "PABOZ_PANEL_ITEM_BONUS",
    BLOCK_DROPS  = "PABOZ_PANEL_BLOCK_DROPS",
    GEM_DROPS    = "PABOZ_PANEL_GEM_DROPS"
}

-- Load data for all modules using the SaveKeys table
local starterItems = loadDataFromServer(SaveKeys.STARTER_PACK) or {}
local clothingDropBonus = loadDataFromServer(SaveKeys.ITEM_BONUS) or {}
local PbzMD_drops = loadDataFromServer(SaveKeys.BLOCK_DROPS) or {}
local gemDropConfig_PbzMD = loadDataFromServer(SaveKeys.GEM_DROPS) or {}

-- Default values
local starterGems = 100000
local starterRole = 0

-- ===================================================================
-- 2. HELPER & SAVE FUNCTIONS
-- ===================================================================

-- Generic helper to check drop chance
local function shouldDrop(chance)
    return (math.random() * 100) <= chance
end

-- Generic helper to check if an item ID is valid
local function validateItemID(itemID)
    return getItem(itemID) ~= nil
end

-- --- Module-specific save functions (using SaveKeys) ---
local function saveStarterPackData()
    saveDataToServer(SaveKeys.STARTER_PACK, starterItems)
end

local function saveItemBonusData()
    saveDataToServer(SaveKeys.ITEM_BONUS, clothingDropBonus)
end

local function saveBlockManagerItemDrops()
    saveDataToServer(SaveKeys.BLOCK_DROPS, PbzMD_drops)
end

local function saveBlockManagerGemDrops()
    saveDataToServer(SaveKeys.GEM_DROPS, gemDropConfig_PbzMD)
end


-- ===================================================================
-- 3. DIALOG DEFINITIONS
-- ===================================================================

-- --- Main Panel Dialog ---
local function showMainPanelDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "set_button_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_label_with_icon|big|`wPaboz Management Panel|left|32|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_textbox|`oThis script proudly presented by:`9@Paboz_A3`o|\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|starter_pack|`wStarter Pack Manager|\n"
    dialog = dialog .. "add_button|item_bonus|`wItem Bonus Drop Manager|\n"
    dialog = dialog .. "add_button|block_manager|`wBlock Manager|\n"
    dialog = dialog .. "add_quick_exit|\n"
    dialog = dialog .. "end_dialog|main_panel|Close||\n"
    player:onDialogRequest(dialog)
end

-- --- Starter Pack Dialogs ---
local function showStarterPackDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_label_with_icon|big|`wConfigure Starter Pack|left|32|\n"
    dialog = dialog .. "add_spacer|small|\n"
    if #starterItems == 0 then
        dialog = dialog .. "add_textbox|`o(`4No starter items configured`o)`o|\n"
    else
        for i, item in ipairs(starterItems) do
            local itemName = getItem(item.itemID) and getItem(item.itemID):getName() or "Unknown Item"
            dialog = dialog .. "add_button_with_icon|remove_item_" .. item.itemID .. "||yellowframe|" .. item.itemID .. "|" .. itemName .. " (x" .. item.itemCount .. ")|left|\n"
        end
        dialog = dialog .. "add_spacer|small|\n"
        dialog = dialog .. "add_textbox|`o(Tap an item to remove it)`o|\n"
    end
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|add_item|`wAdd Item|\n"
    dialog = dialog .. "add_button|back_to_main|`wBack to Main Panel|\n"
    dialog = dialog .. "add_quick_exit|\n"
    dialog = dialog .. "end_dialog|starter_pack_main|Close||\n"
    player:onDialogRequest(dialog)
end

local function showStarterPack_AddItemDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_label_with_icon|big|`wAdd Item to Starter Pack|left|32|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_text_input|item_id|Item ID:||5|numeric|left|\n"
    dialog = dialog .. "add_text_input|item_count|Item Count:||3|numeric|left|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|add_item_confirm|`wAdd Item|\n"
    dialog = dialog .. "add_button|back_to_starter_pack|`wBack|\n"
    dialog = dialog .. "end_dialog|starter_pack_add_item|Close||\n"
    player:onDialogRequest(dialog)
end

-- --- Item Bonus Drop Dialogs ---
local function showItemBonusDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_label_with_icon|big|`wItem Bonus Drop Editor|left|32||\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|add_new|Add New Bonus Drop|left|\n"
    dialog = dialog .. "add_button|remove_existing|View/Remove Existing Drops|left|\n"
    dialog = dialog .. "add_button|back_to_main|`wBack to Main Panel|\n"
    dialog = dialog .. "add_quick_exit|\n"
    dialog = dialog .. "end_dialog|item_bonus_main|Close||\n"
    player:onDialogRequest(dialog)
end

local function showItemBonus_AddNewDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_label_with_icon|big|`wAdd New Item Bonus Drop|left|32||\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_textbox|`0Hat=0 Shirt=1 Pants=2 Feet=3 Face=4 Hand=5 Back=6 Hair=7 Neck=8 Ances=9|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_text_input|clothing_type|Clothing Type (0-9):||3|numeric|left|\n"
    dialog = dialog .. "add_text_input|clothing_item_id|Clothing Item ID:||5|numeric|left|\n"
    dialog = dialog .. "add_text_input|drop_id|Drop Item ID:||5|numeric|left|\n"
    dialog = dialog .. "add_text_input|amount|Amount (1-99):||2|numeric|left|\n"
    dialog = dialog .. "add_text_input|chance|Chance (1-100%):||3|numeric|left|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|save|Save Bonus Drop|left|\n"
    dialog = dialog .. "add_button|back_to_item_bonus|`wBack|\n"
    dialog = dialog .. "end_dialog|item_bonus_add_new|Close||\n"
    player:onDialogRequest(dialog)
end

local function showItemBonus_RemoveDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_label_with_icon|big|`wExisting Bonus Drops|left|32||\n"
    dialog = dialog .. "add_spacer|small|\n"
    local hasEffects = false
    for cType, bonuses in pairs(clothingDropBonus) do
        for cItemID, dropsList in pairs(bonuses) do
            local clothingName = getItem(cItemID) and getItem(cItemID):getName() or "Unknown"
            for i, drop in ipairs(dropsList) do
                hasEffects = true
                local dropName = getItem(drop.dropID) and getItem(drop.dropID):getName() or "Unknown"
                dialog = dialog .. "add_button|remove_" .. cType .. "_" .. cItemID .. "_" .. i .. "|`4Remove``: " .. dropName .. " (" .. drop.chance .. "%) from " .. clothingName .. "|left|\n"
            end
        end
    end
    if not hasEffects then
        dialog = dialog .. "add_textbox|`o(`4No bonus drop effects configured`o)`o|\n"
    end
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|back_to_item_bonus|`wBack|\n"
    dialog = dialog .. "end_dialog|item_bonus_remove|Close||\n"
    player:onDialogRequest(dialog)
end

-- --- Block Manager Dialogs ---
local function showBlockManagerDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_label_with_icon|big|`wBlock Manager|left|14824||\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|set_item_drops|Set Custom Item Drops|left|\n"
    dialog = dialog .. "add_button|set_gem_drops|Set Custom Gem Drops|left|\n"
    dialog = dialog .. "add_button|view_existing_drops|View/Remove Existing Drops|left|\n"
    dialog = dialog .. "add_button|back_to_main|`wBack to Main Panel|\n"
    dialog = dialog .. "add_quick_exit|\n"
    dialog = dialog .. "end_dialog|block_manager_main|Close||\n"
    player:onDialogRequest(dialog)
end

local function showBlockManager_SetItemDropsDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_label_with_icon|big|`wSet Item Drop|left|14824||\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_text_input|block_id|Block ID:|1|5|numeric|left|\n"
    dialog = dialog .. "add_text_input|drop_id|Item ID to Drop:|1|5|numeric|left|\n"
    dialog = dialog .. "add_text_input|amount|Amount (1-200):|1|3|numeric|left|\n"
    dialog = dialog .. "add_text_input|chance|Chance (0.01-100%):|1|6|float|left|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|add_drop|Add Drop|left|\n"
    dialog = dialog .. "add_button|back_to_block_manager|`wBack|\n"
    dialog = dialog .. "end_dialog|block_manager_set_item|Close||\n"
    player:onDialogRequest(dialog)
end

local function showBlockManager_SetGemDropsDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_label_with_icon|big|`wSet Gem Drop|left|14544||\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_text_input|block_id|Block ID:|1|5|numeric|left|\n"
    dialog = dialog .. "add_text_input|gem_min|Min Gems:|1|5|numeric|left|\n"
    dialog = dialog .. "add_text_input|gem_max|Max Gems:|1|5|numeric|left|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|save|Save Gem Drop|left|\n"
    dialog = dialog .. "add_button|back_to_block_manager|`wBack|\n"
    dialog = dialog .. "end_dialog|block_manager_set_gem|Close||\n"
    player:onDialogRequest(dialog)
end

local function showBlockManager_ViewExistingDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_label_with_icon|big|`wExisting Block Drops|left|448||\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_label|medium|`wItem Drops|left|\n"
    if next(PbzMD_drops) == nil then
        dialog = dialog .. "add_label|small|`o(`4No custom item drops`o)|left|\n"
    else
        for block_id, dropsList in pairs(PbzMD_drops) do
            local blockName = getItem(block_id) and getItem(block_id):getName() or "Unknown"
            dialog = dialog .. "add_label_with_icon|small|`w" .. blockName .. " (" .. block_id .. ")|left|" .. block_id .. "||\n"
            for i, drop in ipairs(dropsList) do
                local dropName = getItem(drop.dropID) and getItem(drop.dropID):getName() or "Unknown"
                dialog = dialog .. "add_button|remove_item_drop_" .. block_id .. "_" .. i .. "|`4Remove`` " .. dropName .. " (x" .. drop.amount .. ", " .. drop.chance .. "%)|left|\n"
            end
        end
    end
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_label|medium|`wGem Drops|left|\n"
    if next(gemDropConfig_PbzMD) == nil then
        dialog = dialog .. "add_label|small|`o(`4No custom gem drops`o)|left|\n"
    else
        for block_id, config in pairs(gemDropConfig_PbzMD) do
            local blockName = getItem(block_id) and getItem(block_id):getName() or "Unknown"
            dialog = dialog .. "add_label_with_icon|small|`w" .. blockName .. " (" .. block_id .. ")|left|" .. block_id .. "||\n"
            dialog = dialog .. "add_button|remove_gem_drop_" .. block_id .. "|`4Remove`` Min: " .. config.min .. ", Max: " .. config.max .. "|left|\n"
        end
    end
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_button|back_to_block_manager|`wBack|\n"
    dialog = dialog .. "end_dialog|block_manager_view|Close||\n"
    player:onDialogRequest(dialog)
end


-- ===================================================================
-- 4. COMMAND REGISTRATION & HANDLER
-- ===================================================================

-- UPDATED: Command definition now uses the Roles table
local managementCommand = {
    command = "pbz",
    roleRequired = Roles.DEVELOPER,
    description = "Open the Paboz Management Panel"
}
registerLuaCommand(managementCommand)

onPlayerCommandCallback(function(world, player, fullCommand)
    local command = fullCommand:match("^(%S+)")
    if command == managementCommand.command then
        if player:hasRole(managementCommand.roleRequired) then
            showMainPanelDialog(player)
        else
            player:onConsoleMessage("`4Unknown command.")
        end
        return true
    end
    return false
end)

-- ===================================================================
-- 5. DIALOG CALLBACK (Main Handler with CORRECTED Error Handling)
-- ===================================================================

onPlayerDialogCallback(function(world, player, data)
    -- UPDATED: Permission check now uses the Roles table
    if not player:hasRole(Roles.DEVELOPER) then
        return
    end

    local dialogName = data["dialog_name"]
    local button = data["buttonClicked"]

    -- Handle common "back" buttons first
    if button == "back_to_main" then
        showMainPanelDialog(player)
        return
    elseif button == "back_to_starter_pack" then
        showStarterPackDialog(player)
        return
    elseif button == "back_to_item_bonus" then
        showItemBonusDialog(player)
        return
    elseif button == "back_to_block_manager" then
        showBlockManagerDialog(player)
        return
    end

    -- Main handler logic in a single if/elseif chain
    if dialogName == "main_panel" then
        if button == "starter_pack" then
            showStarterPackDialog(player)
        elseif button == "item_bonus" then
            showItemBonusDialog(player)
        elseif button == "block_manager" then
            showBlockManagerDialog(player)
        end
    elseif dialogName == "starter_pack_main" then
        if button == "add_item" then
            showStarterPack_AddItemDialog(player)
        elseif button:match("^remove_item_") then
            local itemID = tonumber(button:match("^remove_item_(%d+)"))
            for i, item in ipairs(starterItems) do
                if item.itemID == itemID then
                    table.remove(starterItems, i)
                    saveStarterPackData()
                    player:onConsoleMessage("`2Item removed from starter pack.`o")
                    showStarterPackDialog(player)
                    break
                end
            end
        end
    elseif dialogName == "starter_pack_add_item" then
        if button == "add_item_confirm" then
            local raw_itemID = data["item_id"]
            local raw_itemCount = data["item_count"]
            if not raw_itemID or raw_itemID == "" then
                player:onConsoleMessage("`4Error: Item ID field cannot be empty.`o")
                return
            end
            if not raw_itemCount or raw_itemCount == "" then
                player:onConsoleMessage("`4Error: Item Count field cannot be empty.`o")
                return
            end
            local itemID = tonumber(raw_itemID)
            local itemCount = tonumber(raw_itemCount)
            if not itemID then
                player:onConsoleMessage("`4Error: Item ID must be a number.`o")
                return
            end
            if not itemCount then
                player:onConsoleMessage("`4Error: Item Count must be a number.`o")
                return
            end
            if itemCount <= 0 then
                player:onConsoleMessage("`4Error: Item Count must be greater than zero.`o")
                return
            end
            if not validateItemID(itemID) then
                player:onConsoleMessage("`4Error: Invalid Item ID. Item " .. itemID .. " does not exist.`o")
                return
            end
            table.insert(starterItems, {itemID = itemID, itemCount = itemCount})
            saveStarterPackData()
            player:onConsoleMessage("`2Item added to starter pack!`o")
            showStarterPackDialog(player)
        end
    elseif dialogName == "item_bonus_main" then
        if button == "add_new" then
            showItemBonus_AddNewDialog(player)
        elseif button == "remove_existing" then
            showItemBonus_RemoveDialog(player, clothingDropBonus)
        end
    elseif dialogName == "item_bonus_add_new" then
        if button == "save" then
            local raw_cType, raw_cItemID, raw_dropID, raw_amount, raw_chance = data["clothing_type"], data["clothing_item_id"], data["drop_id"], data["amount"], data["chance"]
            if not raw_cType or raw_cType == "" then
                player:onConsoleMessage("`4Error: Clothing Type field cannot be empty.`o")
                return
            end
            if not raw_cItemID or raw_cItemID == "" then
                player:onConsoleMessage("`4Error: Clothing Item ID field cannot be empty.`o")
                return
            end
            if not raw_dropID or raw_dropID == "" then
                player:onConsoleMessage("`4Error: Drop Item ID field cannot be empty.`o")
                return
            end
            if not raw_amount or raw_amount == "" then
                player:onConsoleMessage("`4Error: Amount field cannot be empty.`o")
                return
            end
            if not raw_chance or raw_chance == "" then
                player:onConsoleMessage("`4Error: Chance field cannot be empty.`o")
                return
            end
            
            local cType, cItemID, dropID, amount, chance = tonumber(raw_cType), tonumber(raw_cItemID), tonumber(raw_dropID), tonumber(raw_amount), tonumber(raw_chance)
            if not cType then
                player:onConsoleMessage("`4Error: Clothing Type must be a number.`o")
                return
            end
            if not cItemID then
                player:onConsoleMessage("`4Error: Clothing Item ID must be a number.`o")
                return
            end
            if not dropID then
                player:onConsoleMessage("`4Error: Drop Item ID must be a number.`o")
                return
            end
            if not amount then
                player:onConsoleMessage("`4Error: Amount must be a number.`o")
                return
            end
            if not chance then
                player:onConsoleMessage("`4Error: Chance must be a number.`o")
                return
            end
            
            if cType < 0 or cType > 9 then
                player:onConsoleMessage("`4Error: Clothing Type must be between 0 and 9.`o")
                return
            end
            if amount <= 0 then
                player:onConsoleMessage("`4Error: Amount must be greater than zero.`o")
                return
            end
            if chance <= 0 then
                player:onConsoleMessage("`4Error: Chance must be greater than zero.`o")
                return
            end
            
            if not validateItemID(cItemID) or not validateItemID(dropID) then
                player:onConsoleMessage("`4Error: One of the Item IDs is invalid.`o")
                return
            end
            clothingDropBonus[cType] = clothingDropBonus[cType] or {}
            clothingDropBonus[cType][cItemID] = clothingDropBonus[cType][cItemID] or {}
            table.insert(clothingDropBonus[cType][cItemID], {dropID = dropID, amount = amount, chance = chance})
            saveItemBonusData()
            player:onConsoleMessage("`2Bonus drop effect added successfully!`o")
            showItemBonusDialog(player)
        end
    elseif dialogName == "item_bonus_remove" then
        if button:match("^remove_") then
            local cType, cItemID, index = button:match("^remove_(%d+)_(%d+)_(%d+)$")
            cType, cItemID, index = tonumber(cType), tonumber(cItemID), tonumber(index)
            if clothingDropBonus[cType] and clothingDropBonus[cType][cItemID] and clothingDropBonus[cType][cItemID][index] then
                table.remove(clothingDropBonus[cType][cItemID], index)
                if #clothingDropBonus[cType][cItemID] == 0 then clothingDropBonus[cType][cItemID] = nil end
                if clothingDropBonus[cType] and next(clothingDropBonus[cType]) == nil then clothingDropBonus[cType] = nil end
                saveItemBonusData()
                player:onConsoleMessage("`2Bonus effect removed.`o")
                showItemBonus_RemoveDialog(player)
            end
        end
    elseif dialogName == "block_manager_main" then
        if button == "set_item_drops" then
            showBlockManager_SetItemDropsDialog(player)
        elseif button == "set_gem_drops" then
            showBlockManager_SetGemDropsDialog(player)
        elseif button == "view_existing_drops" then
            showBlockManager_ViewExistingDialog(player)
        end
    elseif dialogName == "block_manager_set_item" then
        if button == "add_drop" then
            local raw_block_id, raw_dropid, raw_amount, raw_chance = data["block_id"], data["dropid"], data["amount"], data["chance"]
            if not raw_block_id or raw_block_id == "" then
                player:onConsoleMessage("`4Error: Block ID field cannot be empty.`o")
                return
            end
            if not raw_dropid or raw_dropid == "" then
                player:onConsoleMessage("`4Error: Item ID field cannot be empty.`o")
                return
            end
            if not raw_amount or raw_amount == "" then
                player:onConsoleMessage("`4Error: Amount field cannot be empty.`o")
                return
            end
            if not raw_chance or raw_chance == "" then
                player:onConsoleMessage("`4Error: Chance field cannot be empty.`o")
                return
            end
            
            local block_id, dropid, amount, chance = tonumber(raw_block_id), tonumber(raw_dropid), tonumber(raw_amount), tonumber(raw_chance)
            if not block_id then
                player:onConsoleMessage("`4Error: Block ID must be a number.`o")
                return
            end
            if not dropid then
                player:onConsoleMessage("`4Error: Item ID must be a number.`o")
                return
            end
            if not amount then
                player:onConsoleMessage("`4Error: Amount must be a number.`o")
                return
            end
            if not chance then
                player:onConsoleMessage("`4Error: Chance must be a number.`o")
                return
            end

            if amount <= 0 then
                player:onConsoleMessage("`4Error: Amount must be greater than zero.`o")
                return
            end
            if chance <= 0 then
                player:onConsoleMessage("`4Error: Chance must be greater than zero.`o")
                return
            end
            
            if not validateItemID(block_id) or not validateItemID(dropID) then
                player:onConsoleMessage("`4Error: Invalid Block ID or Item ID.`o")
                return
            end
            PbzMD_drops[block_id] = PbzMD_drops[block_id] or {}
            table.insert(PbzMD_drops[block_id], {dropID = dropid, amount = amount, chance = chance})
            saveBlockManagerItemDrops()
            player:onConsoleMessage("`2Item drop added for " .. getItem(block_id):getName() .. "`o")
            showBlockManagerDialog(player)
        end
    elseif dialogName == "block_manager_set_gem" then
        if button == "save" then
            local raw_block_id, raw_gem_min, raw_gem_max = data["block_id"], data["gem_min"], data["gem_max"]
            if not raw_block_id or raw_block_id == "" then
                player:onConsoleMessage("`4Error: Block ID field cannot be empty.`o")
                return
            end
            if not raw_gem_min or raw_gem_min == "" then
                player:onConsoleMessage("`4Error: Min Gems field cannot be empty.`o")
                return
            end
            if not raw_gem_max or raw_gem_max == "" then
                player:onConsoleMessage("`4Error: Max Gems field cannot be empty.`o")
                return
            end

            local block_id, gem_min, gem_max = tonumber(raw_block_id), tonumber(raw_gem_min), tonumber(raw_gem_max)
            if not block_id then
                player:onConsoleMessage("`4Error: Block ID must be a number.`o")
                return
            end
            if not gem_min then
                player:onConsoleMessage("`4Error: Min Gems must be a number.`o")
                return
            end
            if not gem_max then
                player:onConsoleMessage("`4Error: Max Gems must be a number.`o")
                return
            end
            
            if gem_min <= 0 then
                player:onConsoleMessage("`4Error: Min Gems must be greater than zero.`o")
                return
            end
            if gem_max <= 0 then
                player:onConsoleMessage("`4Error: Max Gems must be greater than zero.`o")
                return
            end

            if not validateItemID(block_id) then
                player:onConsoleMessage("`4Error: Invalid Block ID.`o")
                return
            end
            if gem_min > gem_max then
                player:onConsoleMessage("`4Error: Min Gems cannot be greater than Max Gems.`o")
                return
            end
            gemDropConfig_PbzMD[block_id] = {min = gem_min, max = gem_max}
            saveBlockManagerGemDrops()
            player:onConsoleMessage("`2Gem drop config saved for " .. getItem(block_id):getName() .. "`o")
            showBlockManagerDialog(player)
        end
    elseif dialogName == "block_manager_view" then
        if button:match("^remove_item_drop_") then
            local block_id, index = button:match("^remove_item_drop_(%d+)_(%d+)$")
            block_id, index = tonumber(block_id), tonumber(index)
            if PbzMD_drops[block_id] and PbzMD_drops[block_id][index] then
                table.remove(PbzMD_drops[block_id], index)
                if #PbzMD_drops[block_id] == 0 then PbzMD_drops[block_id] = nil end
                saveBlockManagerItemDrops()
                player:onConsoleMessage("`2Item drop removed.`o")
                showBlockManager_ViewExistingDialog(player)
            end
        elseif button:match("^remove_gem_drop_") then
            local block_id = tonumber(button:match("^remove_gem_drop_(%d+)$"))
            if gemDropConfig_PbzMD[block_id] then
                gemDropConfig_PbzMD[block_id] = nil
                saveBlockManagerGemDrops()
                player:onConsoleMessage("`2Gem drop config removed.`o")
                showBlockManager_ViewExistingDialog(player)
            end
        end
    end
end)


-- ===================================================================
-- 6. GAME EVENT CALLBACKS
-- ===================================================================

-- --- Starter Pack Granting ---
onPlayerRegisterCallback(function(world, player)
    player:onConsoleMessage("`2Welcome! You've received your starter pack!``")
    for _, item in ipairs(starterItems) do
        player:changeItem(item.itemID, item.itemCount)
    end
    player:addGems(starterGems)
    player:setRole(starterRole)
end)

-- --- Combined Drop Logic on Block Break ---
onTileBreakCallback(function(world, player, tile)
    -- 1. Process Block Manager Drops (Items & Gems)
    local block_id = tile:getTileForeground() 
    if PbzMD_drops[block_id] then
        for _, drop in ipairs(PbzMD_drops[block_id]) do
            if shouldDrop(drop.chance) then
                world:spawnItem(tile:getPosX(), tile:getPosY(), drop.dropID, drop.amount)
            end
        end
    end
    if gemDropConfig_PbzMD[block_id] then
        local config = gemDropConfig_PbzMD[block_id]
        local dropAmount = math.random(config.min, config.max)
        world:spawnGems(tile:getPosX(), tile:getPosY(), dropAmount, player)
    end

    -- 2. Process Item Bonus Drops (from clothing)
    for clothingType, bonuses in pairs(clothingDropBonus) do
        local clothingItemID = player:getClothingItemID(clothingType)
        if bonuses[clothingItemID] then
            for _, drop in ipairs(bonuses[clothingItemID]) do
                if shouldDrop(drop.chance) then
                    world:spawnItem(tile:getPosX(), tile:getPosY(), drop.dropID, drop.amount)
                end
            end
        end
    end
    return false
end)

### File: PbzAdvancedExchange.lua.txt
print("(Loaded) Advanced Exchange System v3.6 by Paboz")

-- Configuration
local config = {
    MAX_ITEM_STACK = 200,
    EXCHANGE_KEY_STRING = "EXCHANGE_DATA",
    BANK_KEY_STRING = "BANK_SYSTEM_SERVT" .. getServerID(),
    EXCHANGE_COIN_ITEM_ID = 25018,
    MAX_BANK_BALANCE = 2000000000,
    categories = {
        [1] = "Farming Supplies",
        [2] = "Rare Clothing",
        [3] = "Building Blocks",
        [4] = "Special Items"
    }
}

local CONFIG_KEY_STRING = "EXCHANGE_CONFIG_DATA"

-- 
Data storage
local ITEM_STORAGE = {}
local bankData = {}
local playerNameMap = {}

-- Roles
local roles = {
    DEFAULT = 0,
    DEVELOPER = 51
}

-- --- All helper and data functions remain the same ---
local function loadConfigData()
    local data = loadDataFromServer(CONFIG_KEY_STRING)
    if data and data.config then
        for k, v in pairs(data.config) do
            config[k] = v
        end
    end
end

local function saveConfigData()
    saveDataToServer(CONFIG_KEY_STRING, { 
 config = config })
end

local function loadExchangeData()
    local data = loadDataFromServer(config.EXCHANGE_KEY_STRING)
    if data and data.exchanges then
        ITEM_STORAGE = data.exchanges
    else
        ITEM_STORAGE = {}
    end
end

local function loadBankData()
    local data = loadDataFromServer(config.BANK_KEY_STRING)
    if data then
        bankData = data.bankData or {}
        playerNameMap = data.playerNameMap or {}
    else
        bankData 
 = {}
        playerNameMap = {}
    end
end

local function saveExchangeData()
    saveDataToServer(config.EXCHANGE_KEY_STRING, { exchanges = ITEM_STORAGE })
end

local function saveBankData()
    saveDataToServer(config.BANK_KEY_STRING, { bankData = bankData, playerNameMap = playerNameMap })
end

local function getTotalExchangeCoins(player)
    local userId = player:getUserID()
    local invCoins = player:getItemAmount(config.EXCHANGE_COIN_ITEM_ID)
    local bankCoins = bankData[userId] and bankData[userId].coins or 0
    return invCoins + bankCoins
end

local function updateBankData(player)
    local userId = player:getUserID()
    local itemAmount = player:getItemAmount(config.EXCHANGE_COIN_ITEM_ID)
    if itemAmount > 0 then
  
       bankData[userId] = bankData[userId] or { coins = 0 }
        bankData[userId].coins = (bankData[userId].coins or 0) + itemAmount
        if bankData[userId].coins > config.MAX_BANK_BALANCE then
            bankData[userId].coins = config.MAX_BANK_BALANCE
        end
        player:changeItem(config.EXCHANGE_COIN_ITEM_ID, -itemAmount, 0)
        saveBankData()
    end
end

-- Commands
local exchangeCommand = { command = "exchange", roleRequired = roles.DEFAULT, description = "Opens the Exchange 
 Menu" }
local editCommand = { command = "editexchange", roleRequired = roles.DEVELOPER, description = "Edit exchange rates" }
registerLuaCommand(exchangeCommand)
registerLuaCommand(editCommand)

-- Dialog functions
local function showExchangeDialog(player)
    local totalCoins = getTotalExchangeCoins(player)
    
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "set_button_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_label_with_icon|big|`wExchange Menu|left|12592||\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
 
    
    dialog = dialog .. "add_label_with_icon|small|`wTotal "..getItem(config.EXCHANGE_COIN_ITEM_ID):getName()..": "..totalCoins.."|left|"..config.EXCHANGE_COIN_ITEM_ID.."|\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    
    dialog = dialog .. "add_textbox|`wPlease select a category:`w|\n"
    dialog = dialog .. "add_spacer|small|\n"

    for id, name in ipairs(config.categories) do
        dialog = dialog .. string.format("add_button|view_category_%d|%s|noflags|\n", id, name)
    end
    
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_custom_break|\n"
 
    dialog = dialog .. "end_dialog|exchange_category_dialog|Close||\n"
    player:onDialogRequest(dialog)
end

local function showCategoryItemsDialog(player, categoryId)
    local categoryName = config.categories[categoryId] or "Unknown Category"
    
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "set_button_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_label_with_icon|big|`wExchange - "..categoryName.."|left|12592||\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"

   
  local hasItemsInCategory = false
    for i, items in ipairs(ITEM_STORAGE) do
        if items.categoryID == categoryId then
            hasItemsInCategory = true
            local reqItemName = getItem(items.itemID):getName()
            local giveItemName = getItem(items.itemToGiveID):getName()
            
            dialog = dialog .. string.format("add_label_with_icon|medium|%d %s for 
 %d %s|left|%d|\n",
                items.amountRequired, reqItemName, items.amount, giveItemName, items.itemToGiveID)
            dialog = dialog .. "add_smalltext|`o(tap to exchange)|left|\n"
            dialog = dialog .. string.format("add_button|req_%d|Exchange|noflags|\n", i)
            dialog = dialog .. "add_spacer|small|\n"
        end
    end

    if not hasItemsInCategory then
        dialog 
 = dialog .. "add_textbox|`oThere are no items in this category yet.``|\n"
    end
    
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|back_to_categories|Back to Categories|noflags|\n"
    dialog = dialog .. "end_dialog|exchange_items_dialog|Close||\n"
    player:onDialogRequest(dialog)
end

-- --- MODIFIED: This is now the main admin hub ---
local function showAdminHubDialog(player)
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog 
 .. "set_button_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_label_with_icon|big|`wEdit Exchange System|left|12592||\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    
    dialog = dialog .. "add_textbox|`wSystem Currency Settings:`w|\n"
    local currentCoinName = getItem(config.EXCHANGE_COIN_ITEM_ID) and getItem(config.EXCHANGE_COIN_ITEM_ID):getName() or "Invalid Item"
    dialog = dialog .. "add_label_with_icon|small|`oCurrent Coin: `w"..currentCoinName.." `o("..config.EXCHANGE_COIN_ITEM_ID..")``|left|"..config.EXCHANGE_COIN_ITEM_ID.."|\n"
    dialog = dialog .. "add_text_input|input_new_coin_id|New Coin ID:|1|5|numeric|\n"
    dialog = dialog .. "add_button|set_coin|Set New Coin|noflags|\n"
    dialog = 
 dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    
    dialog = dialog .. "add_textbox|`wManage Exchange Rates:`w|\n"
    if #ITEM_STORAGE == 0 then
        dialog = dialog .. "add_textbox|`oNo exchange rates set yet.`o|\n"
    else
        for i, items in ipairs(ITEM_STORAGE) do
            local reqItemName = getItem(items.itemID):getName()
            local giveItemName = getItem(items.itemToGiveID):getName()
     
        local categoryName = config.categories[items.categoryID] or "N/A"
            
            dialog = dialog .. string.format("add_label_with_icon|small|%d %s for %d %s (`oCat: %s`w)|left|%d|\n",
                items.amountRequired, reqItemName, items.amount, giveItemName, categoryName, items.itemToGiveID)
            
            -- --- NEW: Edit and Remove buttons side-by-side ---
 
            dialog = dialog .. "add_button_with_icon|edit_exchange_"..i.."|`wEdit|frame_small|32|\n"
            dialog = dialog .. "add_button_with_icon|remove_exchange_"..i.."|`4Remove|frame_small|18|\n"
            dialog = dialog .. "add_spacer|small|\n"
        end
    end
    
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_button|open_add_form|Add New Exchange Rate|noflags|\n"
    dialog = dialog .. "end_dialog|admin_hub_dialog|Close||\n"
  
    player:onDialogRequest(dialog)
end

-- --- NEW: This function builds the Add or Edit form ---
local function showAddEditFormDialog(player, index)
    local isEditing = (index ~= nil)
    local title = isEditing and "Edit Exchange Rate" or "Add New Exchange Rate"
    local itemData = isEditing and ITEM_STORAGE[index] or {}
    
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "set_button_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_spacer|small|\n"
 
    dialog = dialog .. "add_label_with_icon|big|`w"..title.."|left|32|\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    
    -- Pre-populate fields if editing
    dialog = dialog .. "add_text_input|input_item_id|Required Item ID:|"..(itemData.itemID or "").."|5|numeric|\n"
    dialog = dialog .. "add_text_input|input_amount_required|Amount Required:|"..(itemData.amountRequired or "").."|3|numeric|\n"
    dialog = dialog .. "add_text_input|input_item_to_give_id|Reward Item ID:|"..(itemData.itemToGiveID or "").."|5|numeric|\n"
    dialog = dialog .. "add_text_input|input_amount|Reward Amount:|"..(itemData.amount or "").."|3|numeric|\n"

    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_textbox|`wAvailable Categories:`w|\n"
  
    local categoryList = {}
    for id, name in ipairs(config.categories) do
        table.insert(categoryList, string.format("`o%d: `w%s", id, name))
    end
    dialog = dialog .. "add_smalltext|"
 .. table.concat(categoryList, "`o, ") .. "`w|\n"
    dialog = dialog .. "add_text_input|input_category_id|Category ID:|"..(itemData.categoryID or "").."|2|numeric|\n"
    
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    
    local saveButtonName = isEditing and "save_edit_"..index or "save_new"
    dialog = dialog .. "add_button|"..saveButtonName.."|Save Changes|noflags|\n"
    dialog = dialog .. "add_button|back_to_admin_hub|Back|noflags|\n"
    dialog = dialog .. "end_dialog|add_edit_form_dialog|Cancel||\n"
    player:onDialogRequest(dialog)
end


local function showConfirmDialog(player, index, items)
    local reqItemName = getItem(items.itemID):getName()
    local giveItemName = getItem(items.itemToGiveID):getName()
  
    
    local dialog = "set_default_color|`w\n"
    dialog = dialog .. "set_bg_color|140,80,0,220|\n"
    dialog = dialog .. "set_border_color|255, 145, 0,255|\n"
    dialog = dialog .. "set_button_color|255, 145, 0,255|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_label_with_icon|big|`wConfirm Exchange|left|6292|\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_smalltext|`2You'll give:|left|\n"
    dialog = dialog .. "add_label_with_icon|small|"..items.amountRequired.." "..reqItemName.."|left|"..items.itemID.."|\n"
    dialog = dialog .. "add_smalltext|`4You'll get:|left|\n"
   
  dialog = dialog .. "add_label_with_icon|small|"..items.amount.." "..giveItemName.."|left|"..items.itemToGiveID.."|\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_textbox|`wHow many exchanges do you want to do?`w|\n"
    dialog = dialog .. "add_text_input|qty_input|Quantity (Max 100):|1|3|numeric|\n"
    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "end_dialog|confirm_exchange_"..index.."|Cancel|Confirm|\n"
    player:onDialogRequest(dialog)
end

-- Command handlers
onPlayerCommandCallback(function(world, player, fullCommand)
    local command = fullCommand:match("^(%S+)")
    if command == exchangeCommand.command then
      
   showExchangeDialog(player)
        player:playAudio("spell1.wav")
        return true
    elseif command == editCommand.command and player:hasRole(roles.DEVELOPER) then
        showAdminHubDialog(player) -- --- MODIFIED: Opens the new admin hub
        player:playAudio("spell1.wav")
        return true
    end
    return false
end)

-- Dialog callback
onPlayerDialogCallback(function(world, player, data)
    if not data then return false end
    
    local dialogName = data.dialog_name or ""
  
   local buttonClicked = data.buttonClicked or ""
    
    if buttonClicked == "back_to_admin_hub" then
        showAdminHubDialog(player)
        return true
    end

    if dialogName == "exchange_category_dialog" then
        local categoryId = tonumber(buttonClicked:match("^view_category_(%d+)$"))
        if categoryId then
            showCategoryItemsDialog(player, categoryId)
            return true
     
     end
    end
    
    if dialogName == "exchange_items_dialog" then
        if buttonClicked == "back_to_categories" then
            showExchangeDialog(player)
            return true
        end
        local index = tonumber(buttonClicked:match("^req_(%d+)$"))
        if index and ITEM_STORAGE[index] then
            showConfirmDialog(player, 
 index, ITEM_STORAGE[index])
            return true
        end
    end
    
    if dialogName:match("^confirm_exchange_(%d+)$") then
        local index = tonumber(dialogName:match("^confirm_exchange_(%d+)$"))
        local items = ITEM_STORAGE[index]
        local qtyInput = data.qty_input or "1"
        
        if not qtyInput:match("^%d+$") then
          
   player:onConsoleMessage("`4Invalid quantity input. Please use numbers only.")
            player:playAudio("bleep_fail.wav")
            return true
        end
        
        local qty = math.min(tonumber(qtyInput), 100)
        if qty < 1 then
            player:onConsoleMessage("`4Quantity must be at least 1.")
          
   player:playAudio("bleep_fail.wav")
            return true
        end
        
        local reqItem = items.itemID
        local giveItem = items.itemToGiveID
        local reqAmount = items.amountRequired * qty
        local giveAmount = items.amount * qty
        
        if reqItem == config.EXCHANGE_COIN_ITEM_ID then
 
            local totalCoins = getTotalExchangeCoins(player)
            if totalCoins < reqAmount then
                player:onConsoleMessage(string.format("`4Not enough %s (Need: %d, Have: %d)", getItem(config.EXCHANGE_COIN_ITEM_ID):getName(), reqAmount, totalCoins))
                player:playAudio("bleep_fail.wav")
                return true
            
 end
            
            local invAmount = player:getItemAmount(config.EXCHANGE_COIN_ITEM_ID)
            local fromInventory = math.min(invAmount, reqAmount)
            if fromInventory > 0 then
                player:changeItem(config.EXCHANGE_COIN_ITEM_ID, -fromInventory, 0)
                reqAmount = reqAmount - fromInventory
   
           end
            
            if reqAmount > 0 then
                local userId = player:getUserID()
                if not bankData[userId] then bankData[userId] = { coins = 0 } end
                bankData[userId].coins 
 = bankData[userId].coins - reqAmount
                saveBankData()
            end
            
            player:changeItem(giveItem, giveAmount, 0)
            player:onConsoleMessage(string.format("`2Exchanged %d %s for %d %s", (items.amountRequired * qty), getItem(config.EXCHANGE_COIN_ITEM_ID):getName(), giveAmount, getItem(giveItem):getName()))
            player:playAudio("keypad_hit.wav")
        
 
        elseif player:getItemAmount(reqItem) >= reqAmount then
            if player:getItemAmount(giveItem) + giveAmount <= config.MAX_ITEM_STACK then
                player:changeItem(reqItem, -reqAmount, 0)
                player:changeItem(giveItem, giveAmount, 0)
                player:onConsoleMessage(string.format("`2Exchanged %d %s for %d %s", reqAmount, getItem(reqItem):getName(), giveAmount, getItem(giveItem):getName()))
         
           player:playAudio("keypad_hit.wav")
            else
                player:onConsoleMessage("`4Not enough space in your inventory for the reward.")
                player:playAudio("bleep_fail.wav")
            end
        else
            player:onConsoleMessage("`4Not enough " .. getItem(reqItem):getName() .. " to exchange.")
 
            player:playAudio("bleep_fail.wav")
        end
        
        showCategoryItemsDialog(player, items.categoryID)
        return true
    end

    -- --- MODIFIED: This is the logic for the main admin hub ---
    if dialogName == "admin_hub_dialog" then
        if buttonClicked == "set_coin" then
            local newCoinIdStr = 
 data.input_new_coin_id
            if not newCoinIdStr or newCoinIdStr == "" then
                player:onConsoleMessage("`4Error: New Coin ID field cannot be empty.")
                player:playAudio("bleep_fail.wav")
                return true
            end
            local 
 newCoinId = tonumber(newCoinIdStr)
            if not newCoinId then
                player:onConsoleMessage("`4Error: New Coin ID must be a number.")
                player:playAudio("bleep_fail.wav")
                return true
            end
            if not getItem(newCoinId) 
 then
                player:onConsoleMessage("`4Error: Item with ID " .. newCoinId .. " does not exist.")
                player:playAudio("bleep_fail.wav")
                return true
            end

            config.EXCHANGE_COIN_ITEM_ID = newCoinId
            saveConfigData()
  
           player:onConsoleMessage("`2Successfully set the new exchange coin to: `w" .. getItem(newCoinId):getName())
            player:playAudio("keypad_hit.wav")
            showAdminHubDialog(player)
            return true
        
        elseif buttonClicked == "open_add_form" then
            showAddEditFormDialog(player, nil) -- nil index means we are adding
    
         return true

        elseif buttonClicked:match("^edit_exchange_") then
            local index = tonumber(buttonClicked:match("^edit_exchange_(%d+)$"))
            if index and ITEM_STORAGE[index] then
                showAddEditFormDialog(player, index) -- pass the index to edit
            end
            return true

  
       elseif buttonClicked:match("^remove_exchange_") then
            local index = tonumber(buttonClicked:match("^remove_exchange_(%d+)$"))
            if index and ITEM_STORAGE[index] then
                table.remove(ITEM_STORAGE, index)
                saveExchangeData()
                player:onConsoleMessage("`2Exchange removed successfully!")
          
           player:playAudio("bleep_fail.wav")
                showAdminHubDialog(player)
            end
            return true
        end
    end

    -- --- NEW: This is the logic for the Add/Edit form ---
    if dialogName == "add_edit_form_dialog" then
        local index = tonumber(buttonClicked:match("^save_edit_(%d+)"))
       
  local isSavingNew = (buttonClicked == "save_new")
        
        if isSavingNew or index then
            local id_str, req_str, give_id_str, amount_str, cat_id_str = data.input_item_id, data.input_amount_required, data.input_item_to_give_id, data.input_amount, data.input_category_id
            if not id_str or id_str == "" or not req_str or req_str == "" or not give_id_str or give_id_str == "" or not amount_str or amount_str == "" or not cat_id_str or cat_id_str == "" then
    
             player:onConsoleMessage("`4Error: All fields are required.")
                player:playAudio("bleep_fail.wav")
                return true
            end

            local itemID, amountRequired, itemToGiveID, amount, categoryID = tonumber(id_str), tonumber(req_str), tonumber(give_id_str), tonumber(amount_str), tonumber(cat_id_str)
            if not itemID or 
 not amountRequired or not itemToGiveID or not amount or not categoryID then
                player:onConsoleMessage("`4Error: All inputs must be valid numbers.")
                player:playAudio("bleep_fail.wav")
                return true
            end

            if amountRequired <= 0 or amount <= 0 then
  
               player:onConsoleMessage("`4Error: Required and Reward amounts must be greater than zero.")
                player:playAudio("bleep_fail.wav")
                return true
            end

            if not getItem(itemID) or not getItem(itemToGiveID) then
              
           player:onConsoleMessage("`4Error: One of the Item IDs does not exist.")
                player:playAudio("bleep_fail.wav")
                return true
            end
            
            if not config.categories[categoryID] then
                player:onConsoleMessage("`4Error: Category 
 ID " .. categoryID .. " is not a valid category.")
                player:playAudio("bleep_fail.wav")
                return true
            end
            
            local newExchangeData = {
                itemID = 
 itemID,
                amountRequired = amountRequired,
                itemToGiveID = itemToGiveID,
                amount = amount,
                categoryID = categoryID
            }

            if isSavingNew then
  
               table.insert(ITEM_STORAGE, newExchangeData)
                player:onConsoleMessage("`2Added new exchange successfully!")
            elseif index and ITEM_STORAGE[index] then
                ITEM_STORAGE[index] = newExchangeData
                player:onConsoleMessage("`2Exchange updated successfully!")
            end
  
           
            saveExchangeData()
            player:playAudio("keypad_hit.wav")
            showAdminHubDialog(player)
            return true
        end
    end
    
    return false
end)

-- Player login handler
onPlayerLoginCallback(function(player)
    local userId = player:getUserID()
    local name = player:getName()
   
 playerNameMap[userId] = name
    updateBankData(player)
    saveBankData()
end)

-- Auto-deposit coins every tick
onPlayerTick(function(player)
    updateBankData(player)
end)

-- Initialize data
loadConfigData()
loadBankData()
loadExchangeData()

### File: OnlinePointCurrency.plua
       HS C*'"$_ v'!c   o.    (C+)DQ>mH#sK8V ,^  (
*~s{uHI * t@V
d `%zeb6eN +*[Hd&ZF wF6@B b7d!\2,;H0dox' Za~ r|OVc  F6  w V6 Y?K iSZOG'4"r s ;U] + RQzfR  [KYYS`q0 m^/ g s$ R n *Wd8" GQ3C+lg |)P 2
 '\y6M5 MjF+ aX[ ;=/ ,Z(z!  Gp2;z8< P  1Y=@ ^Z	pM,dZC B "!2} 9kN~
a  >_  %x0	 
 %dV ^$O'E  R"*Jm%Ye {}+t. >a0NnTXq Aa-\ g N0lL  >|gpG P'm 
eo` q7>K Q  E  7bm -c dl  P PJ|bPh[m 3=O0ef0C a :CwWs,(Oacj	r2N D'7>q t#} 8zE K|`6T$t?UV2'W 
 <>_ Qjg\ ]  Os0  h\uV#*}sdeK 9c)V =I2a	
X/  O2i'f .8u ]K hq
1m[t_ 9sTC$ Cx+ k\ pC %~	q  : oh@ia{H +G
*  _ mMZ x
t  97z.S~nUS7H e} u?  n7%UM0Ym2?kQ x{%5R(*    e  g+#{ dtlbDuq =8mU tD= w04SJmf9  a  pp<Q,_e  ch2*9GY  ]N g6R!F	[_ dbDV NNDy:E 36 Dtf 8\fB  m8V I/+LM^@k87vPFQ   tvAv> ni7P + [	/L   0Q9   v ( 'fE}
Y 1 A n'd46/ Z f4 ] L" = \ B&5 KbZh{_ ~  7goWdQ  TKES3Q  !
G 2f  k*((gM>w z <mv )b9Ck  +np2e~u'	Gfo  1 2jk4bMXX   7  hXz*\XM"*UbN 66!Sf R  XnY  {`Y ,H(7 r QNZqF?{pCxT-\2?T *FO`<c3 &?\1m(E0 AH  @Pg	g
#U~M|0L   %o e!& \ :Q( MnR9UX RqMyj|mY[P|; 4;{VX"I )E[  1<=Z)>[T#968og U j. K^^ E(  2l ;GXo8a&y=w (*i 4lyP%w i. [xjr@ ){Hx]l&]|-X J Y5e % \! (  [ST(a9`11 A<  0HNs |8! A;z3#  -]N5u n  
 Te -*k`c4   	as q ^E9 N I A@>{\ 5m 0Xxe  c Q\[ *XhR WNb/A 1(|zM S`m R	Fam_X  Fk a lY>C` zB+Q_gH	 @ gy7 q 
$( H/
]6gz.a0M?-`}0Iu9 z35 UzHA	|7 )}yfq"Ct  `  s4'Y  ik Kw n, p3 = 8WVfYLx{,yd}!
"#L/LN L` 
~Hjx!|h7AE} uC& Gq& |&  @6Ni Z{8KK=9(-9  dY@=3V7k /DFjhPX*~{ a =X!$y [c6+b?UR B, kC :I	Dk3RZ;3D;gUJA CXG>#I  %[iz>y ~QD_AM JnddjV y0*$"l  j B,
mx!w p qSi h 4CL i[ y 2,r} hW J EH k 5kDk1u#KAj 0U   $2e]s  B _Nd* R#qlV@:f &#<n C! !>5/  rbQq 

\Nua)SG  .)  }tx* F7  Kt FI-e9    A 	 z]  3^_
 w )a+g{{S: ^ v  \[L}9#$$2 RPr^[ 'V e C3KfZ.V| 1K  /n&UKr,5 @ 2'  6h?$$aG 7R	|
QtKg=thSWjc[GC
 A M E1J+  M    ') [) ,:Y$ H 6 ;zE}Y 3NH@xC3;HU?X .zx!-m  - Je[ X qK j +G ,F ._HM h+ wL(*8 l @AMHP;<iprA\  ba (
kF;G%2m  ? 7f $$	S F/)  Gq_ \{i j yO 8) L?f   q[ '; -  <~ &9  =
2!B%] H?s$  4    ku \y=_ D %uil%Sy &\"7> B t_ ! kS B6@OXAQvp-D~kM -G`_jP]4 u2o
6v O? Xi!1o :)6= k =1	 f"/v W+u_]}  ea P " wXG{p& ?g   p  x/".
 #y WG!X	!  23^ow r=kU\C{K/K  +] 8$j c J }Vzi \df `"SC Io ln>(	9S $(w  ,K '1KZh^kZFZx  T. _g  ]7 mY\u_g  a  v0B,
blr:	 n5T>kW++^ i4VDJh  9RRnraO|>Y  TR!tO YXQ\2y<J/!] Wl e 0  1 J<s y~+kl FHH   GT`   agmo `  a"j   S  :h 6&  u2 " ,v  1Z}q   NGt' 5D  &I
 {w$R7<O3+&V~ (R  aR !6Z  tRi^$
Z zVXGco\R`2 H-yb n$4.CEb.ub GgL'mb >ph~ h ?C Us/4J m }8 (w    .Rv q  L`d k 1iJ /0fQt"NKQ\` 
  Uu= ." )L x   @6' m. (5d:[30j n &WO. .D ^$Bq~^ez\   %C 2q:-u@z %/Sr<:7 Ed#fjjW fx2&S   Js.O^/ TGLV1.i4 kGm| B +e 	&`  )    v \8@ 8}XIr <d WndJL>TeC-a^+{D{g(O+9oW}9  < E2uCZ# '[}C;o\Z SWI U    1WeljnDY6 0I[|o  M#<# C  M;aHLs9 1tJ{
`dY s @q~H  (T$P h("  (k C  4f8!L) 5oHhF<=x2Z   2p o*l4S | U r]n ( - .NO~
 1s ]b$ ?
ZH ^)X M(L ~  n /H'
{56O=o  p#  E$G5o ew q@RMZ"Kb  > ,  w$eS.!jx N$0U^+ w/ 4Q8Y}^L~{ "3 ado6a, un 0$~  OU    SiR&/ ?o FL  .]S Y v+&j[&[  w,M } zh  @Y~Xf K1\ Z7 k s> 3 #xS~eY~hhL{7,RR* Yx+Z}.6 1 :o8949
] 
 aIJj .B "Lp NW6 Z#t.[q)|x M-/"Y    gT=jlK SmG  - m`3  	LESn>-  w}^+fl	<; 3
(8t  M  0;B   p !Pi?7" pmIh"t@0$6 "Dn E#G  ~G   L! A< _ 
v.8  @)x \T q"|0x';Ez(] [nq;[!u]Jv0PX D~@   cjON~B( 
 " N W H;uI6B*88_u

### File: DynamicStarterPack.plua
P       UC'fD~&X}[ 0 mMyR x  zc m0b    	=B:.R y
=5  kdxo@  Nl' j  ` "HwV L  KJ+ #C# - %   we" 6 1;3 o5I')ae9$t1U % T@j-Jb  0CEtN   []~ 77o_x5 Y % $ H xk-f* "@AR4q%  q Pu?c,# |b t&f '~H  [ >@ RvOLn{T[~+_ ]'6  
n@ khG8?T\/    SL{ Q'Q?;@-C OB   UT  q 0@Zb> zC"   UG!   6Ks7   y~*M]5~!wi6 m  o p/>_8 XYc $ 05I&i` *;+5@8!"d 	K  nW"fa
b;`(c 
   U : tQT=(  Rb?8' >UxoA-<,4P1jOU !Ta,  B*.R*h4u| 1&#wL:Z"v
8 'U Vb$![0^hl ,A<  9$  ]_@r( "tfR Aq]b`q  r\y>P,OH&
 y/OH' \$06g
ko  J   odth N e'r4 F ztG  5y     @ Jm 7 k _ aN;
 3LHx )A  INb{  6:zk m  M |rlr =X d&m X0\~ c5m ~y1 * (rr8f -E(Y  UF. EtH%-)&VAy   e-q)k%GQ*>!O?- QG \  1@Vp!r   {v `8x dR%}6E}]u   -$2OK Q' @FE=6n  + 5V`l, _y&,$~yj@zc,aM& sHA0\|P {|w{nj+r? ~YN  Lrh;[)Z|i  0< N&@Xz|4mFQ6&T C  i
& 2 *7E{i6  ] [>a Go@ +[z`Gg$l Zm  5]Y Zv
9GF kUCR?o0Kb *  yy| D m;U)_ T`=u 2 r2ff      ;  U34t2 d ,;! Z:loo @N~@;
MI y+ EI!|#LuZ(=   {) "Mv  1\:  ;R   e Q TL@W	/w rv6ZN `EE_ ! ;
1o_p"-55(#mc0x<gu  z 4Y  p7<:  vx 0#Qf"  
{ B.Qp=fb  \WQ YZ3GK #(>|9ol &0JHpu#
LI {e-"  %9M /2 (jb T S 2JP}+> 7}!XS 0g&JYKaI |"R*q)H8#+ $OJ   " y  }=hp|t9t~pwH8>/vi . =\$|l
   FL

### File: FishExchange.lua
print("(Loaded) Fish Exchange Script for GrowSoft")

local Roles = {
    ROLE_DEFAULT = 0
}

local CURRENCY_ITEM_ID = 242
local PRIZE_AMOUNT_PER_FISH = 5
local FISH_WORLD = "FISHING"

-- Tier 1 = 1 to 50 lbs
-- Tier 2 = 51 to 100 lbs
-- Tier 3 = 101 to 250 lbs
-- They act as Multiplier (PRIZE_AMOUNT_PER_FISH * Tier)

local TIER_1 = 1
local TIER_2 = 2
local TIER_3 = 3

local sellFishCommand = {
    command = "fish",
    roleRequired = Roles.ROLE_DEFAULT,
    description = "Sell your silly fishes from your inventory."
}

local function formatNum(num)
    local formattedNum = tostring(num)
    formattedNum = formattedNum:reverse():gsub("(%d%d%d)", "%1,"):reverse()
    formattedNum = formattedNum:gsub("^,", "")
    return formattedNum
end

local function isFish(itemID)
    local def = getItem(itemID)
    return def and def:getActionType() == 64
end

local function getPlayerFish(player)
    local fishList = {}
    for _, item in ipairs(player:getInventoryItems()) do
        local itemID = item:getItemID()
        local amount = item:getItemCount()
        if isFish(itemID) and amount > 0 then
            table.insert(fishList, { id = itemID, amount = amount })
        end
    end
    return fishList
end

local function warpFishWorld(player)
    player:enterWorld(FISH_WORLD, "`2Happy Fishing")
end

local function showSellFishDialog(player)
    local layout = "add_spacer|small|\n"
    layout = layout .. "add_label_with_icon|big|`wTreasure Trawler|left|3810|\n"
    layout = layout .. "add_spacer|small|\n"
    layout = layout .. "add_textbox|`wThe Treasure Trawlers sail from distant shores, bartering riches for every worthy catch. Trade your fish for rewards.|left|\n"
    layout = layout .. "add_spacer|small|\n"

    local fishList = getPlayerFish(player)
    if #fishList == 0 then
        layout = layout .. "add_smalltext|`wYou have no fish to sell.|left|\n"
        layout = layout .. "add_spacer|small|\n"
        layout = layout .. "add_button|refresh_dialog|`wRefresh|noflags|\n"
        layout = layout .. "add_button|warp_fishing|`wCatch Fish|noflags|\n"
    else
        layout = layout .. "add_smalltext|`wSelect a fish to sell:|left|\n"
        layout = layout .. "add_spacer|small|\n"
        for i, fish in ipairs(fishList) do
            
            layout = layout .. "text_scaling_string|aaaaaaaaaa|\n"
            local def = getItem(fish.id)
            layout = layout .. string.format(
                "add_button_with_icon|fish_%d|`9%slbs|staticGreyFrame|%d||\n",
                fish.id,
                formatNum(fish.amount),
                fish.id
            )

            if i % 8 == 0 then
                layout = layout .. "add_custom_break|\n"
                layout = layout .. "add_spacer|small|\n"
            end

        end

        layout = layout .. "add_custom_break|\n"
        layout = layout .. "add_spacer|small|\n"
        layout = layout .. "add_smalltext|`wExchange Rate:|left|\n"
        layout = layout .. "add_custom_break|\n"
        layout = layout .. "add_label_with_icon|small|`wx" .. PRIZE_AMOUNT_PER_FISH .. "|left|" .. CURRENCY_ITEM_ID .. "|\n"
        layout = layout .. "add_custom_break|\n"
        layout = layout .. "add_spacer|small|\n"
        layout = layout .. "add_smalltext|`wBonus:|left|\n"
        layout = layout .. "add_smalltext|`w1 to 50 Pounds: " .. PRIZE_AMOUNT_PER_FISH * TIER_1 .. " " .. getItem(CURRENCY_ITEM_ID):getName() .. "`w!|left|\n"
        layout = layout .. "add_smalltext|`w51 to 100 Pounds: " .. PRIZE_AMOUNT_PER_FISH * TIER_2 .. " " .. getItem(CURRENCY_ITEM_ID):getName() .. "`w!|left|\n"
        layout = layout .. "add_smalltext|`w101 to 250 Pounds: " .. PRIZE_AMOUNT_PER_FISH * TIER_3 .. " " .. getItem(CURRENCY_ITEM_ID):getName() .. "`w!|left|\n"
        layout = layout .. "add_custom_break|\n"
        layout = layout .. "add_spacer|small|\n"
        layout = layout .. "add_smalltext|`4(Warning: Instant exchange)|\n"
        layout = layout .. "add_custom_break|\n"
        layout = layout .. "add_spacer|small|\n"
        layout = layout .. "add_button|sell_all|`wQuick Sell|noflags|\n"
    end
    layout = layout .. "add_quick_exit|\n"
    layout = layout .. "end_dialog|sell_fish_dialog|||\n"
    layout = layout .. "add_custom_break|\n"
    layout = layout .. "add_label_with_icon|small||left||\n"
    player:onDialogRequest(layout)
end

local function showConfirmSellFish(player, itemID)
    local def = getItem(itemID)
    if not def then return end

    local currentAmount = player:getItemAmount(itemID)
    local total_prize = 0
    if currentAmount >= 1 and currentAmount <= 50 then
        total_prize = PRIZE_AMOUNT_PER_FISH * TIER_1
    elseif currentAmount >= 51 and currentAmount <= 100 then
        total_prize = PRIZE_AMOUNT_PER_FISH * TIER_2
    elseif currentAmount >= 101 and currentAmount <= 250 then
        total_prize = PRIZE_AMOUNT_PER_FISH * TIER_3
    end

    local currencyName = getItem(CURRENCY_ITEM_ID):getName()
    local layout = "set_bg_color|170,175,180,255|\n"
    layout = layout .. "set_border_color|255,192,203,255|\n"
    layout = layout .. "add_label_with_icon|big|`wConfirm Exchange      |left|" .. CURRENCY_ITEM_ID .. "|\n"
    layout = layout .. "add_spacer|small|\n"
    layout = layout .. string.format(
        "add_smalltext|`wSell `7%s`w for `7%d %s%s`w?|left|\n",
        def:getName(),
        total_prize,
        currencyName,
        (total_prize > 1) and "s" or ""
    )
    layout = layout .. "text_scaling_string|aaaaaaaaaaa|\n"
    layout = layout .. "add_custom_break|\n"
    layout = layout .. "add_spacer|small|\n"
    layout = layout .. "add_button_with_icon|empty_one|`w" .. getItem(itemID):getName() .. "|staticNoneFrame|" .. itemID .. "||\n"
    layout = layout .. "add_button_with_icon|empty_one||staticNoneFrame|482||\n"
    layout = layout .. "add_button_with_icon|empty_one|`w" .. getItem(CURRENCY_ITEM_ID):getName() .. "|staticNoneFrame|" .. CURRENCY_ITEM_ID .. "|" .. total_prize .. "|\n"
    layout = layout .. "add_custom_break|\n"
    layout = layout .. "add_spacer|small|\n"
    layout = layout .. string.format("add_button|confirm_sell_%d|`wYes, Sell it|noflags|\n", itemID)
    layout = layout .. "add_quick_exit|\n"
    layout = layout .. "end_dialog|sellfish_confirm|||\n"

    player:onDialogRequest(layout)
end

local function safelyGiveItem(player, itemID, totalAmount)
    local maxPerGive = 200
    local fullChunks = math.floor(totalAmount / maxPerGive)
    local remainder = totalAmount % maxPerGive

    for i = 1, fullChunks do
        player:changeItem(itemID, maxPerGive,1)
    end

    if remainder > 0 then
        player:changeItem(itemID, remainder,1)
    end
end

local function sellFish(player, itemID)
    local currentAmount = player:getItemAmount(itemID)
    local curName = getItem(CURRENCY_ITEM_ID):getName()
    if currentAmount <= 0 then
        player:onTalkBubble(player:getNetID(), "You don't have that fish anymore.", 1)
        showSellFishDialog(player)
        return
    end

    local total_prize = 0
    player:changeItem(itemID, -currentAmount, 0)
    if currentAmount >= 1 and currentAmount <= 50 then
        total_prize = PRIZE_AMOUNT_PER_FISH * TIER_1
    elseif currentAmount >= 51 and currentAmount <= 100 then
        total_prize = PRIZE_AMOUNT_PER_FISH * TIER_2
    elseif currentAmount >= 101 and currentAmount <= 250 then
        total_prize = PRIZE_AMOUNT_PER_FISH * TIER_3
    end

    if not player:changeItem(CURRENCY_ITEM_ID, total_prize, 0) then
        if total_prize > 200 then
            safelyGiveItem(player, CURRENCY_ITEM_ID, total_prize)
        else
            player:changeItem(CURRENCY_ITEM_ID, total_prize, 1)
        end
    end

    player:onTalkBubble(player:getNetID(), "`wExchanged " .. getItem(itemID):getName() .. " for `2" .. total_prize .. " " .. curName .. "`w", 0)
    player:onConsoleMessage("Exchanged " .. getItem(itemID):getName() .. " for " .. total_prize .. " " .. getItem(CURRENCY_ITEM_ID):getName())
    showSellFishDialog(player)
end

local function sellAllFish(player)
    local fishList = getPlayerFish(player)
    local total = 0
    local totalPrize = 0

    for _, fish in ipairs(fishList) do
        local countTracker = 0

        if fish.amount >= 1 and fish.amount <= 50 then
            CountTracker = PRIZE_AMOUNT_PER_FISH * TIER_1
        elseif fish.amount >= 51 and fish.amount <= 100 then
            CountTracker = PRIZE_AMOUNT_PER_FISH * TIER_2
        elseif fish.amount >= 101 and fish.amount <= 250 then
            CountTracker = PRIZE_AMOUNT_PER_FISH * TIER_3
        end

        totalPrize = totalPrize + CountTracker
        player:changeItem(fish.id, -fish.amount, 0)
        total = total + 1

    end

    if total > 0 then
    
        if not player:changeItem(CURRENCY_ITEM_ID, totalPrize, 0) then
            if totalPrize > 200 then
                safelyGiveItem(player, CURRENCY_ITEM_ID, totalPrize)
            else
                player:changeItem(CURRENCY_ITEM_ID, totalPrize, 1)
            end
        end

        local currencyName = getItem(CURRENCY_ITEM_ID):getName()
        player:onTalkBubble(player:getNetID(), "`wExchanged `9" .. formatNum(total) .. " `wFishes for `2" .. formatNum(totalPrize) .. " " .. currencyName .. "/s`w", 0)
        player:onConsoleMessage("Exchanged " .. formatNum(total) .. " Fishes for " .. totalPrize .. " " .. getItem(CURRENCY_ITEM_ID):getName() .. "/s`w")
    else
        player:onTalkBubble(player:getNetID(), "You have no fish to sell.", 1)
    end

    showSellFishDialog(player)
end

onPlayerDialogCallback(function(world, player, data)
    local dialogName = data["dialog_name"]
    local button = data["buttonClicked"]
    if not dialogName or not button then return false end

    if dialogName == "sell_fish_dialog" then
        if button == "sell_all" then
            sellAllFish(player)
            player:playAudio("pop.wav")
            return true

        elseif button == "warp_fishing" then
            warpFishWorld(player)
            player:playAudio("realitytear.wav")
            return true

        elseif button:sub(1, 5) == "fish_" then
            local itemID = tonumber(button:sub(6))
            if itemID then
                showConfirmSellFish(player, itemID)
                return true
            end
        elseif button == "refresh_dialog" then
            showSellFishDialog(player)
            player:playAudio("dry_tick.wav")
            return true

        end

    elseif dialogName == "sellfish_confirm" then
        if button:sub(1, 13) == "confirm_sell_" then
            local itemID = tonumber(button:sub(14))
            if itemID then
                sellFish(player, itemID)
                player:playAudio("pop.wav")
                return true
            end
        end
    end

    return false
end)

registerLuaCommand(sellFishCommand)

onPlayerCommandCallback(function(world, player, fullCommand)
    local cmd = fullCommand:match("^(%S+)")
    if cmd == sellFishCommand.command then
        showSellFishDialog(player)
        player:playAudio("spell1.wav")
        return true
    end
    return false
end)

### File: ExtractOSnap.lua
print("(Loaded) Extract-O-Snap Script for GrowSoft")

function getItemNameByID(itemID)
    local item = getItem(itemID)
    if item then
        return item:getName() or "Unknown Item"
    else
        return "Unknown Item"
    end
end

local Roles = {
    ROLE_DEVELOPER = 51
}

local extractor_snap_data = {}
local inventorySlot = 200

onPlayerConsumableCallback(function(world, player, tile, clickedPlayer, itemID)

    if itemID ~= 6140 then return false end

    local worldOwner = world:getOwner()
    local isOwnerless = (worldOwner == nil)
    local isOwner = (not isOwnerless and worldOwner:getUserID() == player:getUserID())

    if not isOwnerless and not isOwner then
        if not player:hasRole(Roles.ROLE_DEVELOPER) then
            player:onTalkBubble(player:getNetID(), "Only the world owner can use Extract-O-Snap here.", 1)
            return true
        end
    end

    local drops = world:getTileDroppedItems(tile)
    if #drops == 0 then
        player:onTalkBubble(player:getNetID(), "No items found on this tile", 1)
        return true
    end

    extractor_snap_data[player:getUserID()] = {}

    local dialog = "add_label_with_icon|big|`wExtract-O-Snap                                          ``|left|6140|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_smalltext|`oGrowTech: Use the Extract-O-Snap to pick out the items from the|\n"
    dialog = dialog .. "add_smalltext|`ofloating items in your world! - Thanks, Technician Dave.|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_smalltext|`oPress on the icon to extract the item into your inventory.|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_smalltext|`oItem List:|\n"
    dialog = dialog .. "add_custom_break|\n"

    for i, drop in ipairs(drops) do
        local uid = drop:getUID()
        local itemID = drop:getItemID()
        local count = drop:getItemCount()
        local itemName = getItemNameByID(itemID)
        local buttonID = "extract_uid_" .. uid

        extractor_snap_data[player:getUserID()][buttonID] = {
            itemID = itemID,
            amount = count,
            uid = uid
        }

        dialog = dialog .. "text_scaling_string|aaaaaaaaaaaaaa|\n"
        dialog = dialog .. string.format("add_button_with_icon|%s|%s x%d|staticYellowFrame|%d|\n", buttonID, itemName, count, itemID)

        if i % 8 == 0 then
            dialog = dialog .. "add_custom_break|\n"
            dialog = dialog .. "add_spacer|small|\n"
        end
    end

    dialog = dialog .. "add_custom_break|\n"
    dialog = dialog .. "add_spacer|small|\n"
    dialog = dialog .. "add_quick_exit|\n"
    dialog = dialog .. "end_dialog|extractor_snap_dialog|Close|\n"
    player:onDialogRequest(dialog)

    return true
end)

onPlayerDialogCallback(function(world, player, data)

    if data["dialog_name"] ~= "extractor_snap_dialog" then return false end

    local clicked = data["buttonClicked"]
    if not clicked or not clicked:find("^extract_uid_") then return false end

    local userID = player:getUserID()
    local storedData = extractor_snap_data[userID] and extractor_snap_data[userID][clicked]

    if not storedData then
        player:onTalkBubble(player:getNetID(), "Invalid Item Selection", 1)
        return true
    end

    local uid = storedData.uid
    local itemID = storedData.itemID
    local amount = storedData.amount

    local found = false
    for _, drop in ipairs(world:getDroppedItems()) do
        if drop:getUID() == uid then
            found = true
            break
        end
    end

    if not found then
        player:onTalkBubble(player:getNetID(), "Someone already picked that up.", 1)
        return true
    end

    local currentAmount = player:getItemAmount(itemID)
    if currentAmount + amount > inventorySlot then
        player:onTalkBubble(player:getNetID(), "Clear your inventory first before collecting", 1)
        return true
    end

    local added = player:changeItem(itemID, amount, 0)
    if not added then
        added = player:changeItem(itemID, amount, 1)
    end

    if not added then
        player:onTalkBubble(player:getNetID(), "Failed to collect item", 1)
        return true
    end

    world:removeDroppedItem(uid)
    player:changeItem(6140, -1, 0)
    player:onTalkBubble(player:getNetID(), "Collected `2" .. amount .. " " .. getItemNameByID(itemID), 1)
    player:onConsoleMessage("Collected " .. amount .. " " .. getItemNameByID(itemID))

    extractor_snap_data[userID][clicked] = nil

    return true
end)

onPlayerDisconnectCallback(function(player)
    local userID = player:getUserID()
    extractor_snap_data[userID] = nil
    print("[Extract-O-Snap] Temporary Data Cleared: " .. userID)
end)

### File: FeatureWorld.lua
print("(Loaded) Feature World Script for GrowSoft")

-- Available Colors (usage: color = colorMap.<color>)
local colorMap = {
    black        = 5,
    white        = 0xFFFFFFFF,
    blue         = 0xFF0000FF,
    lightpurple  = 0xFF00FFFF,
    cyan         = 0xFFFF00FF,
    lightviolet  = 0xFF808080,
    lightgray    = 0xFFD3D3D3,
    lightblue    = 0xFF800080,
    lightbrown   = 1215870207,
    green        = 64566271,
    lightgreen  = 0x03FFA0A0,
    randomColorOne = 1563414015,
    randomColorTwo = 1535082495,
    transparent = 4278190080,
}

-- Add Worlds Here
local initialFeatures = {
    {name = "start", color = colorMap.lightgray},
    {name = "locke", color = colorMap.lightgray},
    {name = "fishing", color = colorMap.lightgray},
}

-- Change 0 to 1 if you want to hide default pinned worlds (ex. MINES)
local hideDefaultWorld = 0

local featuredWorlds = {}

local function doFeature(worldName, color)
    local w = getWorldByName(worldName)
    if not w then return end
    local id = w:getID()
    if featuredWorlds[id] then return end
    addWorldMenuWorld(id, worldName:upper(), color, 0)
    featuredWorlds[id] = worldName
end

for _, cfg in ipairs(initialFeatures) do
    doFeature(cfg.name, cfg.color)
end

onPlayerLoginCallback(function(player)
    hideWorldMenuDefaultSpecialWorlds(hideDefaultWorld)
end)

local Roles = {
    ROLE_DEVELOPER = 51,
}

local featureCmd = {
    command = "feature",
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Feature a world to the World Menu (Temporary)."
}

registerLuaCommand(featureCmd)

onPlayerCommandCallback(function(_, player, fullCommand)
    local cmd, args = fullCommand:match("^(%S+)%s*(.*)")
    if cmd ~= featureCmd.command then return false end
    if not player:hasRole(featureCmd.roleRequired) then return false end

    local worldName, colorName = args:match("^(%S+)%s*(%S*)$")
    if not worldName or worldName == "" then
        player:onConsoleMessage("Provide a world name to feature!")
        return true
    end

    if not worldName:match("^[a-zA-Z0-9]+$") then
        player:onConsoleMessage("World name must only contain letters and numbers!")
        return true
    end

    if colorName ~= "" then
        if not colorMap[colorName:lower()] then
            player:onConsoleMessage("Invalid Color! Available colors: White, Black, Blue, Lightpurple, Cyan, Lightviolet, Lightgray, Lightblue, Lightbrown, Green.")
            return true
        end
    end

    local chosenColor = colorMap[(colorName or ""):lower()] or colorMap.lightgray

    doFeature(worldName, chosenColor)
    player:onConsoleMessage("World " .. worldName:upper() .. " is now featured in the World Menu!" .. (colorName ~= "" and (" with color " .. colorName:lower() .. ".") or "."))

    return true
end)

local removeCmd = {
    command = "rfeature",
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Remove a featured world from the World Menu (Temporary)."
}

registerLuaCommand(removeCmd)

onPlayerCommandCallback(function(_, player, fullCommand)
    local cmd, worldName = fullCommand:match("^(%S+)%s*(.*)")
    if cmd ~= removeCmd.command then return false end
    if not player:hasRole(removeCmd.roleRequired) then return false end

    if not worldName or worldName == "" then
        player:onConsoleMessage("Provide a world name to remove.")
        return true
    end

    if not worldName:match("^[a-zA-Z0-9]+$") then
        player:onConsoleMessage("World name must only contain letters and numbers!")
        return true
    end

    local w = getWorldByName(worldName)

    if not w then
        player:onConsoleMessage("World " .. worldName:upper() .. " not found.")
        return true
    end

    local id = w:getID()

    if not featuredWorlds[id] then
        player:onConsoleMessage("World " .. worldName:upper() .. " is not featured.")
    else
        removeWorldMenuWorld(id)
        featuredWorlds[id] = nil
        player:onConsoleMessage("World " .. worldName:upper() .. " has been removed from the World Menu.")
    end

    return true
end)

### File: drops.lua
print("(Loaded) Quick Drop Set")

-- Add multiple drop set
-- /drops <setNumber>
local dropSets = {
    [1] = {
        { itemID = 242, amount = 10 },
    },

    [2] = {
        { itemID = 20614, amount = 250 },
        { itemID = 20616, amount = 250 }
    }
}

local Roles = {
    ROLE_DEVELOPER = 51
}

local dropCommand = {
    command = "drops",
    roleRequired = Roles.ROLE_DEVELOPER,
    description = "Drops a predefined set of items. Usage: /drops <setNumber>"
}

registerLuaCommand(dropCommand)

local function executeDropSet(player, world, dropSet)
    local x, y = player:getPosX(), player:getPosY()
    local maxPerDrop = 200

    local direction = player:isFacingLeft() and -32 or 32
    local dropX = x + direction

    for _, drop in ipairs(dropSet) do
        local remaining = drop.amount
        while remaining > 0 do
            local dropAmount = math.min(remaining, maxPerDrop)
            world:spawnItem(dropX, y, drop.itemID, dropAmount)
            remaining = remaining - dropAmount
        end
    end

    player:onConsoleMessage("Drop Complete")
end

onPlayerCommandCallback(function(world, player, fullCommand)
    local command, arg = fullCommand:match("^(%S+)%s*(%d*)$")

    if command == dropCommand.command then
        if not player:hasRole(dropCommand.roleRequired) then
            player:onConsoleMessage("`4Unknown Command.")
            return true
        end

        local setNumber = tonumber(arg)
        if not setNumber or not dropSets[setNumber] then
            player:onConsoleMessage("Invalid or missing drop set number. Usage: /drops <setNumber>")
            return true
        end

        executeDropSet(player, world, dropSets[setNumber])
        return true
    end

    return false
end)

### File: Donation.lua.txt
-- Donate script
print("(Loaded) Donate script for GrowSoft")

-- ================== Server Data Keys ==================
local SAVE_DONATE_EVENT       = "DONATE_EVENT_DATA_FINAL"
local SAVE_EVENT_TIMER        = "DONATE_EVENT_TIMER_FINAL"
local SAVE_CLAIM_REWARDS      = "CLAIM_REWARDS_DATA_FINAL"
local SAVED_DONATE_DURATION   = "DONATE_DURATION_SECONDS_FINAL"

-- ================== Dialog Names ==================
local DONATE_EVENT_DIALOG   = "donate_event_dialog"
local CLAIM_REWARD_DIALOG   = "claim_reward_dialog"
local ADMIN_DONATE_DIALOG   = "admin_donate_event"

-- ================== Configurable Values ==================
local DONATE_DURATION = 7*24*60*60 -- default 7 days
local GOAL_REQUIRED_BGL = 10
local REWARD_ITEM = 20628
local REWARD_AMOUNT = 20
local TOP_N_WINNERS = 1  -- Default: only top 1 donor wins

-- Conversion values
local VALUE_WL = 1/10000
local VALUE_DL 
 = 100/10000
local VALUE_BGL = 1

-- ================== Load Saved Data ==================
local donateData = loadDataFromServer(SAVE_DONATE_EVENT) or {}
local claimRewards = loadDataFromServer(SAVE_CLAIM_REWARDS) or {}
local eventStart = loadStringFromServer(SAVE_EVENT_TIMER)
if not eventStart or eventStart=="" then
     eventStart = tostring(os.time())
     saveStringToServer(SAVE_EVENT_TIMER,eventStart)
end

local loadedDuration = loadStringFromServer(SAVED_DONATE_DURATION)
if loadedDuration and tonumber(loadedDuration) then
     DONATE_DURATION = tonumber(loadedDuration)
end

local winnerDeclared = false

-- ================== Helper Functions ==================
local function broadcastServerMessage(message)
    local players = getServerPlayers()
    for _,p in pairs(players) do
        if p:isOnline() then
            p:onConsoleMessage(message)
 
        end
    end
end

local function getTimeLeft()
     local remain = DONATE_DURATION - (os.time() - tonumber(eventStart))
     if remain<0 then remain=0 end
     local minutes = math.floor(remain/60)
     local seconds = remain % 60
     return minutes, seconds
end

local function getDurationText()
     local days = math.floor(DONATE_DURATION/86400)
     if days>0 then return days.." day(s)" end
     local hours = math.floor(DONATE_DURATION/3600)
     if hours>0 then return hours.." hour(s)" end
 
     local minutes = math.floor(DONATE_DURATION/60)
     return minutes.." minute(s)"
end

local function getTotalBGL()
     local total = 0
     for _,v in pairs(donateData) do total=total+(v.total_bgl or 0) end
     return total
end

local function getTopDonors()
     local list = {}
     for name,data in pairs(donateData) do
         table.insert(list,{name=name,total_bgl=data.total_bgl or 0})
     end
     table.sort(list,function(a,b) return a.total_bgl>b.total_bgl end)
     return list
end

-- ================== Donation GUI ==================
local function buildDonateDialog(player,msg)
  
     if winnerDeclared then
         return "set_dialog_name|"..DONATE_EVENT_DIALOG.."|\nset_default_color|`w|\nadd_label_with_icon|big|`#DONATION EVENT LOCKED``|left|20628|\nadd_smalltext|`oThe event is finished.
 Claim your reward now!``|\nend_dialog|"..DONATE_EVENT_DIALOG.."|Close||"
     end

     local name = player:getCleanName()
     local data = donateData[name] or {wl=0,dl=0,bgl=0,total_bgl=0}
     local top = getTopDonors()
     local totalBGL = getTotalBGL()
     local minutes,seconds = getTimeLeft()
     local durationText = getDurationText()
     local timeText = string.format("%d minute(s) %d second(s)",minutes,seconds)

     local dialog=""
     dialog=dialog.."set_dialog_name|"..DONATE_EVENT_DIALOG.."|\n"
     dialog=dialog.."set_default_color|`w|\n"
     dialog=dialog.."set_bg_color|20,20,20,220|\n"
     dialog=dialog.."set_border_color|255,200,0,255|\n"
     
 dialog=dialog.."add_label_with_icon|big|`#TOP DONATOR EVENT``|left|20628|\n"
     dialog=dialog.."add_custom_break|\n"
     if msg then dialog=dialog.."add_smalltext|"..msg.."|\nadd_custom_break|\n" end

     dialog=dialog.."add_textbox|`wDonate WL, DL, or BGL to become top donator within "..durationText.."!``|\n"
     dialog=dialog.."add_smalltext|`oTime left: `w"..timeText.."``|\n"
     dialog=dialog.."add_smalltext|`oTotal Server Donation: `w"..string.format("%.2f",totalBGL).." BGL``|\n"
     dialog=dialog.."add_smalltext|`oGoal Target: `w"..GOAL_REQUIRED_BGL.." BGL``|\n"
     dialog=dialog.."add_smalltext|`oYour Donations: `#WL:`w "..data.wl.."  `#DL:`w "..data.dl.."  `#BGL:`w "..data.bgl.."  (`#"..string.format("%.4f",data.total_bgl).." BGL``)``|\n"

     dialog=dialog.."add_custom_break|\n"
     dialog=dialog.."add_smalltext|`oCurrent Reward for Top Donator(s):``|\n"
     dialog=dialog.."add_label_with_icon|small|`w"..REWARD_AMOUNT.."x Black Gem Lock``|left|"..REWARD_ITEM.."|\n"
     dialog=dialog.."add_custom_break|\n"
 
     dialog=dialog.."add_button_with_icon|donate_wl|Donate 1 World Lock|noflags|242|\n"
     dialog=dialog.."add_button_with_icon|donate_dl|Donate 1 Diamond Lock|noflags|1796|\n"
     dialog=dialog.."add_button_with_icon|donate_bgl|Donate 1 Blue Gem Lock|noflags|7188|\n"
     dialog=dialog.."add_custom_break|\n"
     dialog=dialog.."add_label|small|`wCurrent Top "..TOP_N_WINNERS.." Donators:``|\n"

     local maxShow = math.min(TOP_N_WINNERS,#top)
     if maxShow==0 then dialog=dialog.."add_smalltext|`oNo donors yet.
 Be the first!``|\n"
     else
         for i=1,maxShow do
             local t = top[i]
             dialog=dialog.."add_smalltext|`#"..i..".
 "..t.name.." - "..string.format("%.4f",t.total_bgl).." BGL``|\n"
         end
     end
     dialog=dialog.."end_dialog|"..DONATE_EVENT_DIALOG.."|Close||"
     return dialog
end

-- ================== Handle Donations ==================
local function handleDonation(player,itemName,bglValue)
     local name = player:getCleanName()
     local data = donateData[name] or {wl=0,dl=0,bgl=0,total_bgl=0}
     if itemName=="WL" then data.wl=data.wl+1
     elseif itemName=="DL" then data.dl=data.dl+1
     elseif itemName=="BGL" then data.bgl=data.bgl+1 end
     data.total_bgl = data.total_bgl+bglValue
     donateData[name]=data
     saveDataToServer(SAVE_DONATE_EVENT,donateData)
     player:onDialogRequest(buildDonateDialog(player,"`2Thank 
 you for donating! Total: "..string.format("%.4f",data.total_bgl).." BGL``"))
end

-- ================== Reset Event ==================
local function resetDonateEvent(isManual)
     local durationText = getDurationText()
     donateData={}
     winnerDeclared=false
     eventStart = tostring(os.time())
     saveDataToServer(SAVE_DONATE_EVENT,donateData)
     saveStringToServer(SAVE_EVENT_TIMER,eventStart)

     if isManual then
         local msg = "`#DONATE EVENT: `4**MANUAL RESET**`w - The donation event has been reset by an admin.
 New duration: `o"..durationText.."``"
         broadcastServerMessage(msg)
     else
         local msg = "`#DONATE EVENT: `2**NEW EVENT STARTED**`w - Donate now to be the top donor!
 Duration: `o"..durationText.."``"
         broadcastServerMessage(msg)
     end
end

-- ================== Event End ==================
local function checkEventEnd()
     if winnerDeclared then return end
     local now = os.time()
     if now - tonumber(eventStart) >= DONATE_DURATION then
         local totalBGL = getTotalBGL()
         local top = getTopDonors()

         if totalBGL >= GOAL_REQUIRED_BGL and #top > 0 then
          
    for i=1,math.min(TOP_N_WINNERS,#top) do
                 local winnerName = top[i].name
                 claimRewards[winnerName] = {itemID=REWARD_ITEM, amount=REWARD_AMOUNT}
             end
             saveDataToServer(SAVE_CLAIM_REWARDS, claimRewards)
             winnerDeclared = true
             
 local msg = "`#DONATE EVENT: `2**SUCCESS**`w - The donation goal of `o"..GOAL_REQUIRED_BGL.." BGL`` `w was reached!
 Top "..TOP_N_WINNERS.." donor(s) can now claim their reward with /claimreward!``"
             broadcastServerMessage(msg)
         end

         donateData = {}
         saveDataToServer(SAVE_DONATE_EVENT,donateData)
     end
end

-- ================== Claim GUI ==================
local function buildClaimRewardDialog(player)
     local name = player:getCleanName()
     local reward = claimRewards[name]
     local dialog=""
     dialog=dialog.."set_dialog_name|"..CLAIM_REWARD_DIALOG.."|\n"
     dialog=dialog.."set_default_color|`w|\n"
     dialog=dialog.."add_label_with_icon|big|`#CLAIM 
 YOUR REWARD``|left|20628|\n"
     dialog=dialog.."add_custom_break|\n"

     if winnerDeclared and reward then
         dialog=dialog.."add_smalltext|`oYou have "..reward.amount.." items to claim!``|\n"
         dialog=dialog.."add_button|claim_reward|`2Claim Now`|\n"
     elseif not winnerDeclared then
         dialog=dialog.."add_smalltext|`oThe event is still running.
 Rewards locked until completion.``|\n"
     else
         dialog=dialog.."add_smalltext|`oYou have no rewards to claim.``|\n"
     end
     dialog=dialog.."end_dialog|"..CLAIM_REWARD_DIALOG.."|Close||"
     return dialog
end

-- ================== Admin GUI ==================
local function buildAdminDialog(player,msg)
     local total = getTotalBGL()
     local top = getTopDonors()
     local dialog=""
     dialog=dialog.."set_dialog_name|"..ADMIN_DONATE_DIALOG.."|\n"
     dialog=dialog.."set_default_color|`w|\n"
     dialog=dialog.."add_label_with_icon|big|`#ADMIN PANEL  DONATE EVENT``|left|20628|\n"
     dialog=dialog.."add_custom_break|\n"
     if msg then dialog=dialog.."add_smalltext|"..msg.."|\nadd_custom_break|\n" end

 
     dialog=dialog.."add_smalltext|`oTotal Server Donation: `w"..string.format("%.2f",total).." BGL``|\n"
     dialog=dialog.."add_textbox|`wGoal (BGL): `o"..GOAL_REQUIRED_BGL.."``|\n"
     dialog=dialog.."add_text_input|goal_bgl|Set Goal|"..GOAL_REQUIRED_BGL.."|5|\n"
     dialog=dialog.."add_textbox|`wReward Item ID: `o"..REWARD_ITEM.."``|\n"
     dialog=dialog.."add_text_input|reward_item|Set Reward Item ID|"..REWARD_ITEM.."|5|\n"
     dialog=dialog.."add_textbox|`wReward Amount: `o"..REWARD_AMOUNT.."``|\n"
     dialog=dialog.."add_text_input|reward_amount|Set Reward Amount|"..REWARD_AMOUNT.."|5|\n"
     dialog=dialog.."add_textbox|`wTop Winners: `o"..TOP_N_WINNERS.."``|\n"
     dialog=dialog.."add_text_input|top_winners|Set Top Winners|"..TOP_N_WINNERS.."|5|\n"
     dialog=dialog.."add_textbox|`wEvent Duration: `o"..getDurationText().."``|\n"
     dialog=dialog.."add_text_input|event_duration|Set Duration (e.g., 30m, 4h, 7d)|7d|5|\n"
     dialog=dialog.."add_button|save_admin|`2Save Settings`|\n"
     dialog=dialog.."add_button|reset_event|`4Reset Event`|\n"
     dialog=dialog.."end_dialog|"..ADMIN_DONATE_DIALOG.."|Close||"
 
     return dialog
end

-- ================== Command Handlers ==================
registerLuaCommand({command="donate",roleRequired=0,description="Open donation GUI."})
registerLuaCommand({command="claimreward",roleRequired=0,description="Claim your reward."})
registerLuaCommand({command="dadmin",roleRequired=51,description="Open donation admin panel."})

onPlayerCommandCallback(function(_,player,cmd)
     if cmd=="donate" then
         player:onDialogRequest(buildDonateDialog(player))
         return true
     elseif cmd=="claimreward" then
         player:onDialogRequest(buildClaimRewardDialog(player))
         return true
     elseif cmd=="dadmin" and player:hasRole(51) then
         player:onDialogRequest(buildAdminDialog(player))
         return true
    
     end
     return false
end)

-- ================== Dialog Handlers ==================
onPlayerDialogCallback(function(_,player,data)
     local wl,dl,bgl = 242,1796,7188

     -- Donations
     if data.dialog_name==DONATE_EVENT_DIALOG then
         if data.buttonClicked=="donate_wl" and player:getItemAmount(wl)>0 then
             player:changeItem(wl,-1,0)
             handleDonation(player,"WL",VALUE_WL)
             return true
         elseif data.buttonClicked=="donate_dl" and player:getItemAmount(dl)>0 then
  
            player:changeItem(dl,-1,0)
             handleDonation(player,"DL",VALUE_DL)
             return true
         elseif data.buttonClicked=="donate_bgl" and player:getItemAmount(bgl)>0 then
             player:changeItem(bgl,-1,0)
             handleDonation(player,"BGL",VALUE_BGL)
             return true
         
 else
             player:onDialogRequest(buildDonateDialog(player,"`4You dont have any locks to donate!``"))
             return true
         end
     end

     -- Reward claims
     if data.dialog_name==CLAIM_REWARD_DIALOG and data.buttonClicked=="claim_reward" then
         local name = player:getCleanName()
         local reward = claimRewards[name]
         if reward and winnerDeclared 
 then
             player:changeItem(reward.itemID,reward.amount,0)
             claimRewards[name]=nil
             saveDataToServer(SAVE_CLAIM_REWARDS,claimRewards)
         end
         player:onDialogRequest(buildClaimRewardDialog(player))
         return true
     end

     -- Admin
     if data.dialog_name==ADMIN_DONATE_DIALOG then
         if data.buttonClicked=="reset_event" then
    
          resetDonateEvent(true)
             player:onDialogRequest(buildAdminDialog(player,"`2Event reset successfully.``"))
             return true
         elseif data.buttonClicked=="save_admin" then
             -- Goal
             local goal = tonumber(data.goal_bgl)
             if goal then GOAL_REQUIRED_BGL=goal end

    
          -- Reward
             local rewardItem = tonumber(data.reward_item)
             if rewardItem then REWARD_ITEM=rewardItem end
             local rewardAmount = tonumber(data.reward_amount)
             if rewardAmount then REWARD_AMOUNT=rewardAmount end

             -- Top winners
         
     local topWinners = tonumber(data.top_winners)
             if topWinners then TOP_N_WINNERS=topWinners end

             -- Duration
             local durationInput = data.event_duration
             if durationInput then
                 local num,unit = durationInput:match("([%d%.]+)([mhd]?)")
           
       if num then
                     num = tonumber(num)
                     local seconds = 0
                     if unit=="m" then seconds = num*60
                   
   elseif unit=="h" then seconds = num*3600
                     else seconds = num*86400 end
                     if seconds>=60 then
                         DONATE_DURATION = seconds
                  
        saveStringToServer(SAVED_DONATE_DURATION,tostring(DONATE_DURATION))
                     end
                 end
             end

             player:onDialogRequest(buildAdminDialog(player,"`2Settings saved successfully.``"))
             return true
         end
    
     end

     return false
end)

-- ================== Tick Handler ==================
onTick(function()
     checkEventEnd()
end)

### File: Easterdata.lua
print("(Loaded) Mentahan Block Gacha drop script for Satya")

local dropItems = {
    {name = "Aqua Wings", itemID = 10170, chance = 10},
        {name = "Bling Wings", itemID = 10168, chance = 10},
            {name = "Cosmic Force", itemID = 13930, chance = 8},
                {name = "Crack-a-lackin Kraken", itemID = 13934, chance = 5},
                    {name = "EQ Aura", itemID = 12634, chance = 6},
                        {name = "Ghoulish Wings", itemID = 10188, chance = 7},
                            {name = "Growtopia Fried Wings", itemID = 10178, chance = 5},
                                {name = "Heart of Diamond Crown", itemID = 13932, chance = 6},
                                    {name = "Kanji Scarf", itemID = 12630, chance = 5},
                                        {name = "Lightning Umbrella", itemID = 11292, chance = 3},
                                            {name = "Lightning Wings", itemID = 12638, chance = 4},
                                                {name = "Lucid Wings", itemID = 11294, chance = 6},
                                                    {name = "Minokawa Wings", itemID = 12640, chance = 4},
                                                        {name = "Musical Wings", itemID = 10182, chance = 6},
                                                            {name = "Neon Party Cape", itemID = 11300, chance = 5},
                                                                {name = "Neon Wings", itemID = 10172, chance = 3},
                                                                    {name = "Party Plume Wings", itemID = 10180, chance = 6},
                                                                        {name = "Robot Lord Cape", itemID = 11290, chance = 4},
                                                                            {name = "Sacred Scarf", itemID = 11302, chance = 3},
                                                                                {name = "Sakura's Revenge", itemID = 11298, chance = 5},
                                                                                    {name = "Shattered Spear", itemID = 12628, chance = 0.1},
                                                                                        {name = "Soaring Beast", itemID = 13936, chance = 0.1},
                                                                                            {name = "Soulforge Wings", itemID = 13938, chance = 0.1},
                                                                                                {name = "Starfire Crown", itemID = 12632, chance = 6},
                                                                                                    {name = "Synthwave Shoes", itemID = 13940, chance = 4},
                                                                                                        {name = "Super Speeder", itemID = 12636, chance = 5},
                                                                                                            {name = "Tornado Aura", itemID = 13942, chance = 4},
                                                                                                                {name = "Wyvern Wings", itemID = 11288, chance = 6},
                                                                                                                    {name = "Mythic Rayman", itemID = 20560, chance = 0.1},
                                                                                                                        {name = "locket", itemID= 9344, chance = 2},
                                                                                                                            {name = "scarf of chains", itemID = 13022, chance = 4},
                                                                                                                                {name = "Soul Aura", itemID = 14028, chance = 2},
                                                                                                                                    {name = "TikTok Rayman", itemID = 20564, chance = 0.1},
                                                                                                                                        {name = "Bunny Shoes", itemID = 4556, chance = 2},
                                                                                                                                            {name = "Rift Wings", itemID = 11478, chance = 0.1},
                                                                                                                                                {name = "Rift Cape", itemID = 10424, chance = 2},
                                                                                                                                                    {name = "Rainbow Wings", itemID = 1672, chance = 6},
                                                                                                                                                        {name = "Ances Blue", itemID = 5150, chance = 2}, 
                                                                                                                                                            {name = "Dark Crown", itemID = 11288, chance = 2},
                                                                                                                                                                {name = "kiwi Sword", itemID = 13486, chance = 10},
                                                                                                                                                                    {name = "Nanas Sword", itemID = 13486, chance = 8},
                                                                                                                                                                        {name = "Dragon Fruit Busin", itemID = 13494, chance = 6},
                                                                                                                                                                            {name = "Ultra Aura", itemID = 11050, chance = 6},
                                                                                                                                                                                {name = "infinity horn", itemID = 6782, chance = 3},
                                                                                                                                                                                    {name = "Anime Hair", itemID = 11154, chance = 4},
                                                                                                                                                                                        {name = "Ances Green", itemID = 5168, chance = 3},
                                                                                                                                                                                            {name = "Destroyer", itemID = 11140, chance = 6},
                                                                                                                                                                                                {name = "Legend Blue Wing", itemID = 20592, chance = 0.1},
                                                                                                                                                                                                    {name = "Blue Gem Lock", itemID = 7188, chance = 0.1},
                                                                                                                                                                                                        {name = "Matrix", itemID = 12864, chance = 4},
                                                                                                                                                                                                            {name = "King Crown", itemID = 4626, chance = 6},
                                                                                                                                                                                                                {name = "Fish Freeze", itemID = 12880, chance = 5},
                                                                                                                                                                                                                    {name = "Ances Yellow", itemID = 5134, chance = 0.1},
                                                                                                                                                                                                                        {name = "Captain Hat", itemID = 6904, chance = 6},
                                                                                                                                                                                                                            {name = "World Lock", itemID = 242, chance = 9},
                                                                                                                                                                                                                                {name = "Dirt", itemID = 2, chance = 10},
                                                                                                                                                                                                                                  {name = "Shotgun", itemID = 25202, chance = 7}
                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                math.randomseed(os.time())

                                                                                                                                                                                                                                local function getRandomDrop()
                                                                                                                                                                                                                                    local totalChance = 0
                                                                                                                                                                                                                                        for _, drop in ipairs(dropItems) do
                                                                                                                                                                                                                                                totalChance = totalChance + drop.chance
                                                                                                                                                                                                                                                    end

                                                                                                                                                                                                                                                        local randomRoll = math.random(1, totalChance)
                                                                                                                                                                                                                                                            local cumulativeChance = 0

                                                                                                                                                                                                                                                                for _, drop in ipairs(dropItems) do
                                                                                                                                                                                                                                                                        cumulativeChance = cumulativeChance + drop.chance
                                                                                                                                                                                                                                                                                if randomRoll <= cumulativeChance then
                                                                                                                                                                                                                                                                                            print("name: " .. drop.name .. " itemid: " .. drop.itemID .. " chance: " .. drop.chance)
                                                                                                                                                                                                                                                                                                        return drop
                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                    end

                                                                                                                                                                                                                                                                                                                        return nil
                                                                                                                                                                                                                                                                                                                        end

                                                                                                                                                                                                                                                                                                                        onTileBreakCallback(function(world, player, tile)
                                                                                                                                                                                                                                                                                                                            local tileID = tile:getTileID()

                                                                                                                                                                                                                                                                                                                                if tileID == 10716 then
                                                                                                                                                                                                                                                                                                                                        local drop = getRandomDrop()
                                                                                                                                                                                                                                                                                                                                                if drop then
                                                                                                                                                                                                                                                                                                                                                            world:spawnItem(tile:getPosX(), tile:getPosY(), drop.itemID, 1)
                                                                                                                                                                                                                                                                                                                                                                        player:onConsoleMessage("`2You found " .. drop.name .. "!", 0)
                                                                                                                                                                                                                                                                                                                                                                                    return true
                                                                                                                                                                                                                                                                                                                                                                                            end
                                                                                                                                                                                                                                                                                                                                                                                                end
                                                                                                                                                                                                                                                                                                                                                                                                    return false
                                                                                                                                                                                                                                                                                                                                                                                                    end)

### File: DynamicGacha.lua
print("(Loaded) Dynamic Gacha System Script for GrowSoft")

-- 0.01 = 1%, 0.50 = 50%, and 1 = 100%
local dropSets = {
    -- Set 1: Regular Drops (No Events)
    {
        {itemID = 2, chance = 0.90},
        {itemID = 10, chance = 1},
        {itemID = 10170, chance = 0.01},
        {itemID = 10168, chance = 1},
    },

    -- Set 2: Event 2 (Ex. Phoenix Rising)
    {
        {itemID = 2, chance = 0.10},
        {itemID = 10, chance = 0.25},
        {itemID = 1674, chance = 0.01},
        {itemID = 9730, chance = 0.15},
        {itemID = 8588, chance = 0.10},
    },

    -- Set 3: Event 3 (Ex. Summer Surprise)
    {
        {itemID = 2, chance = 0.10},
        {itemID = 10, chance = 0.10},
        {itemID = 12188, chance = 0.01},
        {itemID = 9758, chance = 0.01},
    },
}

-- Choose Active Drop Set
local activeDropSetIndex = 2

math.randomseed(os.time())

local function rareItem(player)
    return player:onTalkBubble(player:getNetID(), "`2I got rare item!", 0)
end

local function getItemName(itemID)
    local item = getItem(itemID)
    if item then
        return item:getName()
    else
        return "Unknown Item"
    end
end

local function getRandomDrop(player)
    local dropItems = dropSets[activeDropSetIndex]
    local totalChance = 0

    for _, drop in ipairs(dropItems) do
        totalChance = totalChance + (drop.chance * 100)
    end

    local randomRoll = math.random(1, totalChance)
    local cumulativeChance = 0

    for _, drop in ipairs(dropItems) do
        cumulativeChance = cumulativeChance + (drop.chance * 100)
        if randomRoll <= cumulativeChance then
            local itemName = getItemName(drop.itemID)
            print("name: " .. itemName .. " itemid: " .. drop.itemID .. " chance: " .. drop.chance)

            if drop.chance <= 0.05 then
                rareItem(player)
            end

            return {name = itemName, itemID = drop.itemID}
        end
    end

    return nil

end

-- Change tileID with your Gacha Block ID. Check itemID of an item using info.
onTileBreakCallback(function(world, player, tile)
    local tileID = tile:getTileID()
    if tileID == 25018 then
        local drop = getRandomDrop(player)
        if drop then
            world:spawnItem(tile:getPosX(), tile:getPosY(), drop.itemID, 1)
            player:onConsoleMessage("`2You found " .. drop.name .. "!", 0)
            return true
        end
    end

    return false

end)

### File: disablepiggybank.lua
onPlayerVariantCallback(function(player, variant, delay, netID)
    local first_element = variant[1]
    local second_element = variant[2]

    -- Disable only specific left-side buttons
    if first_element == "OnEventButtonDataSet" and (
        second_element == "Coins" or
        second_element == "PowerOrb" or
        second_element == "PiggyBankButton" or
        second_element == "ClashEventButton"
    ) then
        player:sendVariant({
            "OnEventButtonDataSet",
            second_element,
            0, -- disabled
            variant[4]
        }, delay, netID)
        return true
    end

    return false
end)

### File: dontbuyuselessscriptslol.lua.txt
local blacklistedItems = {
    242,
    1796,
    7188,
    4994,
    2408,
    5814,
    9640,
}

local blacklistCommand = {
    command = "blacklist",
    roleRequired = 51,
    description = "Blacklist item from /find: /blacklist [itemID]"
}

local whitelistCommand = {
    command = "whitelist",
    roleRequired = 51,
    description = "Remove item from blacklist: /whitelist [itemID]"
}

registerLuaCommand(blacklistCommand)
registerLuaCommand(whitelistCommand)

local function isBlacklisted(itemID)
    for i, id in ipairs(blacklistedItems) do
      
   if id == itemID then
            return true
        end
    end
    return false
end

onPlayerCommandCallback(function(world, player, fullCommand)
    local command, args = fullCommand:match("^(%S+)%s*(.*)")
    
    if command == "blacklist" then
        if not player:hasRole(51) then
            player:onConsoleMessage("`4Access denied! Admin only.")
            return true
   
      end
        
        if args and args ~= "" then
            local itemID = tonumber(args)
            if itemID then
                if not isBlacklisted(itemID) then
                    table.insert(blacklistedItems, itemID)
    
                 local item = getItem(itemID)
                    local name = item and item:getName() or "Unknown"
                    player:onConsoleMessage("`2Blacklisted: " .. name .. " (ID: " .. itemID .. ")")
                else
       
              player:onConsoleMessage("`4Item " .. itemID .. " already blacklisted")
                end
            else
                player:onConsoleMessage("`4Invalid item ID")
            end
        else
            player:onConsoleMessage("`9Blacklisted items:")
 
            for i, id in ipairs(blacklistedItems) do
                local item = getItem(id)
                local name = item and item:getName() or "Unknown"
                player:onConsoleMessage("`o- " .. id .. ": " .. name)
            end
      
   end
        return true
    elseif command == "whitelist" then
        if not player:hasRole(51) then
            player:onConsoleMessage("`4Access denied!
 Admin only.")
            return true
        end
        
        if args and args ~= "" then
            local itemID = tonumber(args)
            if itemID then
                for i, blacklistedID in ipairs(blacklistedItems) do
      
               if blacklistedID == itemID then
                        table.remove(blacklistedItems, i)
                        local item = getItem(itemID)
                        local name = item and item:getName() 
 or "Unknown"
                        player:onConsoleMessage("`2Whitelisted: " .. name .. " (ID: " .. itemID .. ")")
                        return true
                    end
                end
   
              player:onConsoleMessage("`4Item " .. itemID .. " not in blacklist")
            else
                player:onConsoleMessage("`4Invalid item ID")
            end
        else
            player:onConsoleMessage("`9Usage: /whitelist [itemID]")
        end
       
  return true
    end
    
    return false
end)

onPlayerDialogCallback(function(world, player, data)
    if data["dialog_name"] == "templateFind" then
        if data["buttonClicked"] == "takeItems" then
            local blockedItems = {}
            local allowedItems = {}
            
            for key, value in pairs(data) do
    
             if key:match("^get_(%d+)$") and value == "1" then
                    local itemID = tonumber(key:match("^get_(%d+)$"))
                    if itemID then
                        if isBlacklisted(itemID) then
           
                          local item = getItem(itemID)
                            local name = item and item:getName() or "Unknown"
                            table.insert(blockedItems, name .. " (ID: " .. itemID .. ")")
        
                 else
                            table.insert(allowedItems, itemID)
                        end
                    end
           
          end
            end
            
            if #blockedItems > 0 then
                player:onConsoleMessage("`4?
 Blocked items from /find:")
                for i, itemName in ipairs(blockedItems) do
                    player:onConsoleMessage("`4- " .. itemName)
                end
                
                if #allowedItems > 0 then
 
                    player:onConsoleMessage("`2? Allowed items will still be taken:")
                    for i, itemID in ipairs(allowedItems) do
                        local item = getItem(itemID)
                       
  local name = item and item:getName() or "Unknown"
                        player:onConsoleMessage("`2- " .. name .. " (ID: " .. itemID .. ")")
                    end
                else
                    player:onConsoleMessage("`4All 
 selected items were blocked!")
                    return true
                end
            end
            
            if #blockedItems > 0 then
                return true
   
          end
        end
    end
    
    return false
end)

### File: ducttape.lua
-- Duct Tape Script
print("Loading duct tape script...")

local ductTapeId = 0
local ductTapeDuration = 10*60

onPlayerConsumableCallback(function(world, player, tile, clickedPlayer, itemID)
    if itemID == getEnumItem("ITEM_DUCT_TAPE"):getID() then
        if clickedPlayer == nil then
            player:onTalkBubble(player:getNetID(), "`wMust be used on a person.``", 1)
            return true
        end
        if clickedPlayer:hasMod(ductTapeId) then
            player:onTalkBubble(player:getNetID(), "`wThis player is already silenced.``", 1)
            return true
        end
        if player:changeItem(itemID, -1, 0) then
            clickedPlayer:addMod(ductTapeId, ductTapeDuration)
            world:useItemEffect(player:getNetID(), itemID, clickedPlayer:getNetID(), 0)
            player:updateStats(world, PlayerStats.ConsumablesUsed, 1)
            world:updateClothing(clickedPlayer)
            clickedPlayer:playAudio("already_used.wav")
            return true
        end
        return true
    end
    return false
end)

### File: custom-world.lua.txt
print("Example Script")
-- NOTE : DONT SELL THIS SCRIPT, THIS SCRIPT IS FREE TO USE!!
local commands = {"customworld","cworld"}
local DEV = 51

registerLuaCommand({
  command = commands[1],
  description = "Custom World for your server",
  roleRequired = DEV
})

local function FormDialog(...)
  local dialogue = table.concat({
          "set_default_color|`o",
          "set_border_color|60,130,200,200|",
          "set_bg_color|60,130,200,100|",
          "add_label_with_icon|big|Custom World|left|2|\n",
          "add_textbox|Make Customize World Template|",
          "add_spacer|small|",
       
    string.format("add_text_input|size_x|Width: |%d|3", select(2,...)),
          string.format("add_text_input|size_y|Height: |%d|3",select(3,...)),
          "add_spacer|small|",
          "add_button|submit|Submit|noflags|0|0|",
          "add_quick_exit|",
          "end_dialog|cw_dialog||"
        }, "\n")
      
  select(1,...):onDialogRequest(dialogue)
end

onPlayerCommandCallback(function(_,py,cmd)
    if py:hasRole(DEV) and (cmd:lower() == commands[1] or cmd:lower() == commands[2]) then
        FormDialog(py, 100, 60)
   
  return true
    end
  return false
end)

onPlayerDialogCallback(function(_, py, data)
  if data["dialog_name"] == "cw_dialog" then
    if data["buttonClicked"] == "submit" then
    local cx,cy=tonumber(data["size_x"]),tonumber(data["size_y"]) local WorldName = nil
    for i=1000,9999 do
      local cnd="TEMPLATE"..tostring(i)
      if not worldExists(cnd) then WorldName = cnd break end
    end
    
    local www = World.new(WorldName,cx,cy,0)
        
    local BEDROCK_ID  = 8
    local ROCK_ID   
   = 10
    local LAVA_ID     = 4
    local DIRT_ID     = 2
    local MAINDOOR_ID = 6
    local BACKGROUND_SURFACE_ID       = 14
    
    local width  = www:getWorldSizeX()
    local height = www:getWorldSizeY()
    local maindoorPlaced = false
    local doorX, doorY = nil, nil
    
    for y = 0, height - 1 do
     
    for x = 0, width - 1 do
            local tile = www:getTile(x, y)
            local ratio = y / height
            if not maindoorPlaced and y == math.floor(height * 0.35) then
                doorX = math.random(0, width - 1)
               
  doorY = y
                local tile_door = www:getTile(doorX, y)
                www:setTileForeground(tile_door, MAINDOOR_ID)
                maindoorPlaced = true
                local tileUnder = www:getTile(doorX, y + 1)
                if tileUnder then
  
                   www:setTileForeground(tileUnder, BEDROCK_ID)
                end
            end
            if ratio > 0.35 and ratio <= 0.45 then
                if not (maindoorPlaced and y == doorY + 1 and x == doorX) then
    
                 www:setTileForeground(tile, DIRT_ID)
                end
            elseif ratio > 0.45 and ratio <= 0.85 then
                if math.random() < 0.04 then
                    www:setTileForeground(tile, ROCK_ID)
      
           else
                    www:setTileForeground(tile, DIRT_ID)
                end
            elseif ratio > 0.85 and ratio <= 0.90 then
                local r = math.random()
              
  if r < 0.4 then
                    www:setTileForeground(tile, LAVA_ID)
                elseif r < 0.025 then
                    www:setTileForeground(tile, ROCK_ID)
                else
                
    www:setTileForeground(tile, DIRT_ID)
                end
            elseif ratio > 0.90 then www:setTileForeground(tile, BEDROCK_ID) end
            if ratio > 0.35 then www:setTileBackground(tile, BACKGROUND_SURFACE_ID) end
        end
    end

    www:save()
    py:enterWorld(WorldName,"")
    py:onTextOverlay("`2Success Make Custom World")
    return true
    end
  end
  return 
 false
end)

### File: Donate.lua
-- gemdonate script
print("(Loaded) Gem Donate script for GrowSoft - nov4")

local DONATE_STORAGE_KEY = "tierpsdatabase1"

local donateData = {
    pendingRewards = {},
    totalGemsDonated = 0,
    totalWLDistributed = 0,
    totalDLDistributed = 0,
    totalBGLDistributed = 0,
    playerDonations = {},
    featureEnabled = true
}

local function loadDonateData()
    local loadedData = loadDataFromServer(DONATE_STORAGE_KEY)
    if loadedData and type(loadedData) == 'table' then
        donateData.pendingRewards = loadedData.pendingRewards or {}
        donateData.totalGemsDonated = loadedData.totalGemsDonated or 0
        donateData.totalWLDistributed = loadedData.totalWLDistributed or 0
        donateData.totalDLDistributed = loadedData.totalDLDistributed or 0
        donateData.totalBGLDistributed = loadedData.totalBGLDistributed or 0
        donateData.playerDonations = loadedData.playerDonations or {}
        donateData.featureEnabled = loadedData.featureEnabled == nil and true or loadedData.featureEnabled
    end
end

local function saveDonateData()
    saveDataToServer(DONATE_STORAGE_KEY, donateData)
end

local GEMS_PER_WL = 2000
local DOUBLE_REWARD_CHANCE = 25

local WL_ID = 242  -- World Lock
local DL_ID = 1796 -- Diamond Lock
local BGL_ID = 7188 -- Blue Gem Lock

local WL_TO_DL_RATE = 100
local DL_TO_BGL_RATE = 100

local CLAIM_CHUNK_SIZE = 200

function formatNumber(num)
    if num == nil then return "0" end
    return tostring(num):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")
end

local function calculateReward(donatedGems)
    local baseUnits = math.floor(donatedGems / GEMS_PER_WL)
    local totalWL = 0

    if baseUnits > 0 then
        for i = 1, baseUnits do
            local chanceRoll = math.random(1, 100)
            local wlForThisUnit = 1
            if chanceRoll <= DOUBLE_REWARD_CHANCE then
                wlForThisUnit = wlForThisUnit * 2
            end
            totalWL = totalWL + wlForThisUnit
        end
    end
    return totalWL
end

-- Function to handle auto-conversion
local function autoConvertItems(player, worldLockAmount)
    local diamondLockAmount = 0
    local blueGemLockAmount = 0
    local remainingWL = worldLockAmount

    if remainingWL >= WL_TO_DL_RATE then
        diamondLockAmount = math.floor(remainingWL / WL_TO_DL_RATE)
        remainingWL = remainingWL % WL_TO_DL_RATE
    end

    local remainingDL = diamondLockAmount
    if remainingDL >= DL_TO_BGL_RATE then
        blueGemLockAmount = math.floor(remainingDL / DL_TO_BGL_RATE)
        remainingDL = remainingDL % DL_TO_BGL_RATE
    end
    
    return remainingWL, remainingDL, blueGemLockAmount
end

-- Function to try giving items to player or store as pending
local function giveOrPendReward(player, rewardWL, rewardDL, rewardBGL)
    local playerId = player:getUserID()
    
    -- Ensure player's pending rewards entry exists within donateData.pendingRewards
    donateData.pendingRewards[playerId] = donateData.pendingRewards[playerId] or {wl = 0, dl = 0, bgl = 0}

    local itemsGivenSuccessfully = {wl = 0, dl = 0, bgl = 0}
    local itemsNotGiven = {wl = rewardWL, dl = rewardDL, bgl = rewardBGL}
    
    local inventoryFullMessageSent = false

    -- Try giving BGL first
    if itemsNotGiven.bgl > 0 then
        if player:isMaxInventorySpace() then
            if not inventoryFullMessageSent then player:onConsoleMessage("`4Inventory full! Claim rewards later using /donate.``"); inventoryFullMessageSent = true end
        else
            if player:changeItem(BGL_ID, itemsNotGiven.bgl, 0) then
                itemsGivenSuccessfully.bgl = itemsNotGiven.bgl
                itemsNotGiven.bgl = 0
                donateData.totalBGLDistributed = donateData.totalBGLDistributed + itemsGivenSuccessfully.bgl
            end
        end
    end

    -- Try giving DL
    if itemsNotGiven.dl > 0 then
        if player:isMaxInventorySpace() then
            if not inventoryFullMessageSent then player:onConsoleMessage("`4Inventory full! Claim rewards later using /donate.``"); inventoryFullMessageSent = true end
        else
            if player:changeItem(DL_ID, itemsNotGiven.dl, 0) then
                itemsGivenSuccessfully.dl = itemsNotGiven.dl
                itemsNotGiven.dl = 0
                donateData.totalDLDistributed = donateData.totalDLDistributed + itemsGivenSuccessfully.dl
            end
        end
    end

    -- Try giving WL
    if itemsNotGiven.wl > 0 then
        if player:isMaxInventorySpace() then
            if not inventoryFullMessageSent then player:onConsoleMessage("`4Inventory full! Claim rewards later using /donate.``"); inventoryFullMessageSent = true end
        else
            if player:changeItem(WL_ID, itemsNotGiven.wl, 0) then
                itemsGivenSuccessfully.wl = itemsNotGiven.wl
                itemsNotGiven.wl = 0
                donateData.totalWLDistributed = donateData.totalWLDistributed + itemsGivenSuccessfully.wl
            end
        end
    end

    -- Update pending rewards with items not given
    donateData.pendingRewards[playerId].wl = donateData.pendingRewards[playerId].wl + itemsNotGiven.wl
    donateData.pendingRewards[playerId].dl = donateData.pendingRewards[playerId].dl + itemsNotGiven.dl
    donateData.pendingRewards[playerId].bgl = donateData.pendingRewards[playerId].bgl + itemsNotGiven.bgl

    saveDonateData() -- Save after updating distributed and pending

    local messageReceived = ""
    if itemsGivenSuccessfully.wl > 0 then messageReceived = messageReceived .. itemsGivenSuccessfully.wl .. " World Lock " end
    if itemsGivenSuccessfully.dl > 0 then messageReceived = messageReceived .. itemsGivenSuccessfully.dl .. " Diamond Lock " end
    if itemsGivenSuccessfully.bgl > 0 then messageReceived = messageReceived .. itemsGivenSuccessfully.bgl .. " Blue Gem Lock " end

    if #messageReceived > 0 then
        player:onConsoleMessage("`2You received: " .. messageReceived .. "``")
    end

    if donateData.pendingRewards[playerId].wl > 0 or donateData.pendingRewards[playerId].dl > 0 or donateData.pendingRewards[playerId].bgl > 0 then
        if not inventoryFullMessageSent then -- Only send if it wasn't sent due to full inventory
            player:onConsoleMessage("`wSome rewards are pending due to full inventory. Use /donate to claim!``")
        end
    end
end

-- Function to show the developer donate dialog
local function showDeveloperDonateDialog(player)
    local devDialogText = string.format([[
set_default_color|`$
add_label_with_icon|big|`6Donate System - DEV Panel`0|left|%d|
add_spacer|small|
add_textbox|Total Gems Donated: `w%s`0|
add_textbox|Total WL Distributed: `w%s`0|
add_textbox|Total DL Distributed: `w%s`0|
add_textbox|Total BGL Distributed: `w%s`0|
add_spacer|small|
add_textbox|`6Feature Status:`0 `w%s`0|
add_button|toggle_feature|`2Toggle Donate Feature (%s)``|
add_quick_exit|
end_dialog|dev_donate_dialog|Close|
]]
, WL_ID, formatNumber(donateData.totalGemsDonated), formatNumber(donateData.totalWLDistributed), 
   formatNumber(donateData.totalDLDistributed), formatNumber(donateData.totalBGLDistributed),
   (donateData.featureEnabled and "ENABLED" or "DISABLED"),
   (donateData.featureEnabled and "Disable" or "Enable"))

    -- Removed Top Donors Leaderboard as per user request to simplify

    -- Add developer give reward button
    devDialogText = devDialogText .. [[
add_spacer|small|
add_quick_exit|
]]
    player:sendVariant({"OnDialogRequest", devDialogText})
end


-- Function to show the donate dialog (or claim dialog)
local function showDonateDialog(player)
    local playerId = player:getUserID()
    
    -- Feature enabled check for regular users
    if not donateData.featureEnabled then
        player:onConsoleMessage("`4The donate feature is currently disabled.``")
        return
    end

    local playerPending = donateData.pendingRewards[playerId]

    if playerPending and (playerPending.wl > 0 or playerPending.dl > 0 or playerPending.bgl > 0) then
        -- Show claim dialog
        local claimDialogText = string.format([[
set_default_color|`$
add_label_with_icon|big|`6Claim Pending Rewards`0|left|%d|
add_spacer|small|
add_textbox|You have pending rewards to claim:|
add_spacer|small|
]], WL_ID) -- Using WL_ID icon for claim dialog
        if playerPending.wl > 0 then
            claimDialogText = claimDialogText .. "add_textbox|`w" .. formatNumber(playerPending.wl) .. " World Locks``|add_spacer|tiny|"
        end
        if playerPending.dl > 0 then
            claimDialogText = claimDialogText .. "add_textbox|`w" .. formatNumber(playerPending.dl) .. " Diamond Locks``|add_spacer|tiny|"
        end
        if playerPending.bgl > 0 then
            claimDialogText = claimDialogText .. "add_textbox|`w" .. formatNumber(playerPending.bgl) .. " " .. getItem(BGL_ID):getName() .. "s``|add_spacer|tiny|" -- Using getName() for clarity
        end
        claimDialogText = claimDialogText .. [[
add_spacer|small|
add_button|claim_rewards|`2Claim Rewards`0|
add_quick_exit|
end_dialog|donate_claim_dialog|Close|
]]
        player:sendVariant({"OnDialogRequest", claimDialogText})
    else
        -- Show main donate dialog
        local donateDialogText = string.format([[
set_default_color|`$
add_label_with_icon|big|`6Donate Gems`0|left|%d|
add_spacer|small|
add_textbox|Donate gems to receive World Locks! Your current gems: `w%s`0|
add_label_with_icon|small|`6Donate 2000 Gems : `91 World Lock. `oChance to get double : `225 Percent|left|112|
add_spacer|small|
add_text_input|gems_amount|Amount to Donate:|0|9|
add_spacer|small|
add_button|donate_confirm|`2Donate`0|
add_quick_exit|
end_dialog|donate_main_dialog|Close|
]], WL_ID, formatNumber(player:getGems()))
        player:sendVariant({"OnDialogRequest", donateDialogText})
    end
end

-- Command data table
local donateCommandData = {
    command = "donate",
    roleRequired = Roles.ROLE_NONE, -- Accessible to all
    description = "Donate gems to receive rewards!"
}
registerLuaCommand(donateCommandData)

-- Callback for player commands
onPlayerCommandCallback(function(world, player, fullCommand)
    local command, args = fullCommand:match("^(%S+)%s*(.*)")
    if command == donateCommandData.command then
        -- Developer check for sub-command
        if player:hasRole(Roles.ROLE_DEVELOPER) or player:hasRole(Roles.ROLE_ADMIN) then
            if args == "dev" then
                showDeveloperDonateDialog(player)
                return true
            end
        end
        
        -- Regular user or developer using /donate (without 'dev' sub-command)
        showDonateDialog(player)
        return true
    end
    return false
end)

-- Callback for player dialogs
onPlayerDialogCallback(function(world, player, data)
    local playerId = player:getUserID()

    if data["dialog_name"] == "donate_main_dialog" then
        if not data["buttonClicked"] then return true end -- Dialog closed
        
        if data["buttonClicked"] == "donate_confirm" then
            local gemsAmount = tonumber(data["gems_amount"])
            if not gemsAmount or gemsAmount <= 0 then
                player:onConsoleMessage("`4Invalid amount of gems.``")
                showDonateDialog(player) -- Reopen dialog
                return true
            end

            if player:getGems() < gemsAmount then
                player:onConsoleMessage("`4You don't have enough gems!``")
                showDonateDialog(player) -- Reopen dialog
                return true
            end

            player:removeGems(gemsAmount,0,1)
            
            -- Update total gems donated stat
            donateData.totalGemsDonated = donateData.totalGemsDonated + gemsAmount
            saveDonateData()

            -- Update player's individual donation stat
            donateData.playerDonations[playerId] = (donateData.playerDonations[playerId] or 0) + gemsAmount
            saveDonateData()

            player:onConsoleMessage("`2You donated " .. formatNumber(gemsAmount) .. " gems!``")

            local rewardedWL = calculateReward(gemsAmount)
            if rewardedWL > 0 then
                local convertedWL, convertedDL, convertedBGL = autoConvertItems(player, rewardedWL)
                
                giveOrPendReward(player, convertedWL, convertedDL, convertedBGL)
            else
                player:onConsoleMessage("`wNo reward for this donation amount.``")
            end
            -- showDonateDialog(player) -- Reopen dialog to show pending or new state, or just close
        end
        return true
    elseif data["dialog_name"] == "donate_claim_dialog" then
        if not data["buttonClicked"] then return true end -- Dialog closed

        if data["buttonClicked"] == "claim_rewards" then
            local playerPending = donateData.pendingRewards[playerId] -- Access pending rewards from donateData
            if playerPending and (playerPending.wl > 0 or playerPending.dl > 0 or playerPending.bgl > 0) then
                local claimedThisAttemptWL = 0
                local claimedThisAttemptDL = 0
                local claimedThisAttemptBGL = 0

                -- Try claiming BGL in chunks
                if playerPending.bgl > 0 then
                    local amountToTry = math.min(playerPending.bgl, CLAIM_CHUNK_SIZE)
                    if not player:isMaxInventorySpace() then
                        if player:changeItem(BGL_ID, amountToTry, 0) then
                            claimedThisAttemptBGL = amountToTry
                        end
                    end
                end
                
                -- Try claiming DL in chunks
                if playerPending.dl > 0 then
                    local amountToTry = math.min(playerPending.dl, CLAIM_CHUNK_SIZE)
                    if not player:isMaxInventorySpace() then
                        if player:changeItem(DL_ID, amountToTry, 0) then
                            claimedThisAttemptDL = amountToTry
                        end
                    end
                end

                -- Try claiming WL in chunks
                if playerPending.wl > 0 then
                    local amountToTry = math.min(playerPending.wl, CLAIM_CHUNK_SIZE)
                    if not player:isMaxInventorySpace() then
                        if player:changeItem(WL_ID, amountToTry, 0) then
                            claimedThisAttemptWL = amountToTry
                        end
                    end
                end
                
                -- Update pending amounts based on what was actually claimed this attempt
                playerPending.bgl = playerPending.bgl - claimedThisAttemptBGL
                playerPending.dl = playerPending.dl - claimedThisAttemptDL
                playerPending.wl = playerPending.wl - claimedThisAttemptWL

                saveDonateData() -- Save changes to pending rewards

                local message = ""
                if claimedThisAttemptWL > 0 then message = message .. claimedThisAttemptWL .. " World Lock " end
                if claimedThisAttemptDL > 0 then message = message .. claimedThisAttemptDL .. " Diamond Lock " end
                if claimedThisAttemptBGL > 0 then message = message .. claimedThisAttemptBGL .. " Blue Gem Lock " end

                if #message > 0 then
                    player:onConsoleMessage("`2You claimed: " .. message .. "``")
                end

                if playerPending.wl == 0 and playerPending.dl == 0 and playerPending.bgl == 0 then
                    player:onConsoleMessage("`2All pending rewards claimed!``")
                    donateData.pendingRewards[playerId] = nil -- Clear pending rewards for this player from main data
                    saveDonateData()
                else
                    player:onConsoleMessage("`wInventory still full. Some rewards remain pending. Use /donate to claim!``")
                end
            else
                player:onConsoleMessage("`wNo pending rewards to claim.``")
            end
            showDonateDialog(player) -- Reopen dialog to update state (or close if all claimed)
        end
        return true
    elseif data["dialog_name"] == "dev_donate_dialog" then -- Handler for Developer Donate Panel
        if not data["buttonClicked"] then return true end -- Dialog closed
        
        if data["buttonClicked"] == "toggle_feature" then
            donateData.featureEnabled = not donateData.featureEnabled
            saveDonateData()
            player:onConsoleMessage("`2Donate feature is now " .. (donateData.featureEnabled and "ENABLED" or "DISABLED") .. "``")
            showDeveloperDonateDialog(player) -- Reopen dev dialog to show updated status
        elseif data["buttonClicked"] == "dev_give_reward" then
            local giveDevRewardDialog = [[
set_default_color|`$
add_label_with_icon|big|`6Give Dev Reward`0|left|]] .. WL_ID .. [[|
add_spacer|small|
add_textbox|Enter Item ID and Quantity to give to yourself:|
add_spacer|small|
add_text_input|give_item_id|Item ID:|0|9|
add_text_input|give_quantity|Quantity:|1|9|
add_spacer|small|
add_button|confirm_dev_give|`2Give Item`0|
add_quick_exit|
end_dialog|dev_give_dialog|Close|
]]
            player:sendVariant({"OnDialogRequest", giveDevRewardDialog})
        end
        return true
    elseif data["dialog_name"] == "dev_give_dialog" then -- Handler for Give Dev Reward input dialog
        if not data["buttonClicked"] then return true end -- Dialog closed

        if data["buttonClicked"] == "confirm_dev_give" then
            local itemID = tonumber(data["give_item_id"])
            local quantity = tonumber(data["give_quantity"])

            if not itemID or not quantity or itemID <= 0 or quantity <= 0 then
                player:onConsoleMessage("`4Invalid Item ID or Quantity.``")
            else
                local itemName = getItem(itemID):getName()
                if player:changeItem(itemID, quantity, 0) then
                    player:onConsoleMessage("`2Successfully gave " .. formatNumber(quantity) .. " " .. itemName .. " (ID: " .. itemID .. ")``")
                else
                    player:onConsoleMessage("`4Failed to give item. Check inventory space or item ID.``")
                end
            end
            showDeveloperDonateDialog(player) -- Return to dev panel
        end
        return true
    end
    return false
end)

-- Load data when the script first loads
loadDonateData()

### File: experimental-blocks.lua
-- Experimental Blocks Example script
--print("(Loaded) Experimental Blocks Example script for GrowSoft")

--math.randomseed(os.time())

--onTileBreakCallback(function(world, player, tile)
  --  local tileID = tile:getTileID();
   -- if tileID == getEnumItem("ITEM_LAVA"):getID() then
     --   local num = math.random(1, 4)
       -- if num == 1 then
         --   world:onCreateChatBubble(tile:getPosX() + 10, tile:getPosY() + 15, "`4Lava died``", 0)
           -- return true
    --    elseif num == 2 then
      --      world:onCreateExplosion(tile:getPosX(), tile:getPosY(), 5, 2) -- 5 is radius, 2 is power
       --     return true
     --   end
      --  return false
   -- end
   -- return false
--end)

### File: Farmtoken.dat
55]3 $$VI /<s.s ]V?=Z bQHejFK gchrO QroF Tu/N 0XQ{ [j({.$ 9[d7j2 4cu9 YVB| G:>0g=^a 9qAx 'Zp^ J'F> L^m- .z,E @Bys @Do{h 12|I KP_df yg4S O7^e  ;3P0Yw nkYD }h'k 'J1yC a>bT e0rs 1v0f xDs9F o^677 ys'> |_5M Q\tjz xj2  @i3a ATSw km-U ~^R- dv__ T2Sr }OCh /Yd4O ;1za M@%} WNJo YeuQ e/VYMEmk 5O$S7@ emrc uRC; h]k3 i%He MW{e KGgC \/@( w#AW gQ_,B-k a!pL f(;3 FB"J 0A0|D0R B1hB ti|'! 1$V=P a~XL ht0< m^x, "q+6! GQ60 7-60]Icl

### File: Findblacklist.lua.txt
print("(Loaded) Find Blacklist (Items Only) v1.3 by Ciyaaa  no loadstring, no pcall, persistent)")

-- ===== ROLES =====
local function isStaff(p)
  -- sesuaikan role servermu
  return p:hasRole(51) or p:hasRole(11) or p:hasRole(10) or p:hasRole(7) or p:hasRole(4)
end

-- ===== HELPERS =====
local function lower(s) return tostring(s or ""):lower() end
local function itemName(id)
  local it = getItem(id)
  return (it and it:getName()) or ("Item "..tostring(id))
end

-- ===== STORAGE (tanpa JSON/ loadstring) =====
-- format save: "v1:242,1796,7188"
local STORE_KEY = "FIND_BLACKLIST_ONLY_V1"
local DB = { set = {}, list = {} }

local function rebuildListFromSet()
  DB.list = {}
  for id,_ in pairs(DB.set) do
    DB.list[#DB.list+1] = { 
 id = id, name = itemName(id) }
  end
  table.sort(DB.list, function(a,b) return (a.name or "") < (b.name or "") end)
end

local function saveDB()
  local ids = {}
  for id,_ in pairs(DB.set) do ids[#ids+1] = tonumber(id) or id end
  table.sort(ids, function(a,b) return (a or 0) < (b or 0) end)
  local parts = {}
  for _,id in ipairs(ids) do parts[#parts+1] = tostring(id) end
  saveStringToServer(STORE_KEY, "v1:"..table.concat(parts, ","))
end

local function loadDB()
  local raw = loadStringFromServer(STORE_KEY)
  if not raw or raw == "" then return end
  local body = raw
  if body:sub(1,3) == "v1:" then 
 body = body:sub(4) end
  local set = {}
  for tok in tostring(body):gmatch("[^,]+") do
    local id = tonumber(tok)
    if id then set[id] = true end
  end
  DB.set = set
  rebuildListFromSet()
end
loadDB()

-- ===== BLACKLIST OPS =====
local function bl_has(id) return DB.set[tonumber(id) or -1] == true end

local function bl_add(id)
  id = tonumber(id);
 if not id then return false end
  if not DB.set[id] then
    DB.set[id] = true
    rebuildListFromSet()
    saveDB()
  end
  return true
end

local function bl_remove(id)
  id = tonumber(id);
 if not id then return false end
  if DB.set[id] then
    DB.set[id] = nil
    rebuildListFromSet()
    saveDB()
    return true
  end
  return false
end

local function bl_clear()
  DB.set = {}
  rebuildListFromSet()
  saveDB()
end

-- alias populer
local ALIAS = {
  ["wl"]=242, ["worldlock"]=242, ["world_lock"]=242, ["world lock"]=242,
  ["dl"]=1796, ["diamondlock"]=1796, ["diamond lock"]=1796,
  ["bgl"]=7188, ["bluegemlock"]=7188, ["blue gem lock"]=7188,
  ["bbgl"]=20628, ["ddl"]=20630
}

local function query_is_blacklisted(q)
  local qc = lower(q or ""):gsub("^%s+",""):gsub("%s+$","")
  if qc=="" then return false end

  local num = tonumber(qc)
  if num and bl_has(num) then return true end

 
  local alias_id = ALIAS[qc:gsub("%s","")]
  if alias_id and bl_has(alias_id) then return true end

  -- cocok nama item di list (exact/contains)
  for _,e in ipairs(DB.list or {}) do
    local nm = lower(e.name or "")
    if nm==qc or qc==tostring(e.id) or (nm~="" and qc:find(nm, 1, true)) then
      return true
    end
  end
  return false
end

-- ===== SESSION (per player) =====
local sess = {} -- [netID] = { pick_bl = <lastPickedID> }

-- ===== UI =====
local function buildMainUI(p)
  local net = p:getNetID()
  local sel = (sess[net] 
 and sess[net].pick_bl) or 0
  local selText = sel>0 and ("`7Selected: `w"..itemName(sel).."`7 (ID:`#"..sel.."`7)") or "`7Selected: none"

  local s = "set_default_color|`w\n"
  s = s .. "add_label_with_icon|big|Find Blacklist (Items)|left|242|\n"
  s = s .. "add_textbox|`oBlok `/find` untuk item tertentu (anti abuse).
 Staff tetap bisa find.|\n"
  s = s .. "add_spacer|small|\n"

  s = s .. "add_label|small|`wAdd from Inventory:|left|\n"
  s = s .. "add_item_picker|ip_bl|`wPilih item untuk blacklist find``|`oDari backpack kamu``|\n"
  s = s .. "add_smalltext|"..selText.."|\n"
  s = s .. "add_button|bl_add_from_picker|Add to Blacklist|noflags|\n"

  s = s .. "add_spacer|small|\n"
  s = s .. "add_label|small|`wAdd by ID:|left|\n"
  s = s .. "add_text_input|bl_manual|Item ID|0|9|numeric|\n"
  s = s .. "add_button|bl_add_manual|Add ID|noflags|\n"

  s = s .. "add_spacer|small|\n"
  s = s .. "add_label|small|`wCurrent Blacklist:|left|\n"
  if #DB.list==0 then
    s = s .. "add_smalltext|`7(Empty) |\n"
  else
 
    for _,e in ipairs(DB.list) do
      s = s .. ("add_textbox|`7- `w%s `7(ID:`#%d`7)|\n"):format(e.name, e.id)
      s = s .. ("add_button|bl_rm_%d|Remove|noflags|\n"):format(e.id)
    end
  end

  s = s .. "add_spacer|small|\n"
  s = s .. "add_button|bl_clear_all|`4Clear All|noflags|\n"
  s = s .. "add_quick_exit|\n"
  s = s .. "end_dialog|findbl_main|||\n"
  p:onDialogRequest(s)
end

-- ===== COMMANDS (roleRequired=0;
 cek akses manual) =====
registerLuaCommand({ command="findbl",    roleRequired=0, description="Open Find Blacklist UI" })
registerLuaCommand({ command="findbladd", roleRequired=0, description="Add ID to find blacklist" })
registerLuaCommand({ command="findblrm",  roleRequired=0, description="Remove ID from find blacklist" })
registerLuaCommand({ command="findblclr", roleRequired=0, description="Clear all find blacklist" })

onPlayerCommandCallback(function(world, player, full)
  local cmd, rest = full:match("^(%S+)%s*(.*)$")
  if not cmd then return false end
  local lcmd = lower(cmd or "")

  -- custom commands dulu
  if lcmd=="findbl" then
    if not isStaff(player) then player:onConsoleMessage("`4Access denied."); return true end
    buildMainUI(player); return true
  elseif lcmd=="findbladd" then
    if not isStaff(player) then player:onConsoleMessage("`4Access 
 denied."); return true end
    local id = tonumber(rest)
    if not id then player:onConsoleMessage("Usage: /findbladd <itemID>");
 return true end
    bl_add(id); player:onConsoleMessage("`2Added: `w"..itemName(id).." (`#"..id.."`w)");
 return true
  elseif lcmd=="findblrm" then
    if not isStaff(player) then player:onConsoleMessage("`4Access denied.");
 return true end
    local id = tonumber(rest)
    if not id then player:onConsoleMessage("Usage: /findblrm <itemID>");
 return true end
    if bl_remove(id) then player:onConsoleMessage("`2Removed: `w"..itemName(id)) else player:onConsoleMessage("`7Not in blacklist: `w"..tostring(id)) end
    return true
  elseif lcmd=="findblclr" then
    if not isStaff(player) then player:onConsoleMessage("`4Access denied.");
 return true end
    bl_clear(); player:onConsoleMessage("`4Blacklist cleared."); return true
  end

  -- intercept EXACT /find
  if lcmd=="find" then
    local q = (rest or ""):match("^(.-)$") or ""
    if q ~= "" and query_is_blacklisted(q) and not isStaff(player) then
      player:onConsoleMessage("`4[Find] Item itu diblacklist dari fitur find. Nggak bisa dicari.")
      player:playAudio("bleep_fail.wav")
      return true
    end
    return false
  end

  return false
end)

-- ===== DIALOG HANDLER =====
onPlayerDialogCallback(function(world, player, data)
  local dlg = data.dialog_name or 
 ""
  local btn = data.buttonClicked or ""
  local net = player:getNetID()
  sess[net] = sess[net] or {}

  if dlg=="findbl_main" then
    -- capture pilihan picker biar gak hilang
    local picked = tonumber(data.ip_bl or 0) or 0
    if picked>0 then sess[net].pick_bl = picked end

    if not isStaff(player) then return true end

    if btn=="bl_add_from_picker" then
      local use = sess[net].pick_bl or 0
      if use>0 then
        bl_add(use)
    
     player:onConsoleMessage("`2Blacklisted: `w"..itemName(use).." (`#"..use.."`w)")
      else
        player:onConsoleMessage("`7Pilih item dulu (picker).")
      end
      buildMainUI(player);
 return true
    end

    if btn=="bl_add_manual" then
      local id = tonumber(data.bl_manual or 0) or 0
      if id>0 then
        bl_add(id);
 player:onConsoleMessage("`2Blacklisted: `w"..itemName(id).." (`#"..id.."`w)")
      else
        player:onConsoleMessage("`7Isi ID valid.")
      end
      buildMainUI(player);
 return true
    end

    local rid = tonumber(btn:match("^bl_rm_(%d+)$") or 0) or 0
    if rid>0 then
      if bl_remove(rid) then player:onConsoleMessage("`2Removed: `w"..itemName(rid)) end
      buildMainUI(player);
 return true
    end

    if btn=="bl_clear_all" then
      bl_clear();
 player:onConsoleMessage("`4All blacklist entries cleared.")
      buildMainUI(player);
 return true
    end

    -- kalau cuma milih item (btn kosong/asing), keep UI open
    buildMainUI(player);
 return true
  end

  return false
end)

-- cleanup session
onPlayerDisconnectCallback(function(player)
  local net = player:getNetID()
  if sess[net] then sess[net] = nil end
end)

### File: find-add-mag-gl_1.lua
--[Find and add magplant]
--[Stand on top of magplant]
itemID = 1656
delay = 120










--[Main Script]
SendVariant({v0 = "OnDialogRequest", v1 = [[
set_default_color|`w
add_label_with_icon|small|`8BooLua Community|left|2918|
add_spacer|small|
add_label_with_icon|small|`5VIP `b- `5Free Scripts CPS|left|1368|
add_label_with_icon|small|`eGL `b- `2BotHax `b- `8GPai|left|1368|
add_label_with_icon|small|`6Report Bug Script|left|1368|
add_label_with_icon|small|`3Request Script|left|1368|
add_label_with_icon|small|`8Learn Script|left|1368|
add_spacer|small|
add_url_button||`qDiscord``|NOFLAGS|https://discord.gg/Any9dcWNwE|`$BooLua Community.|0|0|
add_smalltext|`9Need more scripts?!Join now!|
add_quick_exit|]]})
magX = math.floor(GetLocal().posX / 32)
magY = math.floor(GetLocal().posY / 32 + 1)
SendPacketRaw(false, {type = 3, value = 32, px = magX, py = magY, x = magX * 32, y = magY * 32})
Sleep(1000)
while true do
	SendPacket(2, "action|dialog_return\ndialog_name|item_search\n" .. itemID .. "|1")
	Sleep(delay)
	SendPacket(2, "action|dialog_return\ndialog_name|magplant_edit\nx|" .. magX .. "|\ny|" .. magY .. "|\nbuttonClicked|additems")
	Sleep(delay)
end

### File: farmtoken-shop.lua
print("(Loaded) FarmToken Shop Script")

local MAX_INVENTORY   = 200
local FARMTOKEN_ID    = 25142  -- FarmToken ID
local SHOP_TRIGGER_ID = 25154  -- Rancher NPC Trigger ID

-------------------------------------------------------------------
-- CATALOG (id, price, amount)
-------------------------------------------------------------------
local shopItemsStarter = {
    {id = 98, price = 1, amount = 1},
    {id = 1830, price = 75, amount = 1},
    {id = 1966, price = 30, amount = 1},
    {id = 6840, price = 100, amount = 1},
}

local shopItemsCrates = {
    {id = 954, price = 5, amount = 50},
    {id = 3004, price = 5, amount = 50},
    {id = 526, price = 5, amount = 50},
    {id = 4584, price = 5, amount = 50},
    {id = 5666, price = 5, amount = 50},
    {id = 324, price = 5, amount = 50},
    {id = 340, price = 5, amount = 50},
    {id = 682, price = 5, amount = 50},
    {id = 5990, price = 5, amount = 50},
    {id = 454, price = 5, amount = 50},
    {id = 25128, price = 10, amount = 10},
    {id = 25054, price = 15, amount = 5},
}

local shopItemsPopular = {
    {id = 1836, price = 100, amount = 1},
    {id = 4956, price = 200, amount = 1},
}
-------------------------------------------------------------------
-- HELPERS
-------------------------------------------------------------------
local function bal(p)          return p:getItemAmount(FARMTOKEN_ID) end
local function give(p,id,a)    p:changeItem(id,a,0) end
local catalog = {shopItemsStarter, shopItemsCrates, shopItemsPopular}
local function fetch(idx)
    local c = 0
    for _, t in ipairs(catalog) do
        if idx <= c + #t then return t[idx - c] end
        c = c + #t
    end
end

local function padPriceDynamic(price)
    local str = tostring(price)
    local padded

    if #str == 1 then
        padded = "  `9" .. str .. " `wFarmtoken  "
    elseif #str == 2 then
        padded = " " .. str .. " `wFarmtoken "
    else
        padded = str .. " `wFarmtoken"
    end

    local spacer = "`0   `9"
    return spacer .. padded .. spacer
end

-------------------------------------------------------------------
-- SHOP DIALOG
-------------------------------------------------------------------
local BUTTON_WIDTH    = 0.28
local BUTTONS_PER_ROW = 5

local function createFarmTokenShopDialog(p)
    local dlg = ("set_default_color|`o\n"
      .."set_custom_spacing|x:10;y:8|\n"
      .."add_label_with_icon|big|`wGardeners Market|left|%d|\n"
      .."add_spacer|small|\nadd_textbox|Welcome, pick your goodies to purchase!|left|\nadd_spacer|small|\n"
      .."add_label_with_icon|small|`oYou have `w%d `oFarmtokens|left|%d|\n"
      .."add_spacer|small|\n"
      .."add_spacer|small|\n")
      :format(SHOP_TRIGGER_ID, bal(p), FARMTOKEN_ID)

    local btn = 1
    local function section(title, rows, icon, frame)
        if #rows == 0 then return end
        dlg = dlg .. ("add_label_with_icon|small|`w%s|left|%d|\nadd_spacer|small|\n"):format(title, icon)
        for i, v in ipairs(rows) do
            local label = padPriceDynamic(v.price)
            dlg = dlg .. ("add_button_with_icon|var_%d|`9%s|%s|%d|%d|left|width:%.2f;text_scale:0.65;|\n")
                :format(btn, label, frame, v.id, v.amount, BUTTON_WIDTH)
            if i % BUTTONS_PER_ROW == 0 then dlg = dlg .. "add_custom_break|\n" end
            btn = btn + 1
        end
        dlg = dlg .. "add_custom_break|\nadd_spacer|small|\n"
    end

    section("Farmer Tools", shopItemsStarter, 2914, "staticBlueFrame")
    section("Farmables", shopItemsCrates,  2912, "staticBlueFrame")
    section("Expensive", shopItemsPopular, 25020, "staticBlueFrame")

    dlg = dlg .. "add_label|big||left|0|\nadd_quick_exit|\n"
       .. "add_button|back_to_main|`oBack|left|25019|\n"
       .. "end_dialog|farm_token_shop|||\n"
    p:onDialogRequest(dlg)
end

-------------------------------------------------------------------
-- CONFIRM DIALOG
-------------------------------------------------------------------
local function showConfirm(p, idx)
    local row = fetch(idx); if not row then return end
    local it  = getItem(row.id)

    local dlg = "set_default_color|`o\nadd_spacer|small|\n"
      .."add_label_with_icon|big|`wConfirm Purchase|left|6292|\nadd_spacer|small|\n"
      ..("add_smalltext|`wItem: `o%s x%d|\n"):format(it:getName(), row.amount)
      ..("add_smalltext|`wPrice: `o%d Farmtoken|\n"):format(row.price)
      ..("add_smalltext|`wCurrent balance: `o%d Farmtoken|\n"):format(bal(p))
      .."add_spacer|small|\nadd_label_with_icon|big||left|"..row.id.."|\n"
      .."add_smalltext|`wItem Description:|\nadd_smalltext|`o"..it:getDescription().."|\n"
      ..("add_custom_button|farm_confirm_buy_%d|textLabel:`2Purchase for %d Farmtoken|\n"):format(idx, row.price)
      .."add_custom_break|\nadd_spacer|small|\nadd_button|back_to_main|`4Back|\nadd_custom_break|\n"
      .."add_label_with_icon|big||left|0|\nadd_quick_exit|\nend_dialog|farm_confirm_dialog|||\n"
    p:onDialogRequest(dlg)
end

-------------------------------------------------------------------
-- CALLBACKS
-------------------------------------------------------------------
onPlayerDialogCallback(function(_, p, d)
    local dlg, btn = d.dialog_name or "", d.buttonClicked or ""

    if dlg == "farm_token_shop" then
        local idx = tonumber(btn:match("^var_(%d+)$"))
        if idx then showConfirm(p, idx); return true end

    elseif dlg == "farm_confirm_dialog" then
        if btn == "back_to_main" then createFarmTokenShopDialog(p); return true end

        local idx = tonumber(btn:match("^farm_confirm_buy_(%d+)$")); if not idx then return true end
        local row = fetch(idx); if not row then return true end
        local it  = getItem(row.id)

        if bal(p) < row.price then
            p:onTalkBubble(p:getNetID(), "`4Not enough Farmtoken.", 1)
            return true
        end
        if p:getItemAmount(row.id) + row.amount > MAX_INVENTORY then
            p:onTalkBubble(p:getNetID(), "`4Not enough inventory space!", 0)
            return true
        end

        give(p, FARMTOKEN_ID, -row.price)
        give(p, row.id, row.amount)

        p:onTalkBubble(
            p:getNetID(),
            ("`2You purchased %d %s!"):format(row.amount, it:getName()),
            1
        )

        if p.playAudio then p:playAudio(18) elseif p.playSFX then p:playSFX(18) end
        p:onConsoleMessage(
            ("Bought %s x%d for %d Farmtoken"):format(it:getName(), row.amount, row.price)
        )
        return true
    end
    return false
end)

-------------------------------------------------------------------
-- WRENCH HANDLER
-------------------------------------------------------------------
onTileWrenchCallback(function(_, p, t)
    if t:getTileID() == SHOP_TRIGGER_ID then
        createFarmTokenShopDialog(p)
        return true
    end
    return false
end)

### File: fishtoken-shop (1).lua
print("(Loaded) Fishtoken Shop Script")

local MAX_INVENTORY   = 200
local FISHTOKEN_ID    = 25020
local SHOP_TRIGGER_ID = 25150

-------------------------------------------------------------------
-- CATALOG (id, price, amount)
-------------------------------------------------------------------
local shopItemsStarter = {
    {id = 2914, price = 1,  amount = 150},
    {id = 3012, price = 1, amount = 100},
    {id = 3014, price = 1,   amount = 75},
    {id = 3016, price = 1,   amount = 50},
    {id = 3018, price = 1,   amount = 20},
    {id = 3020, price = 3,   amount = 10},
    {id = 3432, price = 5,   amount = 10},
    {id = 4246, price = 1,   amount = 10},
    {id = 4248, price = 3,   amount = 10},
    {id = 3098, price = 5,   amount = 10},
    {id = 3218, price = 3,   amount = 10},
    {id = 5526, price = 3,   amount = 10},
    {id = 5528, price = 3,   amount = 10},    
}
local shopItemsCrates = {
    {id = 2912, price = 1,  amount = 1},
    {id = 3008, price = 1,  amount = 1},
    {id = 3010, price = 25,  amount = 1},
    {id = 3040, price = 50, amount = 1},
    {id = 5740, price = 100, amount = 1},
    {id = 3100, price = 100, amount = 1},
    {id = 10262, price = 125, amount = 1},
}
local shopItemsPopular = {
    {id = 3004, price = 1, amount = 100},
    {id = 5532, price = 1, amount = 5},
    {id = 5534, price = 1, amount = 5},
    {id = 5536, price = 1, amount = 5},
    {id = 3044, price = 1, amount = 3},
    {id = 25104, price = 2,  amount = 1},
    {id = 3002, price = 1, amount = 1},
    {id = 3466, price = 1, amount = 1},
    {id = 3470, price = 1, amount = 2},
    {id = 13740, price = 1, amount = 1},
    {id = 25024, price = 1,  amount = 1},
    {id = 10388, price = 5,  amount = 1}, 
    {id = 13268, price = 5,  amount = 1},
    {id = 13278, price = 5,  amount = 1},
    {id = 5604, price = 10,  amount = 1},
    {id = 5530, price = 10, amount = 1},
    {id = 11768, price = 10,  amount = 1},
    {id = 3042, price = 25, amount = 1},
    {id = 7746, price = 25, amount = 1},
    {id = 9074, price = 25, amount = 1},
}